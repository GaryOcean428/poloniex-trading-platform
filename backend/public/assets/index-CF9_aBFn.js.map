{"version":3,"mappings":"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","names":["STORAGE_KEYS","getStorageItem","key","defaultValue","item","error","setStorageItem","value","isStorageAvailable","test","defaultSettings","EXTENDED_STORAGE_KEYS","SettingsContext","createContext","SettingsProvider","children","canUseStorage","getInitialSettings","settings","setSettings","useState","hasStoredCredentials","setHasStoredCredentials","useEffect","updateSettings","newSettings","prev","updated","storageKey","resetSettings","exportSettings","exportableSettings","importSettings","settingsJson","importedSettings","jsx","useSettings","context","useContext","useResponsiveNav","isMobileMenuOpen","setIsMobileMenuOpen","screenSize","setScreenSize","getScreenSize","useCallback","width","updateScreenSize","newScreenSize","toggleMobileMenu","closeMobileMenu","handleKeyPress","e","handleClickOutside","target","mobileNav","mobileToggle","MobileNavigation","isOpen","onClose","location","useLocation","navItems","LayoutDashboard","Zap","User","BarChart4","LineChart","MessageSquare","Chrome","Settings","jsxs","X","Link","Navbar","notifications","isMobile","Fragment","Menu","Bell","StrategyType","mockTransactions","mockMarketData","_","i","basePrice","volatility","timestamp","open","high","low","close","mockTrades","createJSONStorage","getStorage","options","storage","name","_a","parse","str2","str","newValue","toThenable","fn","input","result","onFulfilled","_onRejected","_onFulfilled","onRejected","persistImpl","config","baseOptions","set","get","api","state","persistedState","currentState","hasHydrated","hydrationListeners","finishHydrationListeners","args","setItem","savedSetState","replace","configResult","stateFromStorage","hydrate","_b","cb","_a2","postRehydrationCallback","deserializedStorageValue","migration","migrationResult","migrated","migratedState","newOptions","persist","NOTHING","DRAFTABLE","DRAFT_STATE","die","getPrototypeOf","isDraft","isDraftable","isPlainObject","isMap","isSet","objectCtorString","proto","Ctor","each","obj","iter","getArchtype","entry","index","thing","has","prop","propOrOldValue","t","is","x","y","latest","shallowCopy","base","strict","isPlain","descriptors","keys","desc","freeze","deep","isFrozen","dontMutateFrozenCollections","plugins","getPlugin","pluginKey","plugin","currentScope","getCurrentScope","createScope","parent_","immer_","usePatchesInScope","scope","patchListener","revokeScope","leaveScope","revokeDraft","enterScope","immer2","draft","processResult","baseDraft","finalize","maybeFreeze","rootScope","path","childValue","finalizeProperty","resultEach","isSet2","parentState","targetObject","rootPath","targetIsSet","res","createProxyProxy","parent","isArray","traps","objectTraps","arrayTraps","revoke","proxy","source","readPropFromProto","peek","prepareCopy","createProxy","getDescriptorFromProto","current2","markChanged","owner","Immer2","recipe","defaultBase","self","base2","hasError","p","ip","patches","inversePatches","current","patch","applyPatchesImpl","currentImpl","copy","immer","produce","immerImpl","initializer","store","updater","nextState","ENCRYPTION_KEY","encryptData","data","CryptoJS","decryptData","encryptedData","createEncryptedStorage","parsed","defaultState","useAppStore","create","credentials","enabled","show","pair","toast","newToast","id","IS_WEBCONTAINER","IS_LOCAL_DEV","getEnvVariable","fallback","__vite_import_meta_env__","getPoloniexApiKey","getPoloniexApiSecret","getApiBaseUrl","service","customApiUrl","nextPublicApiUrl","getPoloniexWebSocketUrl","type","customWsUrl","isMockModeForced","forceMock","isMockModeDisabled","disableMock","shouldUseMockMode","hasCredentials","getBackendUrl","envUrl","hostname","API_BASE_URL","getAuthToken","createAuthenticatedAxios","token","axios","PoloniexAPIError","message","code","statusCode","PoloniexConnectionError","PoloniexAuthenticationError","RATE_LIMITS","logApiCall","_method","_endpoint","_data","safeErrorHandler","_PoloniexApiClient","__publicField","callback","now","limit","queue","oneSecondAgo","oldestRequest","waitTime","resolve","storeState","isLiveTrading","response","_c","_d","_e","count","side","quantity","price","orderData","safeError","_pair","amount","startDate","endDate","cacheKey","mockData","candle","start","end","hourMs","time","PoloniexApiClient","poloniexApi","DEFAULT_OPTIONS","useErrorHandler","useMemo","errorState","setErrorState","resetError","determineErrorType","determineErrorSeverity","logErrorToServer","severity","errorLog","handleError","errorType","newState","withErrorHandling","handlerOptions","timeout","WEBSOCKET_CONFIG","SOCKET_IO_EVENTS","POLONIEX_WS_CONFIG","_WebSocketService","mockMode","savedData","reconnectionStrategy","initialReconnectDelay","maxReconnectDelay","maxReconnectAttempts","reconnectionJitter","pingInterval","pingTimeout","lastLog","delay","jitterFactor","pongElapsed","reject","wsUrl","event","ticker","marketData","trade","tradeData","subscribeMessage","checkConnection","connectionTimeout","socketOptions","io","reason","subscription","offlineData","unsubscribeMessage","username","isVisible","uptime","setState","React","handleStateChange","WebSocketService","webSocketService","useWebSocket","connectionState","setConnectionState","isMockMode","setIsMockMode","errorHandler","usePoloniexData","initialPair","apiKey","apiSecret","setMarketData","trades","setTrades","accountBalance","setAccountBalance","isLoading","setIsLoading","setError","fetchFunctionsRef","useRef","mapPoloniexDataToMarketData","err","mapPoloniexTradeToTrade","fetchMarketData","formattedData","fetchTrades","formattedTrades","fetchAccountBalance","refreshApiConnection","newHasCredentials","newMockMode","handleMarketDataUpdate","prevData","existingIndex","updatedData","a","b","handleTradeUpdate","prevTrades","TradingContext","TradingProvider","realMarketData","realTrades","strategies","setStrategies","activeStrategies","setActiveStrategies","errors","setErrors","addError","clearErrors","errorMessage","addStrategy","strategy","removeStrategy","strategyId","toggleStrategyActive","placeOrder","useTradingContext","Sidebar","isDesktop","isCollapsed","setIsCollapsed","Activity","TrendingUp","Receipt","History","toggleSidebar","ArrowLeft","SkipLinks","_EnvironmentManager","storedConfig","stored","forceMockMode","hasValidCredentials","isExplicitlyMocked","updates","EnvironmentManager","EnvironmentStatus","setConfig","setIsVisible","handleConfigUpdate","status","CheckCircle2","AlertTriangle","StatusIcon","bgColor","borderColor","textColor","iconColor","detail","usePageVisibility","onVisible","onHidden","gracePeriod","timeoutRef","handleVisibilityChange","WebSocketContext","WebSocketProvider","contextState","setContextState","handleConnectionStateChange","healthInterval","health","ConnectionHealth","className","webSocket","isExpanded","setIsExpanded","getHealthStatus","Wifi","Clock","WifiOff","formatUptime","formatLatency","latency","HealthIcon","AlertCircle","ConfigurationStatus","showDetails","setShowDetails","isLiveMode","EnvDebug","isMinimized","setIsMinimized","dismissed","minimized","handleDismiss","handleToggleMinimize","newMinimized","handleShowAgain","envVars","hasApiKey","displayValue","ConnectionTest","apiStatus","setApiStatus","wsStatus","setWsStatus","apiData","setApiData","apiErrorNotifiedRef","wsErrorNotifiedRef","lastErrorTimeRef","addToast","apiUrl","newSocket","getStatusColor","getStatusText","PWAInstallPrompt","deferredPrompt","setDeferredPrompt","showPrompt","setShowPrompt","isInstallable","setIsInstallable","isStandalone","isInWebAppiOS","handleBeforeInstallPrompt","handleAppInstalled","handleInstallClick","Download","useErrorRecovery","navigate","useNavigate","countdown","setCountdown","timer","ErrorFallback","errorCount","onReset","navigateToDashboard","isCriticalError","ErrorBoundary","Component","props","errorInfo","prevState","FallbackComponent","Integration","isExtensionInstalled","setIsExtensionInstalled","handleExtensionMessage","ToastContainer","toasts","removeToast","autoRemovalTimers","scheduleAutoRemoval","toastId","existingTimer","currentToastIds","getIcon","CheckCircle","Info","getToastStyles","baseStyles","clsx","RouteGuard","_ExtensionErrorHandler","originalError","pattern","ExtensionErrorHandler","BrowserCompatibility","extensionId","conflicts","ext","originalPostMessage","Dashboard","lazy","__vitePreload","LiveTradingDashboard","Strategies","Backtesting","Account","TransactionHistory","TradeHistory","MarketAnalysis","Performance","Chat","ExtensionDownload","NotFound","LoadingSpinner","App","Router","Suspense","Routes","Route","createRoot","StrictMode"],"ignoreList":[8,9,10],"sources":["../../src/utils/storage.ts","../../src/context/SettingsContext.tsx","../../src/hooks/useSettings.ts","../../src/hooks/useResponsiveNav.ts","../../src/components/MobileNavigation.tsx","../../src/components/Navbar.tsx","../../src/types/index.ts","../../src/data/mockData.ts","../../../node_modules/zustand/esm/middleware.mjs","../../../node_modules/immer/dist/immer.mjs","../../../node_modules/zustand/esm/middleware/immer.mjs","../../src/store/index.ts","../../src/utils/environment.ts","../../src/services/poloniexAPI.ts","../../src/hooks/useErrorHandler.ts","../../src/services/websocket/config.ts","../../src/services/websocketService.ts","../../src/hooks/usePoloniexData.ts","../../src/context/TradingContext.tsx","../../src/hooks/useTradingContext.ts","../../src/components/Sidebar.tsx","../../src/components/SkipLinks.tsx","../../src/config/environment.ts","../../src/components/EnvironmentStatus.tsx","../../src/hooks/usePageVisibility.ts","../../src/context/WebSocketContext.tsx","../../src/hooks/useWebSocket.ts","../../src/components/ConnectionHealth.tsx","../../src/components/ConfigurationStatus.tsx","../../src/components/EnvDebug.tsx","../../src/components/ConnectionTest.tsx","../../src/components/PWAInstallPrompt.tsx","../../src/hooks/useErrorRecovery.ts","../../src/components/ErrorFallback.tsx","../../src/components/ErrorBoundary.tsx","../../src/components/Integration.tsx","../../src/components/ToastContainer.tsx","../../src/components/RouteGuard.tsx","../../src/utils/extensionErrorHandler.ts","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["/**\n * Storage utility for managing persistent data\n */\n\n// Define keys for local storage\nexport const STORAGE_KEYS = {\n  API_KEY: 'poloniex_api_key',\n  API_SECRET: 'poloniex_api_secret',\n  IS_LIVE_TRADING: 'poloniex_is_live_trading',\n  NOTIFICATIONS: 'poloniex_notifications',\n  DARK_MODE: 'poloniex_dark_mode',\n  DEFAULT_PAIR: 'poloniex_default_pair',\n  EMAIL_NOTIFICATIONS: 'poloniex_email_notifications',\n  TRADE_NOTIFICATIONS: 'poloniex_trade_notifications',\n  PRICE_ALERTS: 'poloniex_price_alerts',\n  CHAT_NOTIFICATIONS: 'poloniex_chat_notifications',\n  SHOW_EXTENSION: 'poloniex_show_extension'\n};\n\n/**\n * Get a value from local storage\n */\nexport const getStorageItem = <T>(key: string, defaultValue: T): T => {\n  try {\n    const item = localStorage.getItem(key);\n    return item ? JSON.parse(item) : defaultValue;\n  } catch (error) {\n    console.error(`Error getting item from storage: ${key}`, error);\n    return defaultValue;\n  }\n};\n\n/**\n * Set a value in local storage\n */\nexport const setStorageItem = <T>(key: string, value: T): void => {\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch (error) {\n    console.error(`Error setting item in storage: ${key}`, error);\n  }\n};\n\n/**\n * Remove a value from local storage\n */\nexport const removeStorageItem = (key: string): void => {\n  try {\n    localStorage.removeItem(key);\n  } catch (error) {\n    console.error(`Error removing item from storage: ${key}`, error);\n  }\n};\n\n/**\n * Clear all app related items from local storage\n */\nexport const clearAppStorage = (): void => {\n  try {\n    Object.values(STORAGE_KEYS).forEach(key => {\n      localStorage.removeItem(key);\n    });\n  } catch (error) {\n    console.error('Error clearing app storage', error);\n  }\n};\n\n/**\n * Check if local storage is available\n */\nexport const isStorageAvailable = (): boolean => {\n  try {\n    const test = '__storage_test__';\n    localStorage.setItem(test, test);\n    localStorage.removeItem(test);\n    return true;\n  } catch {\n    return false;\n  }\n};","import React, { createContext, useState, useEffect, ReactNode } from 'react';\nimport { getStorageItem, setStorageItem, STORAGE_KEYS, isStorageAvailable } from '@/utils/storage';\n\ninterface SettingsContextType {\n  apiKey: string;\n  apiSecret: string;\n  isLiveTrading: boolean;\n  darkMode: boolean;\n  defaultPair: string;\n  emailNotifications: boolean;\n  tradeNotifications: boolean;\n  priceAlerts: boolean;\n  chatNotifications: boolean;\n  showExtension: boolean;\n  chartType: 'candle' | 'line' | 'area';\n  timeframe: '1m' | '5m' | '15m' | '1h' | '4h' | '1d';\n  leverage: number;\n  riskPerTrade: number;\n  stopLossPercent: number;\n  takeProfitPercent: number;\n  trailingStopPercent: number;\n  autoTradingEnabled: boolean;\n  updateSettings: (settings: Partial<SettingsState>) => void;\n  resetSettings: () => void;\n  hasStoredCredentials: boolean;\n  exportSettings: () => string;\n  importSettings: (settingsJson: string) => boolean;\n  mockMode?: boolean; // Added for FuturesContext\n}\n\ninterface SettingsState {\n  apiKey: string;\n  apiSecret: string;\n  isLiveTrading: boolean;\n  darkMode: boolean;\n  defaultPair: string;\n  emailNotifications: boolean;\n  tradeNotifications: boolean;\n  priceAlerts: boolean;\n  chatNotifications: boolean;\n  showExtension: boolean;\n  chartType: 'candle' | 'line' | 'area';\n  timeframe: '1m' | '5m' | '15m' | '1h' | '4h' | '1d';\n  leverage: number;\n  riskPerTrade: number;\n  stopLossPercent: number;\n  takeProfitPercent: number;\n  trailingStopPercent: number;\n  autoTradingEnabled: boolean;\n}\n\nconst defaultSettings: SettingsState = {\n  apiKey: '',\n  apiSecret: '',\n  isLiveTrading: false,\n  darkMode: false,\n  defaultPair: 'BTC-USDT',\n  emailNotifications: true,\n  tradeNotifications: true,\n  priceAlerts: false,\n  chatNotifications: true,\n  showExtension: true,\n  chartType: 'candle',\n  timeframe: '5m',\n  leverage: 1,\n  riskPerTrade: 2,\n  stopLossPercent: 2,\n  takeProfitPercent: 4,\n  trailingStopPercent: 1,\n  autoTradingEnabled: false\n};\n\n// Define storage keys\nconst EXTENDED_STORAGE_KEYS = {\n  ...STORAGE_KEYS,\n  CHART_TYPE: 'poloniex_chart_type',\n  TIMEFRAME: 'poloniex_timeframe',\n  LEVERAGE: 'poloniex_leverage',\n  RISK_PER_TRADE: 'poloniex_risk_per_trade',\n  STOP_LOSS_PERCENT: 'poloniex_stop_loss_percent',\n  TAKE_PROFIT_PERCENT: 'poloniex_take_profit_percent',\n  TRAILING_STOP_PERCENT: 'poloniex_trailing_stop_percent',\n  AUTO_TRADING_ENABLED: 'poloniex_auto_trading_enabled'\n};\n\nconst SettingsContext = createContext<SettingsContextType | undefined>(undefined);\n\nexport { SettingsContext };\n\ninterface SettingsProviderProps {\n  children: ReactNode;\n}\n\nexport const SettingsProvider: React.FC<SettingsProviderProps> = ({ children }) => {\n  // Check if we can access localStorage\n  const canUseStorage = isStorageAvailable();\n  \n  // Get initial settings from localStorage or environment variables\n  const getInitialSettings = (): SettingsState => {\n    if (!canUseStorage) {\n      return {\n        ...defaultSettings,\n        apiKey: import.meta.env.VITE_POLONIEX_API_KEY || '',\n        apiSecret: import.meta.env.VITE_POLONIEX_API_SECRET || ''\n      };\n    }\n\n    return {\n      apiKey: getStorageItem(EXTENDED_STORAGE_KEYS.API_KEY, import.meta.env.VITE_POLONIEX_API_KEY || ''),\n      apiSecret: getStorageItem(EXTENDED_STORAGE_KEYS.API_SECRET, import.meta.env.VITE_POLONIEX_API_SECRET || ''),\n      isLiveTrading: getStorageItem(EXTENDED_STORAGE_KEYS.IS_LIVE_TRADING, false),\n      darkMode: getStorageItem(EXTENDED_STORAGE_KEYS.DARK_MODE, false),\n      defaultPair: getStorageItem(EXTENDED_STORAGE_KEYS.DEFAULT_PAIR, 'BTC-USDT'),\n      emailNotifications: getStorageItem(EXTENDED_STORAGE_KEYS.EMAIL_NOTIFICATIONS, true),\n      tradeNotifications: getStorageItem(EXTENDED_STORAGE_KEYS.TRADE_NOTIFICATIONS, true),\n      priceAlerts: getStorageItem(EXTENDED_STORAGE_KEYS.PRICE_ALERTS, false),\n      chatNotifications: getStorageItem(EXTENDED_STORAGE_KEYS.CHAT_NOTIFICATIONS, true),\n      showExtension: getStorageItem(EXTENDED_STORAGE_KEYS.SHOW_EXTENSION, true),\n      chartType: getStorageItem(EXTENDED_STORAGE_KEYS.CHART_TYPE, 'candle'),\n      timeframe: getStorageItem(EXTENDED_STORAGE_KEYS.TIMEFRAME, '5m'),\n      leverage: getStorageItem(EXTENDED_STORAGE_KEYS.LEVERAGE, 1),\n      riskPerTrade: getStorageItem(EXTENDED_STORAGE_KEYS.RISK_PER_TRADE, 2),\n      stopLossPercent: getStorageItem(EXTENDED_STORAGE_KEYS.STOP_LOSS_PERCENT, 2),\n      takeProfitPercent: getStorageItem(EXTENDED_STORAGE_KEYS.TAKE_PROFIT_PERCENT, 4),\n      trailingStopPercent: getStorageItem(EXTENDED_STORAGE_KEYS.TRAILING_STOP_PERCENT, 1),\n      autoTradingEnabled: getStorageItem(EXTENDED_STORAGE_KEYS.AUTO_TRADING_ENABLED, false)\n    };\n  };\n\n  const [settings, setSettings] = useState<SettingsState>(getInitialSettings);\n  const [hasStoredCredentials, setHasStoredCredentials] = useState<boolean>(false);\n\n  // Check if we have credentials stored\n  useEffect(() => {\n    setHasStoredCredentials(Boolean(settings.apiKey && settings.apiSecret));\n  }, [settings.apiKey, settings.apiSecret]);\n\n  // Apply dark mode setting to document\n  useEffect(() => {\n    if (settings.darkMode) {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n  }, [settings.darkMode]);\n\n  // Update settings in state and localStorage\n  const updateSettings = (newSettings: Partial<SettingsState>) => {\n    setSettings(prev => {\n      const updated = { ...prev, ...newSettings };\n      \n      // Special handling for live trading mode\n      if (newSettings.isLiveTrading !== undefined) {\n        // Only allow live trading if we have API credentials\n        if (newSettings.isLiveTrading && (!updated.apiKey || !updated.apiSecret)) {\n          console.log('Cannot enable live trading without API credentials');\n          updated.isLiveTrading = false;\n        }\n      }\n      \n      // Only persist to localStorage if it's available\n      if (canUseStorage) {\n        // Persist each updated setting to localStorage\n        Object.entries(newSettings).forEach(([key, value]) => {\n          const storageKey = EXTENDED_STORAGE_KEYS[key.toUpperCase() as keyof typeof EXTENDED_STORAGE_KEYS] || `poloniex_${key}`;\n          setStorageItem(storageKey, value);\n        });\n      }\n      \n      return updated;\n    });\n  };\n\n  // Reset all settings to default\n  const resetSettings = () => {\n    setSettings(defaultSettings);\n    \n    if (canUseStorage) {\n      Object.values(EXTENDED_STORAGE_KEYS).forEach(key => {\n        localStorage.removeItem(key);\n      });\n    }\n  };\n\n  // Export settings to JSON string\n  const exportSettings = (): string => {\n    try {\n      // Create a copy of settings without sensitive data\n      const exportableSettings = { ...settings };\n      const sensitiveKeys: (keyof SettingsState)[] = ['apiKey', 'apiSecret'];\n      \n      sensitiveKeys.forEach(key => {\n        if (key in exportableSettings) {\n          delete exportableSettings[key];\n        }\n      });\n      \n      return JSON.stringify(exportableSettings);\n    } catch (error) {\n      console.error('Error exporting settings:', error);\n      return '';\n    }\n  };\n\n  // Import settings from JSON string\n  const importSettings = (settingsJson: string): boolean => {\n    try {\n      const importedSettings = JSON.parse(settingsJson);\n      \n      // Validate imported settings\n      if (typeof importedSettings !== 'object' || importedSettings === null) {\n        throw new Error('Invalid settings format');\n      }\n      \n      // Don't import sensitive data\n      const sensitiveKeys: (keyof SettingsState)[] = ['apiKey', 'apiSecret'];\n      sensitiveKeys.forEach(key => {\n        if (key in importedSettings) {\n          delete importedSettings[key];\n        }\n      });\n      \n      // Update settings\n      updateSettings(importedSettings);\n      return true;\n    } catch (error) {\n      console.error('Error importing settings:', error);\n      return false;\n    }\n  };\n\n  return (\n    <SettingsContext.Provider\n      value={{\n        ...settings,\n        updateSettings,\n        resetSettings,\n        hasStoredCredentials,\n        exportSettings,\n        importSettings,\n        mockMode: !settings.isLiveTrading // Added for FuturesContext\n      }}\n    >\n      {children}\n    </SettingsContext.Provider>\n  );\n};\n\n// End of component\n","import { useContext } from 'react';\nimport { SettingsContext } from '../context/SettingsContext';\n\nexport const useSettings = () => {\n  const context = useContext(SettingsContext);\n  if (context === undefined) {\n    throw new Error('useSettings must be used within a SettingsProvider');\n  }\n  return context;\n};","import { useState, useEffect, useCallback } from 'react';\n\ninterface ResponsiveNavHook {\n  isMobileMenuOpen: boolean;\n  toggleMobileMenu: () => void;\n  closeMobileMenu: () => void;\n  isMobile: boolean;\n  isTablet: boolean;\n  isDesktop: boolean;\n  screenSize: 'mobile' | 'tablet' | 'desktop';\n}\n\n/**\n * Hook for managing responsive navigation and screen size detection\n */\nexport const useResponsiveNav = (): ResponsiveNavHook => {\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n  const [screenSize, setScreenSize] = useState<'mobile' | 'tablet' | 'desktop'>('desktop');\n\n  const getScreenSize = useCallback(() => {\n    const width = window.innerWidth;\n    if (width < 768) return 'mobile';\n    if (width < 1024) return 'tablet';\n    return 'desktop';\n  }, []);\n\n  const updateScreenSize = useCallback(() => {\n    const newScreenSize = getScreenSize();\n    setScreenSize(newScreenSize);\n    \n    // Close mobile menu when switching to larger screens\n    if (newScreenSize !== 'mobile' && isMobileMenuOpen) {\n      setIsMobileMenuOpen(false);\n    }\n  }, [getScreenSize, isMobileMenuOpen]);\n\n  useEffect(() => {\n    updateScreenSize();\n    window.addEventListener('resize', updateScreenSize);\n    \n    return () => {\n      window.removeEventListener('resize', updateScreenSize);\n    };\n  }, [updateScreenSize]);\n\n  const toggleMobileMenu = useCallback(() => {\n    setIsMobileMenuOpen(prev => !prev);\n  }, []);\n\n  const closeMobileMenu = useCallback(() => {\n    setIsMobileMenuOpen(false);\n  }, []);\n\n  // Close mobile menu when clicking outside or pressing escape\n  useEffect(() => {\n    if (!isMobileMenuOpen) return;\n\n    const handleKeyPress = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        closeMobileMenu();\n      }\n    };\n\n    const handleClickOutside = (e: MouseEvent) => {\n      const target = e.target as Element;\n      const mobileNav = document.getElementById('mobile-navigation');\n      const mobileToggle = document.getElementById('mobile-menu-toggle');\n      \n      if (mobileNav && !mobileNav.contains(target) && !mobileToggle?.contains(target)) {\n        closeMobileMenu();\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyPress);\n    document.addEventListener('click', handleClickOutside);\n    \n    // Prevent body scroll when mobile menu is open\n    document.body.style.overflow = 'hidden';\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyPress);\n      document.removeEventListener('click', handleClickOutside);\n      document.body.style.overflow = '';\n    };\n  }, [isMobileMenuOpen, closeMobileMenu]);\n\n  const isMobile = screenSize === 'mobile';\n  const isTablet = screenSize === 'tablet';\n  const isDesktop = screenSize === 'desktop';\n\n  return {\n    isMobileMenuOpen,\n    toggleMobileMenu,\n    closeMobileMenu,\n    isMobile,\n    isTablet,\n    isDesktop,\n    screenSize\n  };\n};\n\n/**\n * Hook for responsive breakpoint detection\n */\nexport const useBreakpoint = () => {\n  const [breakpoint, setBreakpoint] = useState('lg');\n\n  useEffect(() => {\n    const updateBreakpoint = () => {\n      const width = window.innerWidth;\n      if (width < 475) setBreakpoint('xs');\n      else if (width < 640) setBreakpoint('sm');\n      else if (width < 768) setBreakpoint('md');\n      else if (width < 1024) setBreakpoint('lg');\n      else if (width < 1280) setBreakpoint('xl');\n      else setBreakpoint('2xl');\n    };\n\n    updateBreakpoint();\n    window.addEventListener('resize', updateBreakpoint);\n    \n    return () => window.removeEventListener('resize', updateBreakpoint);\n  }, []);\n\n  const isAbove = useCallback((bp: string) => {\n    const breakpoints = { xs: 475, sm: 640, md: 768, lg: 1024, xl: 1280, '2xl': 1536 };\n    const sizes = Object.keys(breakpoints);\n    const currentIndex = sizes.indexOf(breakpoint);\n    const targetIndex = sizes.indexOf(bp);\n    return currentIndex >= targetIndex;\n  }, [breakpoint]);\n\n  const isBelow = useCallback((bp: string) => {\n    return !isAbove(bp);\n  }, [isAbove]);\n\n  return {\n    breakpoint,\n    isAbove,\n    isBelow,\n    isMobile: isBelow('md'),\n    isTablet: isAbove('md') && isBelow('lg'),\n    isDesktop: isAbove('lg')\n  };\n};","import React from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport { X } from 'lucide-react';\nimport { \n  LayoutDashboard, \n  LineChart, \n  Settings, \n  MessageSquare, \n  Zap,\n  BarChart4,\n  Chrome,\n  User\n} from 'lucide-react';\n\ninterface MobileNavigationProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst MobileNavigation: React.FC<MobileNavigationProps> = ({ isOpen, onClose }) => {\n  const location = useLocation();\n  \n  const navItems = [\n    { path: '/', label: 'Dashboard', icon: <LayoutDashboard size={20} /> },\n    { path: '/strategies', label: 'Trading Strategies', icon: <Zap size={20} /> },\n    { path: '/account', label: 'Account', icon: <User size={20} /> },\n    { path: '/charts', label: 'Market Analysis', icon: <BarChart4 size={20} /> },\n    { path: '/performance', label: 'Performance', icon: <LineChart size={20} /> },\n    { path: '/chat', label: 'Community Chat', icon: <MessageSquare size={20} /> },\n    { path: '/extension', label: 'Chrome Extension', icon: <Chrome size={20} /> },\n    { path: '/settings', label: 'Settings', icon: <Settings size={20} /> }\n  ];\n\n  if (!isOpen) return null;\n\n  return (\n    <div\n      className=\"fixed inset-0 z-50 lg:hidden\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label=\"Mobile navigation menu\"\n    >\n      {/* Backdrop */}\n      <div \n        className=\"fixed inset-0 bg-black bg-opacity-50\"\n        onClick={onClose}\n        aria-hidden=\"true\"\n      />\n      \n      {/* Navigation Panel */}\n      <nav\n        id=\"mobile-navigation\"\n        className=\"relative flex flex-col w-full max-w-xs bg-neutral-800 text-white h-full shadow-xl\"\n        aria-label=\"Mobile navigation\"\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-neutral-700\">\n          <div className=\"flex items-center\">\n            <Zap className=\"h-8 w-8 text-blue-400 mr-2\" aria-hidden=\"true\" />\n            <h2 className=\"text-xl font-bold\">TradingBot</h2>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 rounded-md text-neutral-400 hover:text-white hover:bg-neutral-700 transition-colors\"\n            aria-label=\"Close navigation menu\"\n          >\n            <X size={20} aria-hidden=\"true\" />\n          </button>\n        </div>\n        \n        {/* Navigation Links */}\n        <div className=\"flex-1 overflow-y-auto\">\n          <ul className=\"p-4 space-y-2\" role=\"list\">\n            {navItems.map((item) => (\n              <li key={item.path}>\n                <Link\n                  to={item.path}\n                  onClick={onClose}\n                  className={`\n                    flex items-center p-3 rounded-md transition-all duration-200 touch-target\n                    ${location.pathname === item.path \n                      ? 'bg-blue-700 text-white' \n                      : 'text-neutral-300 hover:bg-neutral-700 hover:text-white'\n                    }\n                  `}\n                  aria-label={item.label}\n                  aria-current={location.pathname === item.path ? 'page' : undefined}\n                >\n                  <span className=\"flex-shrink-0 mr-3\" aria-hidden=\"true\">\n                    {item.icon}\n                  </span>\n                  <span className=\"font-medium\">{item.label}</span>\n                </Link>\n              </li>\n            ))}\n          </ul>\n        </div>\n        \n        {/* Footer */}\n        <div className=\"p-4 border-t border-neutral-700\">\n          <div className=\"text-sm text-neutral-400\">\n            <p>Poloniex Trading Platform</p>\n            <p className=\"text-xs mt-1\">Version 1.0.0</p>\n          </div>\n        </div>\n      </nav>\n    </div>\n  );\n};\n\nexport default MobileNavigation;","import { useState } from 'react';\nimport { Bell, User, Menu } from 'lucide-react';\nimport { Link } from 'react-router-dom';\nimport { useSettings } from '../hooks/useSettings';\nimport { useResponsiveNav } from '../hooks/useResponsiveNav';\nimport MobileNavigation from './MobileNavigation';\n\nconst Navbar: React.FC = () => {\n  const [notifications] = useState<number>(3);\n  const { hasStoredCredentials } = useSettings();\n  const { isMobileMenuOpen, toggleMobileMenu, closeMobileMenu, isMobile } = useResponsiveNav();\n  \n  return (\n    <>\n      <nav \n        className=\"bg-white border-b border-neutral-200 px-4 py-2.5 flex justify-between items-center\"\n        role=\"banner\"\n        aria-label=\"Main navigation\"\n      >\n        <div className=\"flex items-center\">\n          {isMobile && (\n            <button \n              id=\"mobile-menu-toggle\"\n              onClick={toggleMobileMenu}\n              className=\"mr-3 p-2 rounded-md text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100 transition-colors touch-target\"\n              aria-label=\"Toggle mobile menu\"\n              aria-expanded={isMobileMenuOpen}\n              aria-controls=\"mobile-navigation\"\n            >\n              <Menu className=\"h-6 w-6\" aria-hidden=\"true\" />\n            </button>\n          )}\n          <h1 className=\"text-lg sm:text-xl font-bold text-blue-600\">\n            <span className=\"hidden sm:inline\">Poloniex Futures</span>\n            <span className=\"sm:hidden\">Poloniex</span>\n          </h1>\n        </div>\n        \n        <div className=\"flex items-center space-x-2 sm:space-x-4\">\n          <div className=\"relative\">\n            <button \n              className=\"p-2 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100 rounded-md transition-colors touch-target\"\n              aria-label={`Notifications${notifications > 0 ? ` (${notifications} new)` : ' (none)'}`}\n            >\n              <Bell className=\"h-5 w-5 sm:h-6 sm:w-6\" aria-hidden=\"true\" />\n              {notifications > 0 && (\n                <span \n                  className=\"absolute -top-1 -right-1 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-white bg-red-600 rounded-full min-w-[1.25rem]\"\n                  aria-hidden=\"true\"\n                >\n                  {notifications > 99 ? '99+' : notifications}\n                </span>\n              )}\n            </button>\n          </div>\n          \n          <div className=\"flex items-center\">\n            <Link \n              to=\"/account\" \n              className=\"flex items-center p-2 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100 rounded-md transition-colors touch-target\"\n              aria-label={hasStoredCredentials ? 'Go to My Account' : 'Connect Account'}\n            >\n              <User className=\"h-5 w-5 sm:h-6 sm:w-6 mr-1 sm:mr-2\" aria-hidden=\"true\" />\n              <span className=\"hidden md:inline-block text-sm font-medium\">\n                {hasStoredCredentials ? 'My Account' : 'Connect Account'}\n              </span>\n              <span className=\"md:hidden text-sm font-medium\">\n                {hasStoredCredentials ? 'Account' : 'Connect'}\n              </span>\n            </Link>\n          </div>\n        </div>\n      </nav>\n      \n      {/* Mobile Navigation */}\n      <MobileNavigation isOpen={isMobileMenuOpen} onClose={closeMobileMenu} />\n    </>\n  );\n};\n\nexport default Navbar;\n","export enum StrategyType {\n  MOVING_AVERAGE_CROSSOVER = 'MovingAverageCrossover',\n  MA_CROSSOVER = 'MovingAverageCrossover', // Alias for backward compatibility\n  RSI = 'RSI',\n  MACD = 'MACD',\n  BOLLINGER_BANDS = 'BollingerBands',\n  BREAKOUT = 'Breakout',\n  CUSTOM = 'Custom'\n}\n\nexport interface BaseStrategyParameters {\n  pair: string;\n  timeframe: string;\n  positionSize?: number; // Position size as a percentage of the account balance\n}\n\nexport interface MovingAverageCrossoverParameters extends BaseStrategyParameters {\n  fastPeriod: number;\n  slowPeriod: number;\n  // For backward compatibility\n  shortPeriod?: number;\n  longPeriod?: number;\n}\n\nexport interface RSIParameters extends BaseStrategyParameters {\n  period: number;\n  overbought: number;\n  oversold: number;\n}\n\nexport interface MACDParameters extends BaseStrategyParameters {\n  fastPeriod: number;\n  slowPeriod: number;\n  signalPeriod: number;\n}\n\nexport interface BollingerBandsParameters extends BaseStrategyParameters {\n  period: number;\n  stdDev: number;\n}\n\nexport interface BreakoutParameters extends BaseStrategyParameters {\n  lookbackPeriod: number;\n  breakoutThreshold: number;\n}\n\nexport type StrategyParameters = \n  | MovingAverageCrossoverParameters \n  | RSIParameters \n  | MACDParameters \n  | BollingerBandsParameters\n  | BreakoutParameters;\n\nexport interface StrategyPerformance {\n  totalPnL: number;\n  winRate: number;\n  tradesCount: number;\n}\n\nexport interface Strategy {\n  id: string;\n  name: string;\n  type: string;\n  parameters: StrategyParameters;\n  createdAt: string;\n  updatedAt: string;\n  performance?: StrategyPerformance;\n}\n\nexport interface MarketData {\n  pair: string;\n  timestamp: number;\n  open: number;\n  high: number;\n  low: number;\n  close: number;\n  volume: number;\n}\n\nexport interface Trade {\n  id: string;\n  pair: string;\n  timestamp: number;\n  type: 'BUY' | 'SELL';\n  price: number;\n  amount: number;\n  total: number;\n  strategyId: string;\n  status: 'PENDING' | 'COMPLETED' | 'FAILED';\n}\n\nexport interface Position {\n  id: string;\n  pair: string;\n  side: 'LONG' | 'SHORT';\n  entryPrice: number;\n  size: number;\n  leverage: number;\n  marginMode: 'ISOLATED' | 'CROSS';\n  liquidationPrice: number;\n  unrealizedPnL: number;\n  marginRatio: number;\n  timestamp: number;\n}\n\nexport interface FuturesOrder {\n  id: string;\n  pair: string;\n  side: 'BUY' | 'SELL';\n  type: 'LIMIT' | 'MARKET' | 'POST_ONLY' | 'FOK' | 'IOC';\n  price?: number;\n  size: number;\n  value: number;\n  leverage: number;\n  marginMode: 'ISOLATED' | 'CROSS';\n  positionSide: 'LONG' | 'SHORT' | 'BOTH';\n  status: 'NEW' | 'PARTIALLY_FILLED' | 'FILLED' | 'CANCELED' | 'REJECTED';\n  timestamp: number;\n}\n\nexport interface ExchangeService {\n  placeOrder: (pair: string, side: 'BUY' | 'SELL', type: 'LIMIT' | 'MARKET', quantity: number, price?: number) => Promise<unknown>;\n  errors: string[];\n  addError: (error: string) => void;\n  clearErrors: () => void;\n  refreshApiConnection: () => Promise<void>;\n}\n","import { MarketData, Strategy, StrategyType, Trade } from '../types';\nimport { MovingAverageCrossoverParameters, RSIParameters, BreakoutParameters } from '../types';\n\nexport interface Transaction {\n  id: string;\n  type: 'DEPOSIT' | 'WITHDRAWAL' | 'TRADE';\n  description: string;\n  amount: number;\n  status: 'COMPLETED' | 'PENDING' | 'FAILED';\n  timestamp: number;\n}\n\nexport const mockTransactions: Transaction[] = [\n  {\n    id: 'tx_1',\n    type: 'DEPOSIT',\n    description: 'USDT Deposit',\n    amount: 5000,\n    status: 'COMPLETED',\n    timestamp: Date.now() - 24 * 60 * 60 * 1000\n  },\n  {\n    id: 'tx_2',\n    type: 'TRADE',\n    description: 'BTC-USDT Buy',\n    amount: 2500,\n    status: 'COMPLETED',\n    timestamp: Date.now() - 12 * 60 * 60 * 1000\n  },\n  {\n    id: 'tx_3',\n    type: 'WITHDRAWAL',\n    description: 'USDT Withdrawal',\n    amount: 1000,\n    status: 'PENDING',\n    timestamp: Date.now() - 6 * 60 * 60 * 1000\n  },\n  {\n    id: 'tx_4',\n    type: 'TRADE',\n    description: 'ETH-USDT Sell',\n    amount: 1500,\n    status: 'COMPLETED',\n    timestamp: Date.now() - 3 * 60 * 60 * 1000\n  },\n  {\n    id: 'tx_5',\n    type: 'DEPOSIT',\n    description: 'BTC Deposit',\n    amount: 3000,\n    status: 'COMPLETED',\n    timestamp: Date.now() - 1 * 60 * 60 * 1000\n  }\n];\n\n// Generate mock market data for the past 100 periods\nexport const mockMarketData: MarketData[] = Array.from({ length: 100 }, (_, i) => {\n  const basePrice = 50000 + Math.random() * 5000;\n  const volatility = basePrice * 0.01;\n  const timestamp = Date.now() - (99 - i) * 60 * 1000; // Last 100 minutes\n  const open = basePrice + (Math.random() - 0.5) * volatility;\n  const high = open + Math.random() * volatility;\n  const low = open - Math.random() * volatility;\n  const close = low + Math.random() * (high - low);\n  \n  return {\n    pair: 'BTC-USDT',\n    timestamp,\n    open,\n    high,\n    low,\n    close,\n    volume: 100 + Math.random() * 900,\n  };\n});\n\nexport const mockStrategies: Strategy[] = [\n  {\n    id: '1',\n    name: 'BTC Daily MA Crossover',\n    type: StrategyType.MA_CROSSOVER,\n    parameters: {\n      fastPeriod: 10,\n      slowPeriod: 50,\n      pair: 'BTC-USDT',\n      timeframe: '1d'\n    } as MovingAverageCrossoverParameters,\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n    performance: {\n      totalPnL: 12.5,\n      winRate: 0.65,\n      tradesCount: 24\n    }\n  },\n  {\n    id: '2',\n    name: 'ETH RSI Strategy',\n    type: StrategyType.RSI,\n    parameters: {\n      period: 14,\n      overbought: 70,\n      oversold: 30,\n      pair: 'ETH-USDT',\n      timeframe: '4h'\n    } as RSIParameters,\n    createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),\n    updatedAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),\n    performance: {\n      totalPnL: 8.2,\n      winRate: 0.58,\n      tradesCount: 17\n    }\n  },\n  {\n    id: '3',\n    name: 'BTC Breakout',\n    type: StrategyType.BREAKOUT,\n    parameters: {\n      lookbackPeriod: 24,\n      breakoutThreshold: 2.5,\n      pair: 'BTC-USDT',\n      timeframe: '1h'\n    } as BreakoutParameters,\n    createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),\n    updatedAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),\n    performance: {\n      totalPnL: 15.7,\n      winRate: 0.45,\n      tradesCount: 11\n    }\n  }\n];\n\n// Generate mock trades with guaranteed unique IDs\nexport const mockTrades: Trade[] = [\n  {\n    id: 'mock-trade-1',\n    pair: 'BTC-USDT',\n    timestamp: Date.now() - 3 * 60 * 60 * 1000,\n    type: 'BUY',\n    price: 51234.56,\n    amount: 0.05,\n    total: 2561.73,\n    strategyId: '1',\n    status: 'COMPLETED'\n  },\n  {\n    id: 'mock-trade-2',\n    pair: 'BTC-USDT',\n    timestamp: Date.now() - 2 * 60 * 60 * 1000,\n    type: 'SELL',\n    price: 51934.12,\n    amount: 0.05,\n    total: 2596.71,\n    strategyId: '1',\n    status: 'COMPLETED'\n  },\n  {\n    id: 'mock-trade-3',\n    pair: 'ETH-USDT',\n    timestamp: Date.now() - 1 * 60 * 60 * 1000,\n    type: 'BUY',\n    price: 3245.78,\n    amount: 0.25,\n    total: 811.45,\n    strategyId: '2',\n    status: 'COMPLETED'\n  },\n  {\n    id: 'mock-trade-4',\n    pair: 'BTC-USDT',\n    timestamp: Date.now() - 30 * 60 * 1000,\n    type: 'BUY',\n    price: 52100.45,\n    amount: 0.03,\n    total: 1563.01,\n    strategyId: '3',\n    status: 'PENDING'\n  }\n];\n","const reduxImpl = (reducer, initial) => (set, _get, api) => {\n  api.dispatch = (action) => {\n    set((state) => reducer(state, action), false, action);\n    return action;\n  };\n  api.dispatchFromDevtools = true;\n  return { dispatch: (...args) => api.dispatch(...args), ...initial };\n};\nconst redux = reduxImpl;\n\nconst trackedConnections = /* @__PURE__ */ new Map();\nconst getTrackedConnectionState = (name) => {\n  const api = trackedConnections.get(name);\n  if (!api) return {};\n  return Object.fromEntries(\n    Object.entries(api.stores).map(([key, api2]) => [key, api2.getState()])\n  );\n};\nconst extractConnectionInformation = (store, extensionConnector, options) => {\n  if (store === void 0) {\n    return {\n      type: \"untracked\",\n      connection: extensionConnector.connect(options)\n    };\n  }\n  const existingConnection = trackedConnections.get(options.name);\n  if (existingConnection) {\n    return { type: \"tracked\", store, ...existingConnection };\n  }\n  const newConnection = {\n    connection: extensionConnector.connect(options),\n    stores: {}\n  };\n  trackedConnections.set(options.name, newConnection);\n  return { type: \"tracked\", store, ...newConnection };\n};\nconst removeStoreFromTrackedConnections = (name, store) => {\n  if (store === void 0) return;\n  const connectionInfo = trackedConnections.get(name);\n  if (!connectionInfo) return;\n  delete connectionInfo.stores[store];\n  if (Object.keys(connectionInfo.stores).length === 0) {\n    trackedConnections.delete(name);\n  }\n};\nconst findCallerName = (stack) => {\n  var _a, _b;\n  if (!stack) return void 0;\n  const traceLines = stack.split(\"\\n\");\n  const apiSetStateLineIndex = traceLines.findIndex(\n    (traceLine) => traceLine.includes(\"api.setState\")\n  );\n  if (apiSetStateLineIndex < 0) return void 0;\n  const callerLine = ((_a = traceLines[apiSetStateLineIndex + 1]) == null ? void 0 : _a.trim()) || \"\";\n  return (_b = /.+ (.+) .+/.exec(callerLine)) == null ? void 0 : _b[1];\n};\nconst devtoolsImpl = (fn, devtoolsOptions = {}) => (set, get, api) => {\n  const { enabled, anonymousActionType, store, ...options } = devtoolsOptions;\n  let extensionConnector;\n  try {\n    extensionConnector = (enabled != null ? enabled : (import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") && window.__REDUX_DEVTOOLS_EXTENSION__;\n  } catch (e) {\n  }\n  if (!extensionConnector) {\n    return fn(set, get, api);\n  }\n  const { connection, ...connectionInformation } = extractConnectionInformation(store, extensionConnector, options);\n  let isRecording = true;\n  api.setState = (state, replace, nameOrAction) => {\n    const r = set(state, replace);\n    if (!isRecording) return r;\n    const action = nameOrAction === void 0 ? {\n      type: anonymousActionType || findCallerName(new Error().stack) || \"anonymous\"\n    } : typeof nameOrAction === \"string\" ? { type: nameOrAction } : nameOrAction;\n    if (store === void 0) {\n      connection == null ? void 0 : connection.send(action, get());\n      return r;\n    }\n    connection == null ? void 0 : connection.send(\n      {\n        ...action,\n        type: `${store}/${action.type}`\n      },\n      {\n        ...getTrackedConnectionState(options.name),\n        [store]: api.getState()\n      }\n    );\n    return r;\n  };\n  api.devtools = {\n    cleanup: () => {\n      if (connection && typeof connection.unsubscribe === \"function\") {\n        connection.unsubscribe();\n      }\n      removeStoreFromTrackedConnections(options.name, store);\n    }\n  };\n  const setStateFromDevtools = (...a) => {\n    const originalIsRecording = isRecording;\n    isRecording = false;\n    set(...a);\n    isRecording = originalIsRecording;\n  };\n  const initialState = fn(api.setState, get, api);\n  if (connectionInformation.type === \"untracked\") {\n    connection == null ? void 0 : connection.init(initialState);\n  } else {\n    connectionInformation.stores[connectionInformation.store] = api;\n    connection == null ? void 0 : connection.init(\n      Object.fromEntries(\n        Object.entries(connectionInformation.stores).map(([key, store2]) => [\n          key,\n          key === connectionInformation.store ? initialState : store2.getState()\n        ])\n      )\n    );\n  }\n  if (api.dispatchFromDevtools && typeof api.dispatch === \"function\") {\n    let didWarnAboutReservedActionType = false;\n    const originalDispatch = api.dispatch;\n    api.dispatch = (...args) => {\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && args[0].type === \"__setState\" && !didWarnAboutReservedActionType) {\n        console.warn(\n          '[zustand devtools middleware] \"__setState\" action type is reserved to set state from the devtools. Avoid using it.'\n        );\n        didWarnAboutReservedActionType = true;\n      }\n      originalDispatch(...args);\n    };\n  }\n  connection.subscribe((message) => {\n    var _a;\n    switch (message.type) {\n      case \"ACTION\":\n        if (typeof message.payload !== \"string\") {\n          console.error(\n            \"[zustand devtools middleware] Unsupported action format\"\n          );\n          return;\n        }\n        return parseJsonThen(\n          message.payload,\n          (action) => {\n            if (action.type === \"__setState\") {\n              if (store === void 0) {\n                setStateFromDevtools(action.state);\n                return;\n              }\n              if (Object.keys(action.state).length !== 1) {\n                console.error(\n                  `\n                    [zustand devtools middleware] Unsupported __setState action format.\n                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { \"type\": \"__setState\", \"state\": { \"abc123Store\": { \"foo\": \"bar\" } } }\n                    `\n                );\n              }\n              const stateFromDevtools = action.state[store];\n              if (stateFromDevtools === void 0 || stateFromDevtools === null) {\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(stateFromDevtools)) {\n                setStateFromDevtools(stateFromDevtools);\n              }\n              return;\n            }\n            if (!api.dispatchFromDevtools) return;\n            if (typeof api.dispatch !== \"function\") return;\n            api.dispatch(action);\n          }\n        );\n      case \"DISPATCH\":\n        switch (message.payload.type) {\n          case \"RESET\":\n            setStateFromDevtools(initialState);\n            if (store === void 0) {\n              return connection == null ? void 0 : connection.init(api.getState());\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"COMMIT\":\n            if (store === void 0) {\n              connection == null ? void 0 : connection.init(api.getState());\n              return;\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"ROLLBACK\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                connection == null ? void 0 : connection.init(api.getState());\n                return;\n              }\n              setStateFromDevtools(state[store]);\n              connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n            });\n          case \"JUMP_TO_STATE\":\n          case \"JUMP_TO_ACTION\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(state[store])) {\n                setStateFromDevtools(state[store]);\n              }\n            });\n          case \"IMPORT_STATE\": {\n            const { nextLiftedState } = message.payload;\n            const lastComputedState = (_a = nextLiftedState.computedStates.slice(-1)[0]) == null ? void 0 : _a.state;\n            if (!lastComputedState) return;\n            if (store === void 0) {\n              setStateFromDevtools(lastComputedState);\n            } else {\n              setStateFromDevtools(lastComputedState[store]);\n            }\n            connection == null ? void 0 : connection.send(\n              null,\n              // FIXME no-any\n              nextLiftedState\n            );\n            return;\n          }\n          case \"PAUSE_RECORDING\":\n            return isRecording = !isRecording;\n        }\n        return;\n    }\n  });\n  return initialState;\n};\nconst devtools = devtoolsImpl;\nconst parseJsonThen = (stringified, fn) => {\n  let parsed;\n  try {\n    parsed = JSON.parse(stringified);\n  } catch (e) {\n    console.error(\n      \"[zustand devtools middleware] Could not parse the received json\",\n      e\n    );\n  }\n  if (parsed !== void 0) fn(parsed);\n};\n\nconst subscribeWithSelectorImpl = (fn) => (set, get, api) => {\n  const origSubscribe = api.subscribe;\n  api.subscribe = (selector, optListener, options) => {\n    let listener = selector;\n    if (optListener) {\n      const equalityFn = (options == null ? void 0 : options.equalityFn) || Object.is;\n      let currentSlice = selector(api.getState());\n      listener = (state) => {\n        const nextSlice = selector(state);\n        if (!equalityFn(currentSlice, nextSlice)) {\n          const previousSlice = currentSlice;\n          optListener(currentSlice = nextSlice, previousSlice);\n        }\n      };\n      if (options == null ? void 0 : options.fireImmediately) {\n        optListener(currentSlice, currentSlice);\n      }\n    }\n    return origSubscribe(listener);\n  };\n  const initialState = fn(set, get, api);\n  return initialState;\n};\nconst subscribeWithSelector = subscribeWithSelectorImpl;\n\nfunction combine(initialState, create) {\n  return (...args) => Object.assign({}, initialState, create(...args));\n}\n\nfunction createJSONStorage(getStorage, options) {\n  let storage;\n  try {\n    storage = getStorage();\n  } catch (e) {\n    return;\n  }\n  const persistStorage = {\n    getItem: (name) => {\n      var _a;\n      const parse = (str2) => {\n        if (str2 === null) {\n          return null;\n        }\n        return JSON.parse(str2, options == null ? void 0 : options.reviver);\n      };\n      const str = (_a = storage.getItem(name)) != null ? _a : null;\n      if (str instanceof Promise) {\n        return str.then(parse);\n      }\n      return parse(str);\n    },\n    setItem: (name, newValue) => storage.setItem(name, JSON.stringify(newValue, options == null ? void 0 : options.replacer)),\n    removeItem: (name) => storage.removeItem(name)\n  };\n  return persistStorage;\n}\nconst toThenable = (fn) => (input) => {\n  try {\n    const result = fn(input);\n    if (result instanceof Promise) {\n      return result;\n    }\n    return {\n      then(onFulfilled) {\n        return toThenable(onFulfilled)(result);\n      },\n      catch(_onRejected) {\n        return this;\n      }\n    };\n  } catch (e) {\n    return {\n      then(_onFulfilled) {\n        return this;\n      },\n      catch(onRejected) {\n        return toThenable(onRejected)(e);\n      }\n    };\n  }\n};\nconst persistImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    storage: createJSONStorage(() => localStorage),\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage = options.storage;\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    return storage.setItem(options.name, {\n      state,\n      version: options.version\n    });\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  api.getInitialState = () => configResult;\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a, _b;\n    if (!storage) return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => {\n      var _a2;\n      return cb((_a2 = get()) != null ? _a2 : configResult);\n    });\n    const postRehydrationCallback = ((_b = options.onRehydrateStorage) == null ? void 0 : _b.call(options, (_a = get()) != null ? _a : configResult)) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            const migration = options.migrate(\n              deserializedStorageValue.state,\n              deserializedStorageValue.version\n            );\n            if (migration instanceof Promise) {\n              return migration.then((result) => [true, result]);\n            }\n            return [true, migration];\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return [false, deserializedStorageValue.state];\n        }\n      }\n      return [false, void 0];\n    }).then((migrationResult) => {\n      var _a2;\n      const [migrated, migratedState] = migrationResult;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      if (migrated) {\n        return setItem();\n      }\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      stateFromStorage = get();\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.storage) {\n        storage = newOptions.storage;\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  if (!options.skipHydration) {\n    hydrate();\n  }\n  return stateFromStorage || configResult;\n};\nconst persist = persistImpl;\n\nexport { combine, createJSONStorage, devtools, persist, redux, subscribeWithSelector };\n","// src/utils/env.ts\nvar NOTHING = Symbol.for(\"immer-nothing\");\nvar DRAFTABLE = Symbol.for(\"immer-draftable\");\nvar DRAFT_STATE = Symbol.for(\"immer-state\");\n\n// src/utils/errors.ts\nvar errors = process.env.NODE_ENV !== \"production\" ? [\n  // All error codes, starting by 0:\n  function(plugin) {\n    return `The plugin for '${plugin}' has not been loaded into Immer. To enable the plugin, import and call \\`enable${plugin}()\\` when initializing your application.`;\n  },\n  function(thing) {\n    return `produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${thing}'`;\n  },\n  \"This object has been frozen and should not be mutated\",\n  function(data) {\n    return \"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \" + data;\n  },\n  \"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",\n  \"Immer forbids circular references\",\n  \"The first or second argument to `produce` must be a function\",\n  \"The third argument to `produce` must be a function or undefined\",\n  \"First argument to `createDraft` must be a plain object, an array, or an immerable object\",\n  \"First argument to `finishDraft` must be a draft returned by `createDraft`\",\n  function(thing) {\n    return `'current' expects a draft, got: ${thing}`;\n  },\n  \"Object.defineProperty() cannot be used on an Immer draft\",\n  \"Object.setPrototypeOf() cannot be used on an Immer draft\",\n  \"Immer only supports deleting array indices\",\n  \"Immer only supports setting array indices and the 'length' property\",\n  function(thing) {\n    return `'original' expects a draft, got: ${thing}`;\n  }\n  // Note: if more errors are added, the errorOffset in Patches.ts should be increased\n  // See Patches.ts for additional errors\n] : [];\nfunction die(error, ...args) {\n  if (process.env.NODE_ENV !== \"production\") {\n    const e = errors[error];\n    const msg = typeof e === \"function\" ? e.apply(null, args) : e;\n    throw new Error(`[Immer] ${msg}`);\n  }\n  throw new Error(\n    `[Immer] minified error nr: ${error}. Full error at: https://bit.ly/3cXEKWf`\n  );\n}\n\n// src/utils/common.ts\nvar getPrototypeOf = Object.getPrototypeOf;\nfunction isDraft(value) {\n  return !!value && !!value[DRAFT_STATE];\n}\nfunction isDraftable(value) {\n  if (!value)\n    return false;\n  return isPlainObject(value) || Array.isArray(value) || !!value[DRAFTABLE] || !!value.constructor?.[DRAFTABLE] || isMap(value) || isSet(value);\n}\nvar objectCtorString = Object.prototype.constructor.toString();\nfunction isPlainObject(value) {\n  if (!value || typeof value !== \"object\")\n    return false;\n  const proto = getPrototypeOf(value);\n  if (proto === null) {\n    return true;\n  }\n  const Ctor = Object.hasOwnProperty.call(proto, \"constructor\") && proto.constructor;\n  if (Ctor === Object)\n    return true;\n  return typeof Ctor == \"function\" && Function.toString.call(Ctor) === objectCtorString;\n}\nfunction original(value) {\n  if (!isDraft(value))\n    die(15, value);\n  return value[DRAFT_STATE].base_;\n}\nfunction each(obj, iter) {\n  if (getArchtype(obj) === 0 /* Object */) {\n    Reflect.ownKeys(obj).forEach((key) => {\n      iter(key, obj[key], obj);\n    });\n  } else {\n    obj.forEach((entry, index) => iter(index, entry, obj));\n  }\n}\nfunction getArchtype(thing) {\n  const state = thing[DRAFT_STATE];\n  return state ? state.type_ : Array.isArray(thing) ? 1 /* Array */ : isMap(thing) ? 2 /* Map */ : isSet(thing) ? 3 /* Set */ : 0 /* Object */;\n}\nfunction has(thing, prop) {\n  return getArchtype(thing) === 2 /* Map */ ? thing.has(prop) : Object.prototype.hasOwnProperty.call(thing, prop);\n}\nfunction get(thing, prop) {\n  return getArchtype(thing) === 2 /* Map */ ? thing.get(prop) : thing[prop];\n}\nfunction set(thing, propOrOldValue, value) {\n  const t = getArchtype(thing);\n  if (t === 2 /* Map */)\n    thing.set(propOrOldValue, value);\n  else if (t === 3 /* Set */) {\n    thing.add(value);\n  } else\n    thing[propOrOldValue] = value;\n}\nfunction is(x, y) {\n  if (x === y) {\n    return x !== 0 || 1 / x === 1 / y;\n  } else {\n    return x !== x && y !== y;\n  }\n}\nfunction isMap(target) {\n  return target instanceof Map;\n}\nfunction isSet(target) {\n  return target instanceof Set;\n}\nfunction latest(state) {\n  return state.copy_ || state.base_;\n}\nfunction shallowCopy(base, strict) {\n  if (isMap(base)) {\n    return new Map(base);\n  }\n  if (isSet(base)) {\n    return new Set(base);\n  }\n  if (Array.isArray(base))\n    return Array.prototype.slice.call(base);\n  const isPlain = isPlainObject(base);\n  if (strict === true || strict === \"class_only\" && !isPlain) {\n    const descriptors = Object.getOwnPropertyDescriptors(base);\n    delete descriptors[DRAFT_STATE];\n    let keys = Reflect.ownKeys(descriptors);\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      const desc = descriptors[key];\n      if (desc.writable === false) {\n        desc.writable = true;\n        desc.configurable = true;\n      }\n      if (desc.get || desc.set)\n        descriptors[key] = {\n          configurable: true,\n          writable: true,\n          // could live with !!desc.set as well here...\n          enumerable: desc.enumerable,\n          value: base[key]\n        };\n    }\n    return Object.create(getPrototypeOf(base), descriptors);\n  } else {\n    const proto = getPrototypeOf(base);\n    if (proto !== null && isPlain) {\n      return { ...base };\n    }\n    const obj = Object.create(proto);\n    return Object.assign(obj, base);\n  }\n}\nfunction freeze(obj, deep = false) {\n  if (isFrozen(obj) || isDraft(obj) || !isDraftable(obj))\n    return obj;\n  if (getArchtype(obj) > 1) {\n    obj.set = obj.add = obj.clear = obj.delete = dontMutateFrozenCollections;\n  }\n  Object.freeze(obj);\n  if (deep)\n    Object.entries(obj).forEach(([key, value]) => freeze(value, true));\n  return obj;\n}\nfunction dontMutateFrozenCollections() {\n  die(2);\n}\nfunction isFrozen(obj) {\n  return Object.isFrozen(obj);\n}\n\n// src/utils/plugins.ts\nvar plugins = {};\nfunction getPlugin(pluginKey) {\n  const plugin = plugins[pluginKey];\n  if (!plugin) {\n    die(0, pluginKey);\n  }\n  return plugin;\n}\nfunction loadPlugin(pluginKey, implementation) {\n  if (!plugins[pluginKey])\n    plugins[pluginKey] = implementation;\n}\n\n// src/core/scope.ts\nvar currentScope;\nfunction getCurrentScope() {\n  return currentScope;\n}\nfunction createScope(parent_, immer_) {\n  return {\n    drafts_: [],\n    parent_,\n    immer_,\n    // Whenever the modified draft contains a draft from another scope, we\n    // need to prevent auto-freezing so the unowned draft can be finalized.\n    canAutoFreeze_: true,\n    unfinalizedDrafts_: 0\n  };\n}\nfunction usePatchesInScope(scope, patchListener) {\n  if (patchListener) {\n    getPlugin(\"Patches\");\n    scope.patches_ = [];\n    scope.inversePatches_ = [];\n    scope.patchListener_ = patchListener;\n  }\n}\nfunction revokeScope(scope) {\n  leaveScope(scope);\n  scope.drafts_.forEach(revokeDraft);\n  scope.drafts_ = null;\n}\nfunction leaveScope(scope) {\n  if (scope === currentScope) {\n    currentScope = scope.parent_;\n  }\n}\nfunction enterScope(immer2) {\n  return currentScope = createScope(currentScope, immer2);\n}\nfunction revokeDraft(draft) {\n  const state = draft[DRAFT_STATE];\n  if (state.type_ === 0 /* Object */ || state.type_ === 1 /* Array */)\n    state.revoke_();\n  else\n    state.revoked_ = true;\n}\n\n// src/core/finalize.ts\nfunction processResult(result, scope) {\n  scope.unfinalizedDrafts_ = scope.drafts_.length;\n  const baseDraft = scope.drafts_[0];\n  const isReplaced = result !== void 0 && result !== baseDraft;\n  if (isReplaced) {\n    if (baseDraft[DRAFT_STATE].modified_) {\n      revokeScope(scope);\n      die(4);\n    }\n    if (isDraftable(result)) {\n      result = finalize(scope, result);\n      if (!scope.parent_)\n        maybeFreeze(scope, result);\n    }\n    if (scope.patches_) {\n      getPlugin(\"Patches\").generateReplacementPatches_(\n        baseDraft[DRAFT_STATE].base_,\n        result,\n        scope.patches_,\n        scope.inversePatches_\n      );\n    }\n  } else {\n    result = finalize(scope, baseDraft, []);\n  }\n  revokeScope(scope);\n  if (scope.patches_) {\n    scope.patchListener_(scope.patches_, scope.inversePatches_);\n  }\n  return result !== NOTHING ? result : void 0;\n}\nfunction finalize(rootScope, value, path) {\n  if (isFrozen(value))\n    return value;\n  const state = value[DRAFT_STATE];\n  if (!state) {\n    each(\n      value,\n      (key, childValue) => finalizeProperty(rootScope, state, value, key, childValue, path)\n    );\n    return value;\n  }\n  if (state.scope_ !== rootScope)\n    return value;\n  if (!state.modified_) {\n    maybeFreeze(rootScope, state.base_, true);\n    return state.base_;\n  }\n  if (!state.finalized_) {\n    state.finalized_ = true;\n    state.scope_.unfinalizedDrafts_--;\n    const result = state.copy_;\n    let resultEach = result;\n    let isSet2 = false;\n    if (state.type_ === 3 /* Set */) {\n      resultEach = new Set(result);\n      result.clear();\n      isSet2 = true;\n    }\n    each(\n      resultEach,\n      (key, childValue) => finalizeProperty(rootScope, state, result, key, childValue, path, isSet2)\n    );\n    maybeFreeze(rootScope, result, false);\n    if (path && rootScope.patches_) {\n      getPlugin(\"Patches\").generatePatches_(\n        state,\n        path,\n        rootScope.patches_,\n        rootScope.inversePatches_\n      );\n    }\n  }\n  return state.copy_;\n}\nfunction finalizeProperty(rootScope, parentState, targetObject, prop, childValue, rootPath, targetIsSet) {\n  if (process.env.NODE_ENV !== \"production\" && childValue === targetObject)\n    die(5);\n  if (isDraft(childValue)) {\n    const path = rootPath && parentState && parentState.type_ !== 3 /* Set */ && // Set objects are atomic since they have no keys.\n    !has(parentState.assigned_, prop) ? rootPath.concat(prop) : void 0;\n    const res = finalize(rootScope, childValue, path);\n    set(targetObject, prop, res);\n    if (isDraft(res)) {\n      rootScope.canAutoFreeze_ = false;\n    } else\n      return;\n  } else if (targetIsSet) {\n    targetObject.add(childValue);\n  }\n  if (isDraftable(childValue) && !isFrozen(childValue)) {\n    if (!rootScope.immer_.autoFreeze_ && rootScope.unfinalizedDrafts_ < 1) {\n      return;\n    }\n    finalize(rootScope, childValue);\n    if ((!parentState || !parentState.scope_.parent_) && typeof prop !== \"symbol\" && Object.prototype.propertyIsEnumerable.call(targetObject, prop))\n      maybeFreeze(rootScope, childValue);\n  }\n}\nfunction maybeFreeze(scope, value, deep = false) {\n  if (!scope.parent_ && scope.immer_.autoFreeze_ && scope.canAutoFreeze_) {\n    freeze(value, deep);\n  }\n}\n\n// src/core/proxy.ts\nfunction createProxyProxy(base, parent) {\n  const isArray = Array.isArray(base);\n  const state = {\n    type_: isArray ? 1 /* Array */ : 0 /* Object */,\n    // Track which produce call this is associated with.\n    scope_: parent ? parent.scope_ : getCurrentScope(),\n    // True for both shallow and deep changes.\n    modified_: false,\n    // Used during finalization.\n    finalized_: false,\n    // Track which properties have been assigned (true) or deleted (false).\n    assigned_: {},\n    // The parent draft state.\n    parent_: parent,\n    // The base state.\n    base_: base,\n    // The base proxy.\n    draft_: null,\n    // set below\n    // The base copy with any updated values.\n    copy_: null,\n    // Called by the `produce` function.\n    revoke_: null,\n    isManual_: false\n  };\n  let target = state;\n  let traps = objectTraps;\n  if (isArray) {\n    target = [state];\n    traps = arrayTraps;\n  }\n  const { revoke, proxy } = Proxy.revocable(target, traps);\n  state.draft_ = proxy;\n  state.revoke_ = revoke;\n  return proxy;\n}\nvar objectTraps = {\n  get(state, prop) {\n    if (prop === DRAFT_STATE)\n      return state;\n    const source = latest(state);\n    if (!has(source, prop)) {\n      return readPropFromProto(state, source, prop);\n    }\n    const value = source[prop];\n    if (state.finalized_ || !isDraftable(value)) {\n      return value;\n    }\n    if (value === peek(state.base_, prop)) {\n      prepareCopy(state);\n      return state.copy_[prop] = createProxy(value, state);\n    }\n    return value;\n  },\n  has(state, prop) {\n    return prop in latest(state);\n  },\n  ownKeys(state) {\n    return Reflect.ownKeys(latest(state));\n  },\n  set(state, prop, value) {\n    const desc = getDescriptorFromProto(latest(state), prop);\n    if (desc?.set) {\n      desc.set.call(state.draft_, value);\n      return true;\n    }\n    if (!state.modified_) {\n      const current2 = peek(latest(state), prop);\n      const currentState = current2?.[DRAFT_STATE];\n      if (currentState && currentState.base_ === value) {\n        state.copy_[prop] = value;\n        state.assigned_[prop] = false;\n        return true;\n      }\n      if (is(value, current2) && (value !== void 0 || has(state.base_, prop)))\n        return true;\n      prepareCopy(state);\n      markChanged(state);\n    }\n    if (state.copy_[prop] === value && // special case: handle new props with value 'undefined'\n    (value !== void 0 || prop in state.copy_) || // special case: NaN\n    Number.isNaN(value) && Number.isNaN(state.copy_[prop]))\n      return true;\n    state.copy_[prop] = value;\n    state.assigned_[prop] = true;\n    return true;\n  },\n  deleteProperty(state, prop) {\n    if (peek(state.base_, prop) !== void 0 || prop in state.base_) {\n      state.assigned_[prop] = false;\n      prepareCopy(state);\n      markChanged(state);\n    } else {\n      delete state.assigned_[prop];\n    }\n    if (state.copy_) {\n      delete state.copy_[prop];\n    }\n    return true;\n  },\n  // Note: We never coerce `desc.value` into an Immer draft, because we can't make\n  // the same guarantee in ES5 mode.\n  getOwnPropertyDescriptor(state, prop) {\n    const owner = latest(state);\n    const desc = Reflect.getOwnPropertyDescriptor(owner, prop);\n    if (!desc)\n      return desc;\n    return {\n      writable: true,\n      configurable: state.type_ !== 1 /* Array */ || prop !== \"length\",\n      enumerable: desc.enumerable,\n      value: owner[prop]\n    };\n  },\n  defineProperty() {\n    die(11);\n  },\n  getPrototypeOf(state) {\n    return getPrototypeOf(state.base_);\n  },\n  setPrototypeOf() {\n    die(12);\n  }\n};\nvar arrayTraps = {};\neach(objectTraps, (key, fn) => {\n  arrayTraps[key] = function() {\n    arguments[0] = arguments[0][0];\n    return fn.apply(this, arguments);\n  };\n});\narrayTraps.deleteProperty = function(state, prop) {\n  if (process.env.NODE_ENV !== \"production\" && isNaN(parseInt(prop)))\n    die(13);\n  return arrayTraps.set.call(this, state, prop, void 0);\n};\narrayTraps.set = function(state, prop, value) {\n  if (process.env.NODE_ENV !== \"production\" && prop !== \"length\" && isNaN(parseInt(prop)))\n    die(14);\n  return objectTraps.set.call(this, state[0], prop, value, state[0]);\n};\nfunction peek(draft, prop) {\n  const state = draft[DRAFT_STATE];\n  const source = state ? latest(state) : draft;\n  return source[prop];\n}\nfunction readPropFromProto(state, source, prop) {\n  const desc = getDescriptorFromProto(source, prop);\n  return desc ? `value` in desc ? desc.value : (\n    // This is a very special case, if the prop is a getter defined by the\n    // prototype, we should invoke it with the draft as context!\n    desc.get?.call(state.draft_)\n  ) : void 0;\n}\nfunction getDescriptorFromProto(source, prop) {\n  if (!(prop in source))\n    return void 0;\n  let proto = getPrototypeOf(source);\n  while (proto) {\n    const desc = Object.getOwnPropertyDescriptor(proto, prop);\n    if (desc)\n      return desc;\n    proto = getPrototypeOf(proto);\n  }\n  return void 0;\n}\nfunction markChanged(state) {\n  if (!state.modified_) {\n    state.modified_ = true;\n    if (state.parent_) {\n      markChanged(state.parent_);\n    }\n  }\n}\nfunction prepareCopy(state) {\n  if (!state.copy_) {\n    state.copy_ = shallowCopy(\n      state.base_,\n      state.scope_.immer_.useStrictShallowCopy_\n    );\n  }\n}\n\n// src/core/immerClass.ts\nvar Immer2 = class {\n  constructor(config) {\n    this.autoFreeze_ = true;\n    this.useStrictShallowCopy_ = false;\n    /**\n     * The `produce` function takes a value and a \"recipe function\" (whose\n     * return value often depends on the base state). The recipe function is\n     * free to mutate its first argument however it wants. All mutations are\n     * only ever applied to a __copy__ of the base state.\n     *\n     * Pass only a function to create a \"curried producer\" which relieves you\n     * from passing the recipe function every time.\n     *\n     * Only plain objects and arrays are made mutable. All other objects are\n     * considered uncopyable.\n     *\n     * Note: This function is __bound__ to its `Immer` instance.\n     *\n     * @param {any} base - the initial state\n     * @param {Function} recipe - function that receives a proxy of the base state as first argument and which can be freely modified\n     * @param {Function} patchListener - optional function that will be called with all the patches produced here\n     * @returns {any} a new state, or the initial state if nothing was modified\n     */\n    this.produce = (base, recipe, patchListener) => {\n      if (typeof base === \"function\" && typeof recipe !== \"function\") {\n        const defaultBase = recipe;\n        recipe = base;\n        const self = this;\n        return function curriedProduce(base2 = defaultBase, ...args) {\n          return self.produce(base2, (draft) => recipe.call(this, draft, ...args));\n        };\n      }\n      if (typeof recipe !== \"function\")\n        die(6);\n      if (patchListener !== void 0 && typeof patchListener !== \"function\")\n        die(7);\n      let result;\n      if (isDraftable(base)) {\n        const scope = enterScope(this);\n        const proxy = createProxy(base, void 0);\n        let hasError = true;\n        try {\n          result = recipe(proxy);\n          hasError = false;\n        } finally {\n          if (hasError)\n            revokeScope(scope);\n          else\n            leaveScope(scope);\n        }\n        usePatchesInScope(scope, patchListener);\n        return processResult(result, scope);\n      } else if (!base || typeof base !== \"object\") {\n        result = recipe(base);\n        if (result === void 0)\n          result = base;\n        if (result === NOTHING)\n          result = void 0;\n        if (this.autoFreeze_)\n          freeze(result, true);\n        if (patchListener) {\n          const p = [];\n          const ip = [];\n          getPlugin(\"Patches\").generateReplacementPatches_(base, result, p, ip);\n          patchListener(p, ip);\n        }\n        return result;\n      } else\n        die(1, base);\n    };\n    this.produceWithPatches = (base, recipe) => {\n      if (typeof base === \"function\") {\n        return (state, ...args) => this.produceWithPatches(state, (draft) => base(draft, ...args));\n      }\n      let patches, inversePatches;\n      const result = this.produce(base, recipe, (p, ip) => {\n        patches = p;\n        inversePatches = ip;\n      });\n      return [result, patches, inversePatches];\n    };\n    if (typeof config?.autoFreeze === \"boolean\")\n      this.setAutoFreeze(config.autoFreeze);\n    if (typeof config?.useStrictShallowCopy === \"boolean\")\n      this.setUseStrictShallowCopy(config.useStrictShallowCopy);\n  }\n  createDraft(base) {\n    if (!isDraftable(base))\n      die(8);\n    if (isDraft(base))\n      base = current(base);\n    const scope = enterScope(this);\n    const proxy = createProxy(base, void 0);\n    proxy[DRAFT_STATE].isManual_ = true;\n    leaveScope(scope);\n    return proxy;\n  }\n  finishDraft(draft, patchListener) {\n    const state = draft && draft[DRAFT_STATE];\n    if (!state || !state.isManual_)\n      die(9);\n    const { scope_: scope } = state;\n    usePatchesInScope(scope, patchListener);\n    return processResult(void 0, scope);\n  }\n  /**\n   * Pass true to automatically freeze all copies created by Immer.\n   *\n   * By default, auto-freezing is enabled.\n   */\n  setAutoFreeze(value) {\n    this.autoFreeze_ = value;\n  }\n  /**\n   * Pass true to enable strict shallow copy.\n   *\n   * By default, immer does not copy the object descriptors such as getter, setter and non-enumrable properties.\n   */\n  setUseStrictShallowCopy(value) {\n    this.useStrictShallowCopy_ = value;\n  }\n  applyPatches(base, patches) {\n    let i;\n    for (i = patches.length - 1; i >= 0; i--) {\n      const patch = patches[i];\n      if (patch.path.length === 0 && patch.op === \"replace\") {\n        base = patch.value;\n        break;\n      }\n    }\n    if (i > -1) {\n      patches = patches.slice(i + 1);\n    }\n    const applyPatchesImpl = getPlugin(\"Patches\").applyPatches_;\n    if (isDraft(base)) {\n      return applyPatchesImpl(base, patches);\n    }\n    return this.produce(\n      base,\n      (draft) => applyPatchesImpl(draft, patches)\n    );\n  }\n};\nfunction createProxy(value, parent) {\n  const draft = isMap(value) ? getPlugin(\"MapSet\").proxyMap_(value, parent) : isSet(value) ? getPlugin(\"MapSet\").proxySet_(value, parent) : createProxyProxy(value, parent);\n  const scope = parent ? parent.scope_ : getCurrentScope();\n  scope.drafts_.push(draft);\n  return draft;\n}\n\n// src/core/current.ts\nfunction current(value) {\n  if (!isDraft(value))\n    die(10, value);\n  return currentImpl(value);\n}\nfunction currentImpl(value) {\n  if (!isDraftable(value) || isFrozen(value))\n    return value;\n  const state = value[DRAFT_STATE];\n  let copy;\n  if (state) {\n    if (!state.modified_)\n      return state.base_;\n    state.finalized_ = true;\n    copy = shallowCopy(value, state.scope_.immer_.useStrictShallowCopy_);\n  } else {\n    copy = shallowCopy(value, true);\n  }\n  each(copy, (key, childValue) => {\n    set(copy, key, currentImpl(childValue));\n  });\n  if (state) {\n    state.finalized_ = false;\n  }\n  return copy;\n}\n\n// src/plugins/patches.ts\nfunction enablePatches() {\n  const errorOffset = 16;\n  if (process.env.NODE_ENV !== \"production\") {\n    errors.push(\n      'Sets cannot have \"replace\" patches.',\n      function(op) {\n        return \"Unsupported patch operation: \" + op;\n      },\n      function(path) {\n        return \"Cannot apply patch, path doesn't resolve: \" + path;\n      },\n      \"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"\n    );\n  }\n  const REPLACE = \"replace\";\n  const ADD = \"add\";\n  const REMOVE = \"remove\";\n  function generatePatches_(state, basePath, patches, inversePatches) {\n    switch (state.type_) {\n      case 0 /* Object */:\n      case 2 /* Map */:\n        return generatePatchesFromAssigned(\n          state,\n          basePath,\n          patches,\n          inversePatches\n        );\n      case 1 /* Array */:\n        return generateArrayPatches(state, basePath, patches, inversePatches);\n      case 3 /* Set */:\n        return generateSetPatches(\n          state,\n          basePath,\n          patches,\n          inversePatches\n        );\n    }\n  }\n  function generateArrayPatches(state, basePath, patches, inversePatches) {\n    let { base_, assigned_ } = state;\n    let copy_ = state.copy_;\n    if (copy_.length < base_.length) {\n      ;\n      [base_, copy_] = [copy_, base_];\n      [patches, inversePatches] = [inversePatches, patches];\n    }\n    for (let i = 0; i < base_.length; i++) {\n      if (assigned_[i] && copy_[i] !== base_[i]) {\n        const path = basePath.concat([i]);\n        patches.push({\n          op: REPLACE,\n          path,\n          // Need to maybe clone it, as it can in fact be the original value\n          // due to the base/copy inversion at the start of this function\n          value: clonePatchValueIfNeeded(copy_[i])\n        });\n        inversePatches.push({\n          op: REPLACE,\n          path,\n          value: clonePatchValueIfNeeded(base_[i])\n        });\n      }\n    }\n    for (let i = base_.length; i < copy_.length; i++) {\n      const path = basePath.concat([i]);\n      patches.push({\n        op: ADD,\n        path,\n        // Need to maybe clone it, as it can in fact be the original value\n        // due to the base/copy inversion at the start of this function\n        value: clonePatchValueIfNeeded(copy_[i])\n      });\n    }\n    for (let i = copy_.length - 1; base_.length <= i; --i) {\n      const path = basePath.concat([i]);\n      inversePatches.push({\n        op: REMOVE,\n        path\n      });\n    }\n  }\n  function generatePatchesFromAssigned(state, basePath, patches, inversePatches) {\n    const { base_, copy_ } = state;\n    each(state.assigned_, (key, assignedValue) => {\n      const origValue = get(base_, key);\n      const value = get(copy_, key);\n      const op = !assignedValue ? REMOVE : has(base_, key) ? REPLACE : ADD;\n      if (origValue === value && op === REPLACE)\n        return;\n      const path = basePath.concat(key);\n      patches.push(op === REMOVE ? { op, path } : { op, path, value });\n      inversePatches.push(\n        op === ADD ? { op: REMOVE, path } : op === REMOVE ? { op: ADD, path, value: clonePatchValueIfNeeded(origValue) } : { op: REPLACE, path, value: clonePatchValueIfNeeded(origValue) }\n      );\n    });\n  }\n  function generateSetPatches(state, basePath, patches, inversePatches) {\n    let { base_, copy_ } = state;\n    let i = 0;\n    base_.forEach((value) => {\n      if (!copy_.has(value)) {\n        const path = basePath.concat([i]);\n        patches.push({\n          op: REMOVE,\n          path,\n          value\n        });\n        inversePatches.unshift({\n          op: ADD,\n          path,\n          value\n        });\n      }\n      i++;\n    });\n    i = 0;\n    copy_.forEach((value) => {\n      if (!base_.has(value)) {\n        const path = basePath.concat([i]);\n        patches.push({\n          op: ADD,\n          path,\n          value\n        });\n        inversePatches.unshift({\n          op: REMOVE,\n          path,\n          value\n        });\n      }\n      i++;\n    });\n  }\n  function generateReplacementPatches_(baseValue, replacement, patches, inversePatches) {\n    patches.push({\n      op: REPLACE,\n      path: [],\n      value: replacement === NOTHING ? void 0 : replacement\n    });\n    inversePatches.push({\n      op: REPLACE,\n      path: [],\n      value: baseValue\n    });\n  }\n  function applyPatches_(draft, patches) {\n    patches.forEach((patch) => {\n      const { path, op } = patch;\n      let base = draft;\n      for (let i = 0; i < path.length - 1; i++) {\n        const parentType = getArchtype(base);\n        let p = path[i];\n        if (typeof p !== \"string\" && typeof p !== \"number\") {\n          p = \"\" + p;\n        }\n        if ((parentType === 0 /* Object */ || parentType === 1 /* Array */) && (p === \"__proto__\" || p === \"constructor\"))\n          die(errorOffset + 3);\n        if (typeof base === \"function\" && p === \"prototype\")\n          die(errorOffset + 3);\n        base = get(base, p);\n        if (typeof base !== \"object\")\n          die(errorOffset + 2, path.join(\"/\"));\n      }\n      const type = getArchtype(base);\n      const value = deepClonePatchValue(patch.value);\n      const key = path[path.length - 1];\n      switch (op) {\n        case REPLACE:\n          switch (type) {\n            case 2 /* Map */:\n              return base.set(key, value);\n            case 3 /* Set */:\n              die(errorOffset);\n            default:\n              return base[key] = value;\n          }\n        case ADD:\n          switch (type) {\n            case 1 /* Array */:\n              return key === \"-\" ? base.push(value) : base.splice(key, 0, value);\n            case 2 /* Map */:\n              return base.set(key, value);\n            case 3 /* Set */:\n              return base.add(value);\n            default:\n              return base[key] = value;\n          }\n        case REMOVE:\n          switch (type) {\n            case 1 /* Array */:\n              return base.splice(key, 1);\n            case 2 /* Map */:\n              return base.delete(key);\n            case 3 /* Set */:\n              return base.delete(patch.value);\n            default:\n              return delete base[key];\n          }\n        default:\n          die(errorOffset + 1, op);\n      }\n    });\n    return draft;\n  }\n  function deepClonePatchValue(obj) {\n    if (!isDraftable(obj))\n      return obj;\n    if (Array.isArray(obj))\n      return obj.map(deepClonePatchValue);\n    if (isMap(obj))\n      return new Map(\n        Array.from(obj.entries()).map(([k, v]) => [k, deepClonePatchValue(v)])\n      );\n    if (isSet(obj))\n      return new Set(Array.from(obj).map(deepClonePatchValue));\n    const cloned = Object.create(getPrototypeOf(obj));\n    for (const key in obj)\n      cloned[key] = deepClonePatchValue(obj[key]);\n    if (has(obj, DRAFTABLE))\n      cloned[DRAFTABLE] = obj[DRAFTABLE];\n    return cloned;\n  }\n  function clonePatchValueIfNeeded(obj) {\n    if (isDraft(obj)) {\n      return deepClonePatchValue(obj);\n    } else\n      return obj;\n  }\n  loadPlugin(\"Patches\", {\n    applyPatches_,\n    generatePatches_,\n    generateReplacementPatches_\n  });\n}\n\n// src/plugins/mapset.ts\nfunction enableMapSet() {\n  class DraftMap extends Map {\n    constructor(target, parent) {\n      super();\n      this[DRAFT_STATE] = {\n        type_: 2 /* Map */,\n        parent_: parent,\n        scope_: parent ? parent.scope_ : getCurrentScope(),\n        modified_: false,\n        finalized_: false,\n        copy_: void 0,\n        assigned_: void 0,\n        base_: target,\n        draft_: this,\n        isManual_: false,\n        revoked_: false\n      };\n    }\n    get size() {\n      return latest(this[DRAFT_STATE]).size;\n    }\n    has(key) {\n      return latest(this[DRAFT_STATE]).has(key);\n    }\n    set(key, value) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (!latest(state).has(key) || latest(state).get(key) !== value) {\n        prepareMapCopy(state);\n        markChanged(state);\n        state.assigned_.set(key, true);\n        state.copy_.set(key, value);\n        state.assigned_.set(key, true);\n      }\n      return this;\n    }\n    delete(key) {\n      if (!this.has(key)) {\n        return false;\n      }\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareMapCopy(state);\n      markChanged(state);\n      if (state.base_.has(key)) {\n        state.assigned_.set(key, false);\n      } else {\n        state.assigned_.delete(key);\n      }\n      state.copy_.delete(key);\n      return true;\n    }\n    clear() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (latest(state).size) {\n        prepareMapCopy(state);\n        markChanged(state);\n        state.assigned_ = /* @__PURE__ */ new Map();\n        each(state.base_, (key) => {\n          state.assigned_.set(key, false);\n        });\n        state.copy_.clear();\n      }\n    }\n    forEach(cb, thisArg) {\n      const state = this[DRAFT_STATE];\n      latest(state).forEach((_value, key, _map) => {\n        cb.call(thisArg, this.get(key), key, this);\n      });\n    }\n    get(key) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      const value = latest(state).get(key);\n      if (state.finalized_ || !isDraftable(value)) {\n        return value;\n      }\n      if (value !== state.base_.get(key)) {\n        return value;\n      }\n      const draft = createProxy(value, state);\n      prepareMapCopy(state);\n      state.copy_.set(key, draft);\n      return draft;\n    }\n    keys() {\n      return latest(this[DRAFT_STATE]).keys();\n    }\n    values() {\n      const iterator = this.keys();\n      return {\n        [Symbol.iterator]: () => this.values(),\n        next: () => {\n          const r = iterator.next();\n          if (r.done)\n            return r;\n          const value = this.get(r.value);\n          return {\n            done: false,\n            value\n          };\n        }\n      };\n    }\n    entries() {\n      const iterator = this.keys();\n      return {\n        [Symbol.iterator]: () => this.entries(),\n        next: () => {\n          const r = iterator.next();\n          if (r.done)\n            return r;\n          const value = this.get(r.value);\n          return {\n            done: false,\n            value: [r.value, value]\n          };\n        }\n      };\n    }\n    [(DRAFT_STATE, Symbol.iterator)]() {\n      return this.entries();\n    }\n  }\n  function proxyMap_(target, parent) {\n    return new DraftMap(target, parent);\n  }\n  function prepareMapCopy(state) {\n    if (!state.copy_) {\n      state.assigned_ = /* @__PURE__ */ new Map();\n      state.copy_ = new Map(state.base_);\n    }\n  }\n  class DraftSet extends Set {\n    constructor(target, parent) {\n      super();\n      this[DRAFT_STATE] = {\n        type_: 3 /* Set */,\n        parent_: parent,\n        scope_: parent ? parent.scope_ : getCurrentScope(),\n        modified_: false,\n        finalized_: false,\n        copy_: void 0,\n        base_: target,\n        draft_: this,\n        drafts_: /* @__PURE__ */ new Map(),\n        revoked_: false,\n        isManual_: false\n      };\n    }\n    get size() {\n      return latest(this[DRAFT_STATE]).size;\n    }\n    has(value) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (!state.copy_) {\n        return state.base_.has(value);\n      }\n      if (state.copy_.has(value))\n        return true;\n      if (state.drafts_.has(value) && state.copy_.has(state.drafts_.get(value)))\n        return true;\n      return false;\n    }\n    add(value) {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (!this.has(value)) {\n        prepareSetCopy(state);\n        markChanged(state);\n        state.copy_.add(value);\n      }\n      return this;\n    }\n    delete(value) {\n      if (!this.has(value)) {\n        return false;\n      }\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareSetCopy(state);\n      markChanged(state);\n      return state.copy_.delete(value) || (state.drafts_.has(value) ? state.copy_.delete(state.drafts_.get(value)) : (\n        /* istanbul ignore next */\n        false\n      ));\n    }\n    clear() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      if (latest(state).size) {\n        prepareSetCopy(state);\n        markChanged(state);\n        state.copy_.clear();\n      }\n    }\n    values() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareSetCopy(state);\n      return state.copy_.values();\n    }\n    entries() {\n      const state = this[DRAFT_STATE];\n      assertUnrevoked(state);\n      prepareSetCopy(state);\n      return state.copy_.entries();\n    }\n    keys() {\n      return this.values();\n    }\n    [(DRAFT_STATE, Symbol.iterator)]() {\n      return this.values();\n    }\n    forEach(cb, thisArg) {\n      const iterator = this.values();\n      let result = iterator.next();\n      while (!result.done) {\n        cb.call(thisArg, result.value, result.value, this);\n        result = iterator.next();\n      }\n    }\n  }\n  function proxySet_(target, parent) {\n    return new DraftSet(target, parent);\n  }\n  function prepareSetCopy(state) {\n    if (!state.copy_) {\n      state.copy_ = /* @__PURE__ */ new Set();\n      state.base_.forEach((value) => {\n        if (isDraftable(value)) {\n          const draft = createProxy(value, state);\n          state.drafts_.set(value, draft);\n          state.copy_.add(draft);\n        } else {\n          state.copy_.add(value);\n        }\n      });\n    }\n  }\n  function assertUnrevoked(state) {\n    if (state.revoked_)\n      die(3, JSON.stringify(latest(state)));\n  }\n  loadPlugin(\"MapSet\", { proxyMap_, proxySet_ });\n}\n\n// src/immer.ts\nvar immer = new Immer2();\nvar produce = immer.produce;\nvar produceWithPatches = immer.produceWithPatches.bind(\n  immer\n);\nvar setAutoFreeze = immer.setAutoFreeze.bind(immer);\nvar setUseStrictShallowCopy = immer.setUseStrictShallowCopy.bind(immer);\nvar applyPatches = immer.applyPatches.bind(immer);\nvar createDraft = immer.createDraft.bind(immer);\nvar finishDraft = immer.finishDraft.bind(immer);\nfunction castDraft(value) {\n  return value;\n}\nfunction castImmutable(value) {\n  return value;\n}\nexport {\n  Immer2 as Immer,\n  applyPatches,\n  castDraft,\n  castImmutable,\n  createDraft,\n  current,\n  enableMapSet,\n  enablePatches,\n  finishDraft,\n  freeze,\n  DRAFTABLE as immerable,\n  isDraft,\n  isDraftable,\n  NOTHING as nothing,\n  original,\n  produce,\n  produceWithPatches,\n  setAutoFreeze,\n  setUseStrictShallowCopy\n};\n//# sourceMappingURL=immer.mjs.map","import { produce } from 'immer';\n\nconst immerImpl = (initializer) => (set, get, store) => {\n  store.setState = (updater, replace, ...args) => {\n    const nextState = typeof updater === \"function\" ? produce(updater) : updater;\n    return set(nextState, replace, ...args);\n  };\n  return initializer(store.setState, get, store);\n};\nconst immer = immerImpl;\n\nexport { immer };\n","import { create } from 'zustand';\nimport { persist, createJSONStorage } from 'zustand/middleware';\nimport { immer } from 'zustand/middleware/immer';\nimport CryptoJS from 'crypto-js';\nimport { STORAGE_KEYS } from '@/utils/storage';\n\n// Define store state interface\nexport interface AppState {\n  // API Configuration\n  apiCredentials: {\n    apiKey: string;\n    apiSecret: string;\n    isLiveTrading: boolean;\n  };\n  \n  // UI State\n  ui: {\n    darkMode: boolean;\n    showExtension: boolean;\n    notifications: {\n      email: boolean;\n      trade: boolean;\n      price: boolean;\n      chat: boolean;\n    };\n  };\n  \n  // Trading Configuration\n  trading: {\n    defaultPair: string;\n    mockMode: boolean;\n  };\n  \n  // Toast Notifications\n  toasts: Array<{\n    id: string;\n    message: string;\n    type: 'success' | 'error' | 'warning' | 'info';\n    timestamp: number;\n    dismissible: boolean;\n  }>;\n}\n\n// Define store actions interface\nexport interface AppActions {\n  // API Credentials\n  setApiCredentials: (credentials: Partial<AppState['apiCredentials']>) => void;\n  clearApiCredentials: () => void;\n  \n  // UI Actions\n  setDarkMode: (enabled: boolean) => void;\n  setShowExtension: (show: boolean) => void;\n  setNotifications: (notifications: Partial<AppState['ui']['notifications']>) => void;\n  \n  // Trading Actions\n  setDefaultPair: (pair: string) => void;\n  setMockMode: (enabled: boolean) => void;\n  \n  // Toast Actions\n  addToast: (toast: Omit<AppState['toasts'][0], 'id' | 'timestamp'>) => void;\n  removeToast: (id: string) => void;\n  clearToasts: () => void;\n}\n\n// Encryption key for sensitive data\nconst ENCRYPTION_KEY = 'poloniex-trading-platform-key';\n\n// Encrypt sensitive data\nconst encryptData = (data: string): string => {\n  try {\n    return CryptoJS.AES.encrypt(data, ENCRYPTION_KEY).toString();\n  } catch (error) {\n    console.error('Encryption failed:', error);\n    return data;\n  }\n};\n\n// Decrypt sensitive data\nconst decryptData = (encryptedData: string): string => {\n  try {\n    const bytes = CryptoJS.AES.decrypt(encryptedData, ENCRYPTION_KEY);\n    return bytes.toString(CryptoJS.enc.Utf8);\n  } catch (error) {\n    console.error('Decryption failed:', error);\n    return encryptedData;\n  }\n};\n\n// Custom storage with encryption for sensitive data\nconst createEncryptedStorage = () => ({\n  getItem: (name: string): string | null => {\n    const item = localStorage.getItem(name);\n    if (!item) return null;\n    \n    try {\n      const parsed = JSON.parse(item);\n      if (parsed.state?.apiCredentials) {\n        // Decrypt API credentials\n        if (parsed.state.apiCredentials.apiKey) {\n          parsed.state.apiCredentials.apiKey = decryptData(parsed.state.apiCredentials.apiKey);\n        }\n        if (parsed.state.apiCredentials.apiSecret) {\n          parsed.state.apiCredentials.apiSecret = decryptData(parsed.state.apiCredentials.apiSecret);\n        }\n      }\n      return JSON.stringify(parsed);\n    } catch (error) {\n      console.error('Error parsing stored data:', error);\n      return item;\n    }\n  },\n  \n  setItem: (name: string, value: string): void => {\n    try {\n      const parsed = JSON.parse(value);\n      if (parsed.state?.apiCredentials) {\n        // Encrypt API credentials before storing\n        if (parsed.state.apiCredentials.apiKey) {\n          parsed.state.apiCredentials.apiKey = encryptData(parsed.state.apiCredentials.apiKey);\n        }\n        if (parsed.state.apiCredentials.apiSecret) {\n          parsed.state.apiCredentials.apiSecret = encryptData(parsed.state.apiCredentials.apiSecret);\n        }\n      }\n      localStorage.setItem(name, JSON.stringify(parsed));\n    } catch (error) {\n      console.error('Error storing data:', error);\n      localStorage.setItem(name, value);\n    }\n  },\n  \n  removeItem: (name: string): void => {\n    localStorage.removeItem(name);\n  }\n});\n\n// Default state\nconst defaultState: AppState = {\n  apiCredentials: {\n    apiKey: '',\n    apiSecret: '',\n    isLiveTrading: false,\n  },\n  ui: {\n    darkMode: false,\n    showExtension: true,\n    notifications: {\n      email: true,\n      trade: true,\n      price: true,\n      chat: true,\n    },\n  },\n  trading: {\n    defaultPair: 'BTC_USDT',\n    mockMode: true,\n  },\n  toasts: [],\n};\n\n// Create the store\nexport const useAppStore = create<AppState & AppActions>()(\n  persist(\n    immer((set, get) => ({\n      ...defaultState,\n      \n      // API Credentials Actions\n      setApiCredentials: (credentials) => set((state) => {\n        Object.assign(state.apiCredentials, credentials);\n      }),\n      \n      clearApiCredentials: () => set((state) => {\n        state.apiCredentials = {\n          apiKey: '',\n          apiSecret: '',\n          isLiveTrading: false,\n        };\n      }),\n      \n      // UI Actions\n      setDarkMode: (enabled) => set((state) => {\n        state.ui.darkMode = enabled;\n      }),\n      \n      setShowExtension: (show) => set((state) => {\n        state.ui.showExtension = show;\n      }),\n      \n      setNotifications: (notifications) => set((state) => {\n        Object.assign(state.ui.notifications, notifications);\n      }),\n      \n      // Trading Actions\n      setDefaultPair: (pair) => set((state) => {\n        state.trading.defaultPair = pair;\n      }),\n      \n      setMockMode: (enabled) => set((state) => {\n        state.trading.mockMode = enabled;\n      }),\n      \n      // Toast Actions\n      addToast: (toast) => set((state) => {\n        const newToast = {\n          ...toast,\n          id: Date.now().toString() + Math.random().toString(36).substr(2, 9),\n          timestamp: Date.now(),\n        };\n        state.toasts.push(newToast);\n      }),\n      \n      removeToast: (id) => set((state) => {\n        const index = state.toasts.findIndex(t => t.id === id);\n        if (index !== -1) {\n          state.toasts.splice(index, 1);\n        }\n      }),\n      \n      clearToasts: () => set((state) => {\n        state.toasts = [];\n      }),\n    })),\n    {\n      name: 'poloniex-app-storage',\n      storage: createJSONStorage(() => createEncryptedStorage()),\n      partialize: (state) => ({\n        apiCredentials: state.apiCredentials,\n        ui: state.ui,\n        trading: state.trading,\n        // Don't persist toasts\n      }),\n    }\n  )\n);\n\n// Selector hooks for better performance\nexport const useApiCredentials = () => useAppStore((state) => state.apiCredentials);\nexport const useUISettings = () => useAppStore((state) => state.ui);\nexport const useTradingSettings = () => useAppStore((state) => state.trading);\nexport const useToasts = () => useAppStore((state) => state.toasts);\n\n// Action hooks\nexport const useApiActions = () => useAppStore((state) => ({\n  setApiCredentials: state.setApiCredentials,\n  clearApiCredentials: state.clearApiCredentials,\n}));\n\nexport const useUIActions = () => useAppStore((state) => ({\n  setDarkMode: state.setDarkMode,\n  setShowExtension: state.setShowExtension,\n  setNotifications: state.setNotifications,\n}));\n\nexport const useTradingActions = () => useAppStore((state) => ({\n  setDefaultPair: state.setDefaultPair,\n  setMockMode: state.setMockMode,\n}));\n\nexport const useToastActions = () => useAppStore((state) => ({\n  addToast: state.addToast,\n  removeToast: state.removeToast,\n  clearToasts: state.clearToasts,\n}));","// Environment detection and configuration\n\nexport const IS_WEBCONTAINER = typeof window !== 'undefined' && \n  window.location && \n  window.location.hostname.includes('webcontainer-api.io');\n\nexport const IS_LOCAL_DEV = typeof window !== 'undefined' && \n  window.location && \n  (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1');\n\n// Get environment variables with fallbacks\nexport const getEnvVariable = (key: string, fallback: string = ''): string => {\n  const value = import.meta.env[key];\n  return value !== undefined ? String(value) : fallback;\n};\n\n// Get Poloniex API credentials from environment\nexport const getPoloniexApiKey = (): string => {\n  return getEnvVariable('VITE_POLONIEX_API_KEY', '');\n};\n\nexport const getPoloniexApiSecret = (): string => {\n  return getEnvVariable('VITE_POLONIEX_API_SECRET', '');\n};\n\nexport const getPoloniexPassphrase = (): string => {\n  // Passphrase is not required for Poloniex API v3\n  // This function is kept for compatibility but returns empty string\n  return '';\n};\n\n// Get API base URLs with environment variable support\nexport const getApiBaseUrl = (service: 'futures' | 'spot' = 'futures'): string => {\n  // Check for custom API URL first - V3 futures specific\n  const customApiUrl = getEnvVariable('VITE_POLONIEX_API_BASE_URL', '');\n  if (customApiUrl) {\n    return customApiUrl;\n  }\n\n  // Support legacy NEXT_PUBLIC_API_URL for compatibility\n  const nextPublicApiUrl = getEnvVariable('NEXT_PUBLIC_API_URL', '');\n  if (nextPublicApiUrl) {\n    return nextPublicApiUrl;\n  }\n\n  // Default to official Poloniex V3 futures API endpoints\n  return service === 'futures' \n    ? 'https://api.poloniex.com/v3/futures'\n    : 'https://api.poloniex.com/v3';\n};\n\n// Get WebSocket URLs for V3 futures\nexport const getPoloniexWebSocketUrl = (type: 'public' | 'private' = 'public'): string => {\n  const customWsUrl = getEnvVariable('VITE_POLONIEX_WS_URL', '');\n  if (customWsUrl) {\n    return customWsUrl;\n  }\n\n  // Default Poloniex V3 futures WebSocket endpoints\n  return type === 'public' \n    ? 'wss://ws.poloniex.com/ws/public'\n    : 'wss://ws.poloniex.com/ws/private';\n};\n\n// Mock mode configuration\nexport const isMockModeForced = (): boolean => {\n  // Check for explicit mock mode environment variable\n  const forceMock = getEnvVariable('VITE_FORCE_MOCK_MODE', '').toLowerCase();\n  return forceMock === 'true' || forceMock === '1';\n};\n\nexport const isMockModeDisabled = (): boolean => {\n  // Check for explicit disable mock mode environment variable\n  const disableMock = getEnvVariable('VITE_DISABLE_MOCK_MODE', '').toLowerCase();\n  return disableMock === 'true' || disableMock === '1';\n};\n\n// Determine if mock mode should be enabled\nexport const shouldUseMockMode = (hasCredentials: boolean = false): boolean => {\n  // If explicitly forced, use mock mode\n  if (isMockModeForced()) {\n    return true;\n  }\n  \n  // If explicitly disabled, don't use mock mode (requires credentials)\n  if (isMockModeDisabled()) {\n    return !hasCredentials;\n  }\n  \n  // Default behavior: only use mock mode in development environments when no credentials\n  // Production should never default to mock mode\n  if (IS_WEBCONTAINER || IS_LOCAL_DEV) {\n    return !hasCredentials;\n  }\n  \n  // In production, require credentials - don't fall back to mock mode\n  return !hasCredentials;\n};\n\n// Get base URL for the application\nexport const getBaseUrl = () => {\n  if (IS_WEBCONTAINER) {\n    return window.location.origin;\n  }\n  if (IS_LOCAL_DEV) {\n    return 'http://localhost:5173';\n  }\n  return 'https://poloniex-trading-platform.vercel.app'; // Production URL\n};\n\n// Get backend API URL\nexport const getBackendUrl = (): string => {\n  const envUrl = getEnvVariable('VITE_BACKEND_URL');\n  if (envUrl) return envUrl;\n  \n  // Check for local development first (localhost or 127.0.0.1)\n  if (typeof window !== 'undefined' && window.location) {\n    const hostname = window.location.hostname;\n    if (hostname === 'localhost' || hostname === '127.0.0.1') {\n      return 'http://localhost:3000';\n    }\n    \n    // For Railway deployment, use the backend service URL\n    if (hostname.includes('railway.app') || hostname.includes('up.railway.app')) {\n      return 'https://polytrade-be.up.railway.app';\n    }\n    \n    // Fall back to same origin for other cases\n    return window.location.origin;\n  }\n  \n  // Server-side fallback\n  return 'http://localhost:3000';\n};","import { useAppStore } from \"@/store\";\nimport { FuturesOrder, MarketData, Position } from \"@/types\";\nimport axios from \"axios\";\n\nimport {\n  getApiBaseUrl,\n  IS_WEBCONTAINER,\n  shouldUseMockMode,\n} from \"@/utils/environment\";\n\n// Use our secure backend API instead of direct Poloniex calls\nconst API_BASE_URL = getApiBaseUrl();\n\n// Authentication token for backend API\nconst getAuthToken = (): string | null => {\n  return localStorage.getItem(\"token\") || sessionStorage.getItem(\"token\");\n};\n\n// Create axios instance with authentication\nconst createAuthenticatedAxios = () => {\n  const token = getAuthToken();\n  return axios.create({\n    baseURL: API_BASE_URL,\n    timeout: 30000,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...(token && { Authorization: `Bearer ${token}` }),\n    },\n  });\n};\n\n// Custom error classes for better error handling\nexport class PoloniexAPIError extends Error {\n  constructor(\n    message: string,\n    public code?: string,\n    public statusCode?: number\n  ) {\n    super(message);\n    this.name = \"PoloniexAPIError\";\n  }\n}\n\nexport class PoloniexConnectionError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = \"PoloniexConnectionError\";\n  }\n}\n\nexport class PoloniexAuthenticationError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = \"PoloniexAuthenticationError\";\n  }\n}\n\n// Rate limiting configuration\nconst RATE_LIMITS = {\n  PUBLIC_REQUESTS_PER_SECOND: 10,\n  PRIVATE_REQUESTS_PER_SECOND: 5,\n  ORDERS_PER_SECOND: 2,\n};\n\n// Create a logger for API calls\nconst logApiCall = (_method: string, _endpoint: string, _data?: unknown) => {\n  // Production logging should be handled by a dedicated service\n};\n\n// Safe error handler\nconst safeErrorHandler = (error: unknown): Error => {\n  if (error instanceof Error) {\n    return new Error(error.message);\n  }\n  return new Error(String(error));\n};\n\n// Create a singleton API client\nclass PoloniexApiClient {\n  private static instance: PoloniexApiClient;\n  private mockMode: boolean = true;\n  private lastBalanceUpdate: number = 0;\n  private cachedBalance: unknown = null;\n  private historicalData: Map<string, MarketData[]> = new Map();\n  private balanceUpdateInterval: number = 10000; // 10 seconds\n  private requestCounter: number = 0;\n  private rateLimitQueue: Map<string, number[]> = new Map();\n  private positionUpdateCallbacks: Set<(positions: Position[]) => void> =\n    new Set();\n  private orderUpdateCallbacks: Set<(orders: FuturesOrder[]) => void> =\n    new Set();\n  private liquidationCallbacks: Set<\n    (warning: { pair: string; message: string }) => void\n  > = new Set();\n  private marginCallbacks: Set<\n    (margin: { pair: string; ratio: number }) => void\n  > = new Set();\n\n  private constructor() {\n    this.loadCredentials();\n  }\n\n  public static getInstance(): PoloniexApiClient {\n    if (!PoloniexApiClient.instance) {\n      PoloniexApiClient.instance = new PoloniexApiClient();\n    }\n    return PoloniexApiClient.instance;\n  }\n\n  public onPositionUpdate(callback: (positions: Position[]) => void): void {\n    this.positionUpdateCallbacks.add(callback);\n  }\n\n  public onOrderUpdate(callback: (orders: FuturesOrder[]) => void): void {\n    this.orderUpdateCallbacks.add(callback);\n  }\n\n  public onLiquidationWarning(\n    callback: (warning: { pair: string; message: string }) => void\n  ): void {\n    this.liquidationCallbacks.add(callback);\n  }\n\n  public onMarginUpdate(\n    callback: (margin: { pair: string; ratio: number }) => void\n  ): void {\n    this.marginCallbacks.add(callback);\n  }\n\n  private async checkRateLimit(\n    type: \"public\" | \"private\" | \"order\"\n  ): Promise<void> {\n    const now = Date.now();\n    const key = `${type}_requests`;\n    const limit =\n      type === \"public\"\n        ? RATE_LIMITS.PUBLIC_REQUESTS_PER_SECOND\n        : type === \"private\"\n        ? RATE_LIMITS.PRIVATE_REQUESTS_PER_SECOND\n        : RATE_LIMITS.ORDERS_PER_SECOND;\n\n    if (!this.rateLimitQueue.has(key)) {\n      this.rateLimitQueue.set(key, []);\n    }\n\n    const queue = this.rateLimitQueue.get(key)!;\n    const oneSecondAgo = now - 1000;\n\n    while (queue.length > 0 && queue[0] < oneSecondAgo) {\n      queue.shift();\n    }\n\n    if (queue.length >= limit) {\n      const oldestRequest = queue[0];\n      const waitTime = 1000 - (now - oldestRequest);\n      await new Promise((resolve) => setTimeout(resolve, waitTime));\n    }\n\n    queue.push(now);\n  }\n\n  public loadCredentials(): void {\n    try {\n      const storeState = useAppStore.getState();\n      const { isLiveTrading } = storeState.apiCredentials;\n\n      this.mockMode = shouldUseMockMode(true) || !isLiveTrading;\n\n      this.cachedBalance = null;\n      this.lastBalanceUpdate = 0;\n    } catch (error) {\n      this.mockMode = shouldUseMockMode(false);\n    }\n  }\n\n  /**\n   * Get account balance via secure backend\n   */\n  public async getAccountBalance() {\n    if (\n      this.cachedBalance &&\n      Date.now() - this.lastBalanceUpdate < this.balanceUpdateInterval\n    ) {\n      return this.cachedBalance;\n    }\n\n    try {\n      if (this.mockMode) {\n        return {\n          totalAmount: \"15478.23\",\n          availableAmount: \"12345.67\",\n          accountEquity: \"15820.45\",\n          unrealizedPnL: \"342.22\",\n          todayPnL: \"156.78\",\n          todayPnLPercentage: \"1.02\",\n        };\n      }\n\n      const api = createAuthenticatedAxios();\n      logApiCall(\"GET\", \"/account/balances\");\n\n      const response = await api.get(\"/account/balances\");\n\n      this.cachedBalance = response.data;\n      this.lastBalanceUpdate = Date.now();\n\n      return this.cachedBalance;\n    } catch (error) {\n      if (axios.isAxiosError(error)) {\n        if (error.response?.status === 401) {\n          throw new PoloniexAuthenticationError(\n            \"Authentication failed - please check your API credentials\"\n          );\n        }\n        if (\n          error.response?.status === 400 &&\n          error.response.data?.requiresApiKeys\n        ) {\n          throw new PoloniexAuthenticationError(\n            \"API credentials required - please add your Poloniex API keys\"\n          );\n        }\n        if (error.response?.status) {\n          throw new PoloniexAPIError(\n            `Backend API error: ${error.response.statusText}`,\n            error.response.data?.code || \"API_ERROR\",\n            error.response.status\n          );\n        }\n      }\n\n      throw new PoloniexConnectionError(\n        `Failed to fetch account balance: ${safeErrorHandler(error).message}`\n      );\n    }\n  }\n\n  /**\n   * Get market data via secure backend\n   */\n  public async getMarketData(pair: string) {\n    try {\n      if (this.mockMode) {\n        return this.generateMockMarketData(100);\n      }\n\n      await this.checkRateLimit(\"public\");\n      const api = createAuthenticatedAxios();\n\n      logApiCall(\"GET\", `/klines/${pair}`);\n      const response = await api.get(`/klines/${pair}`, {\n        params: {\n          interval: \"5m\",\n          limit: 100,\n        },\n      });\n\n      return response.data;\n    } catch (error) {\n      if (axios.isAxiosError(error)) {\n        if (error.response?.status === 404) {\n          throw new PoloniexAPIError(\n            `Market data not found for ${pair}`,\n            \"NOT_FOUND\",\n            404\n          );\n        }\n      }\n\n      throw new PoloniexConnectionError(\n        `Failed to fetch market data for ${pair}: ${\n          safeErrorHandler(error).message\n        }`\n      );\n    }\n  }\n\n  private generateMockMarketData(count: number) {\n    return Array.from({ length: count }, (_, i) => {\n      const basePrice = 50000 + Math.random() * 5000;\n      const volatility = basePrice * 0.01;\n      const timestamp = Date.now() - (count - 1 - i) * 60 * 1000;\n      const open = basePrice + (Math.random() - 0.5) * volatility;\n      const high = open + Math.random() * volatility;\n      const low = open - Math.random() * volatility;\n      const close = low + Math.random() * (high - low);\n\n      return [\n        new Date(timestamp).toISOString(),\n        open.toString(),\n        high.toString(),\n        low.toString(),\n        close.toString(),\n        (100 + Math.random() * 900).toString(),\n      ];\n    });\n  }\n\n  /**\n   * Get open positions via secure backend\n   */\n  public async getOpenPositions() {\n    try {\n      if (this.mockMode) {\n        return {\n          positions: [\n            {\n              symbol: \"BTC_USDT_PERP\",\n              posId: \"12345\",\n              pos: \"long\",\n              marginMode: \"cross\",\n              posCost: \"25000\",\n              posSide: \"long\",\n              posSize: \"0.5\",\n              markPrice: \"51000\",\n              unrealizedPnL: \"500\",\n              liquidationPrice: \"45000\",\n            },\n          ],\n        };\n      }\n\n      await this.checkRateLimit(\"private\");\n      const api = createAuthenticatedAxios();\n\n      logApiCall(\"GET\", \"/account/balances\");\n      const response = await api.get(\"/account/balances\");\n\n      return response.data;\n    } catch (error) {\n      if (axios.isAxiosError(error)) {\n        if (error.response?.status === 401) {\n          throw new PoloniexAuthenticationError(\n            \"Authentication failed for positions\"\n          );\n        }\n      }\n\n      throw new PoloniexConnectionError(\n        `Failed to fetch open positions: ${safeErrorHandler(error).message}`\n      );\n    }\n  }\n\n  /**\n   * Place an order via secure backend\n   */\n  public async placeOrder(\n    pair: string,\n    side: \"buy\" | \"sell\",\n    type: \"limit\" | \"market\",\n    quantity: number,\n    price?: number\n  ) {\n    await this.checkRateLimit(\"order\");\n\n    try {\n      if (this.mockMode) {\n        return {\n          success: true,\n          orderId: \"mock-order-\" + Date.now(),\n          pair,\n          side,\n          type,\n          quantity,\n          price: price || \"market\",\n        };\n      }\n\n      const api = createAuthenticatedAxios();\n      const orderData = {\n        symbol: pair,\n        side: side.toUpperCase(),\n        type: type.toUpperCase(),\n        amount: quantity.toString(),\n        ...(type === \"limit\" && price ? { price: price.toString() } : {}),\n      };\n\n      logApiCall(\"POST\", \"/orders\", orderData);\n      const response = await api.post(\"/orders\", orderData);\n\n      return response.data;\n    } catch (error) {\n      const safeError = safeErrorHandler(error);\n\n      if (IS_WEBCONTAINER) {\n        return {\n          success: true,\n          orderId: \"mock-order-\" + Date.now(),\n          pair,\n          side,\n          type,\n          quantity,\n          price: price || \"market\",\n        };\n      }\n\n      throw safeError;\n    }\n  }\n\n  /**\n   * Get recent trades via secure backend\n   */\n  public async getRecentTrades(pair: string, limit: number = 50) {\n    try {\n      if (this.mockMode) {\n        return this.generateMockTrades(pair, limit);\n      }\n\n      await this.checkRateLimit(\"public\");\n      const api = createAuthenticatedAxios();\n\n      logApiCall(\"GET\", \"/trades\");\n      const response = await api.get(\"/trades\", {\n        params: { symbol: pair, limit },\n      });\n\n      return response.data;\n    } catch (error) {\n      throw new PoloniexConnectionError(\n        `Failed to fetch recent trades for ${pair}: ${\n          safeErrorHandler(error).message\n        }`\n      );\n    }\n  }\n\n  private generateMockTrades(_pair: string, limit: number) {\n    return Array.from({ length: limit }, (_, i) => {\n      const basePrice = 51000 + (Math.random() - 0.5) * 1000;\n      const amount = 0.01 + Math.random() * 0.5;\n      const timestamp = Date.now() - i * 60 * 1000;\n\n      return {\n        id: `mock-trade-${i}-${Date.now()}`,\n        price: basePrice.toString(),\n        quantity: amount.toString(),\n        amount: (basePrice * amount).toString(),\n        takerSide: Math.random() > 0.5 ? \"buy\" : \"sell\",\n        ts: timestamp,\n        createdAt: new Date(timestamp).toISOString(),\n      };\n    });\n  }\n\n  /**\n   * Get historical market data for backtesting via secure backend\n   */\n  public async getHistoricalData(\n    pair: string,\n    startDate: string,\n    endDate: string\n  ): Promise<MarketData[]> {\n    const cacheKey = `${pair}-${startDate}-${endDate}`;\n\n    if (this.historicalData.has(cacheKey)) {\n      return this.historicalData.get(cacheKey)!;\n    }\n\n    try {\n      if (this.mockMode) {\n        const mockData = this.generateMockHistoricalData(\n          pair,\n          startDate,\n          endDate\n        );\n        this.historicalData.set(cacheKey, mockData);\n        return mockData;\n      }\n\n      const api = createAuthenticatedAxios();\n\n      const response = await api.get(`/klines/${pair}`, {\n        params: {\n          interval: \"1h\",\n          startTime: new Date(startDate).getTime(),\n          endTime: new Date(endDate).getTime(),\n          limit: 1000,\n        },\n      });\n\n      const data = response.data.map((candle: unknown[]) => ({\n        pair,\n        timestamp: new Date(candle[0] as string).getTime(),\n        open: parseFloat(candle[1] as string),\n        high: parseFloat(candle[2] as string),\n        low: parseFloat(candle[3] as string),\n        close: parseFloat(candle[4] as string),\n        volume: parseFloat(candle[5] as string),\n      }));\n\n      this.historicalData.set(cacheKey, data);\n      return data;\n    } catch (error) {\n      const mockData = this.generateMockHistoricalData(\n        pair,\n        startDate,\n        endDate\n      );\n      this.historicalData.set(cacheKey, mockData);\n      return mockData;\n    }\n  }\n\n  private generateMockHistoricalData(\n    pair: string,\n    startDate: string,\n    endDate: string\n  ): MarketData[] {\n    const start = new Date(startDate).getTime();\n    const end = new Date(endDate).getTime();\n    const hourMs = 60 * 60 * 1000;\n    const data: MarketData[] = [];\n\n    let basePrice = 50000;\n\n    for (let time = start; time <= end; time += hourMs) {\n      const volatility = basePrice * 0.01;\n      const open = basePrice + (Math.random() - 0.5) * volatility;\n      const high = open + Math.random() * volatility;\n      const low = open - Math.random() * volatility;\n      const close = low + Math.random() * (high - low);\n\n      data.push({\n        pair,\n        timestamp: time,\n        open,\n        high,\n        low,\n        close,\n        volume: 100 + Math.random() * 900,\n      });\n\n      basePrice = close;\n    }\n\n    return data;\n  }\n}\n\n// Export a singleton instance\nexport const poloniexApi = PoloniexApiClient.getInstance();\n","import { useState, useEffect, useCallback, useMemo } from 'react';\n\ntype ErrorType = 'api' | 'network' | 'validation' | 'authentication' | 'unknown';\ntype ErrorSeverity = 'low' | 'medium' | 'high' | 'critical';\n\ninterface ErrorHandlerOptions {\n  retryCount?: number;\n  retryDelay?: number;\n  onRetry?: (error: Error, attempt: number) => void;\n  onFallback?: (error: Error) => void;\n  fallbackValue?: any;\n  logToServer?: boolean;\n  showToUser?: boolean;\n}\n\ninterface ErrorState {\n  hasError: boolean;\n  error: Error | null;\n  errorType: ErrorType;\n  severity: ErrorSeverity;\n  retryAttempt: number;\n  lastErrorTime: number;\n}\n\nconst DEFAULT_OPTIONS: ErrorHandlerOptions = {\n  retryCount: 3,\n  retryDelay: 1000,\n  logToServer: true,\n  showToUser: true\n};\n\nexport const useErrorHandler = (options: ErrorHandlerOptions = {}) => {\n  const config = useMemo(() => ({ ...DEFAULT_OPTIONS, ...options }), [options]);\n  \n  const [errorState, setErrorState] = useState<ErrorState>({\n    hasError: false,\n    error: null,\n    errorType: 'unknown',\n    severity: 'low',\n    retryAttempt: 0,\n    lastErrorTime: 0\n  });\n  \n  // Reset error state\n  const resetError = useCallback(() => {\n    setErrorState({\n      hasError: false,\n      error: null,\n      errorType: 'unknown',\n      severity: 'low',\n      retryAttempt: 0,\n      lastErrorTime: 0\n    });\n  }, []);\n  \n  // Determine error type from error object\n  const determineErrorType = useCallback((error: Error): ErrorType => {\n    const message = error.message.toLowerCase();\n    \n    if (error.name === 'ApiError' || message.includes('api') || message.includes('endpoint')) {\n      return 'api';\n    }\n    \n    if (error.name === 'NetworkError' || \n        message.includes('network') || \n        message.includes('connection') ||\n        message.includes('offline') ||\n        message.includes('timeout')) {\n      return 'network';\n    }\n    \n    if (error.name === 'ValidationError' || message.includes('validation') || message.includes('invalid')) {\n      return 'validation';\n    }\n    \n    if (error.name === 'AuthenticationError' || \n        message.includes('auth') || \n        message.includes('permission') ||\n        message.includes('token') ||\n        message.includes('unauthorized')) {\n      return 'authentication';\n    }\n    \n    return 'unknown';\n  }, []);\n  \n  // Determine error severity\n  const determineErrorSeverity = useCallback((error: Error, type: ErrorType): ErrorSeverity => {\n    const message = error.message.toLowerCase();\n    \n    // Critical errors\n    if (message.includes('critical') || \n        message.includes('fatal') ||\n        message.includes('crash')) {\n      return 'critical';\n    }\n    \n    // High severity errors\n    if (type === 'authentication' || \n        message.includes('security') ||\n        message.includes('data loss')) {\n      return 'high';\n    }\n    \n    // Medium severity errors\n    if (type === 'api' || \n        type === 'network' ||\n        message.includes('timeout')) {\n      return 'medium';\n    }\n    \n    // Default to low severity\n    return 'low';\n  }, []);\n  \n  // Log error to server\n  const logErrorToServer = useCallback((error: Error, type: ErrorType, severity: ErrorSeverity) => {\n    // In production, this would send to a logging service\n    console.error('Error logged to server:', {\n      message: error.message,\n      stack: error.stack,\n      type,\n      severity,\n      timestamp: new Date().toISOString(),\n      userAgent: navigator.userAgent,\n      url: window.location.href\n    });\n    \n    // Store in localStorage for diagnostics\n    try {\n      const errorLog = JSON.parse(localStorage.getItem('errorLog') || '[]');\n      errorLog.push({\n        message: error.message,\n        type,\n        severity,\n        timestamp: new Date().toISOString(),\n        url: window.location.href\n      });\n      \n      // Keep only the last 20 errors\n      if (errorLog.length > 20) errorLog.shift();\n      localStorage.setItem('errorLog', JSON.stringify(errorLog));\n    } catch (e) {\n      console.error('Failed to log error to localStorage', e);\n    }\n  }, []);\n  \n  // Handle error with retry logic\n  const handleError = useCallback((error: Error) => {\n    const errorType = determineErrorType(error);\n    const severity = determineErrorSeverity(error, errorType);\n    const now = Date.now();\n    \n    setErrorState(prev => {\n      const newState = {\n        hasError: true,\n        error,\n        errorType,\n        severity,\n        retryAttempt: prev.retryAttempt + 1,\n        lastErrorTime: now\n      };\n      \n      // Log error if configured\n      if (config.logToServer) {\n        logErrorToServer(error, errorType, severity);\n      }\n      \n      // Check if we should retry\n      if (newState.retryAttempt <= (config.retryCount || 0) && \n          (errorType === 'network' || errorType === 'api')) {\n        \n        // Schedule retry\n        setTimeout(() => {\n          if (config.onRetry) {\n            config.onRetry(error, newState.retryAttempt);\n          }\n          \n          // Only reset error state if it's the same error\n          setErrorState(current => {\n            if (current.error === error) {\n              return {\n                ...current,\n                hasError: false\n              };\n            }\n            return current;\n          });\n        }, (config.retryDelay || 1000) * Math.pow(2, newState.retryAttempt - 1)); // Exponential backoff\n      } else if (config.onFallback) {\n        // Use fallback if available\n        config.onFallback(error);\n      }\n      \n      return newState;\n    });\n  }, [\n    config, \n    determineErrorType, \n    determineErrorSeverity, \n    logErrorToServer\n  ]);\n  \n  // Wrap async function with error handling\n  const withErrorHandling = useCallback(<T extends any[], R>(\n    fn: (...args: T) => Promise<R>,\n    options: ErrorHandlerOptions = {}\n  ) => {\n    const handlerOptions = { ...config, ...options };\n    \n    return async (...args: T): Promise<R> => {\n      try {\n        return await fn(...args);\n      } catch (error) {\n        handleError(error instanceof Error ? error : new Error(String(error)));\n        \n        if (handlerOptions.fallbackValue !== undefined) {\n          return handlerOptions.fallbackValue as R;\n        }\n        \n        throw error;\n      }\n    };\n  }, [config, handleError]);\n  \n  // Effect to clear error after some time for non-critical errors\n  useEffect(() => {\n    if (errorState.hasError && \n        errorState.severity !== 'critical' && \n        errorState.severity !== 'high') {\n      const timeout = setTimeout(() => {\n        resetError();\n      }, 10000); // Auto-clear after 10 seconds for low/medium severity\n      \n      return () => clearTimeout(timeout);\n    }\n  }, [errorState.hasError, errorState.severity, resetError]);\n  \n  return {\n    error: errorState.error,\n    errorType: errorState.errorType,\n    severity: errorState.severity,\n    hasError: errorState.hasError,\n    retryAttempt: errorState.retryAttempt,\n    handleError,\n    resetError,\n    withErrorHandling\n  };\n};\n\nexport default useErrorHandler;\n","// WebSocket configuration for enhanced connection stability\nexport const WEBSOCKET_CONFIG = {\n  // Increase timeouts to prevent premature disconnections\n  pingInterval: 30000,      // 30 seconds (was 5 seconds)\n  pingTimeout: 60000,       // 60 seconds timeout  \n  pongTimeout: 10000,       // 10 seconds for pong response\n  \n  // Connection settings\n  reconnection: true,\n  reconnectionAttempts: 5,\n  reconnectionDelay: 1000,\n  reconnectionDelayMax: 30000,\n  randomizationFactor: 0.5,\n  \n  // Transport configuration\n  transports: ['websocket', 'polling'],\n  upgrade: true,\n  rememberUpgrade: true,\n  \n  // Additional stability settings\n  closeOnBeforeunload: false,\n  withCredentials: true,\n  autoConnect: true,\n  \n  // Query parameters\n  query: {\n    version: '1.0',\n    transport: 'websocket'\n  }\n};\n\n// Connection health monitoring\nexport const HEALTH_CHECK_CONFIG = {\n  interval: 5000,           // Health check every 5 seconds\n  timeout: 10000,           // Health check timeout\n  maxFailures: 3,           // Max consecutive failures before marking unhealthy\n  retryDelay: 2000          // Delay between health check retries\n};","import React from 'react';\nimport { io, Socket } from 'socket.io-client';\nimport { MarketData, Trade } from '@/types';\nimport { useErrorHandler } from '@/hooks/useErrorHandler';\nimport { getBackendUrl, getPoloniexApiKey, getPoloniexApiSecret, shouldUseMockMode, getPoloniexWebSocketUrl } from '@/utils/environment';\nimport { WEBSOCKET_CONFIG, HEALTH_CHECK_CONFIG } from './websocket/config';\n\n// Socket.io events for internal backend\nconst SOCKET_IO_EVENTS = {\n  CONNECT: 'connect',\n  DISCONNECT: 'disconnect',\n  RECONNECT: 'reconnect',\n  RECONNECT_ATTEMPT: 'reconnect_attempt',\n  RECONNECT_ERROR: 'reconnect_error',\n  RECONNECT_FAILED: 'reconnect_failed',\n  CONNECT_ERROR: 'connect_error',\n  CONNECT_TIMEOUT: 'connect_timeout',\n  MARKET_DATA: 'marketData',\n  TRADE_EXECUTED: 'tradeExecuted',\n  CHAT_MESSAGE: 'chatMessage',\n  ERROR: 'error',\n  SUBSCRIBE_MARKET: 'subscribeMarket',\n  UNSUBSCRIBE_MARKET: 'unsubscribeMarket',\n  PING: 'ping',\n  PONG: 'pong'\n};\n\n// Poloniex V3 futures WebSocket configuration\nconst POLONIEX_WS_CONFIG = {\n  url: getPoloniexWebSocketUrl('private'), // V3 futures private stream\n  publicUrl: getPoloniexWebSocketUrl('public'), // V3 futures public stream\n  reconnectInterval: 5000,\n  maxReconnectAttempts: 10,\n  pingInterval: 30000\n};\n\n// Connection states\nexport enum ConnectionState {\n  DISCONNECTED = 'disconnected',\n  CONNECTING = 'connecting',\n  CONNECTED = 'connected',\n  RECONNECTING = 'reconnecting',\n  FAILED = 'failed'\n}\n\n// Reconnection strategies\nenum ReconnectionStrategy {\n  EXPONENTIAL_BACKOFF = 'exponential_backoff',\n  LINEAR_BACKOFF = 'linear_backoff',\n  IMMEDIATE = 'immediate',\n  NONE = 'none'\n}\n\ninterface ChatMessage {\n  userId: string;\n  username: string;\n  message: string;\n  timestamp: number;\n}\n\ninterface ConnectionConfig {\n  url: string;\n  options?: {\n    reconnectionStrategy?: ReconnectionStrategy;\n    initialReconnectDelay?: number;\n    maxReconnectDelay?: number;\n    maxReconnectAttempts?: number;\n    reconnectionJitter?: number;\n    timeout?: number;\n    pingInterval?: number;\n    pingTimeout?: number;\n    autoConnect?: boolean;\n    forceNew?: boolean;\n    transports?: string[];\n  };\n  auth?: {\n    token?: string;\n    [key: string]: any;\n  };\n}\n\ninterface ConnectionStats {\n  connectTime: number | null;\n  disconnectTime: number | null;\n  lastPingTime: number | null;\n  lastPongTime: number | null;\n  pingLatency: number | null;\n  reconnectAttempts: number;\n  successfulReconnects: number;\n  failedReconnects: number;\n  totalDisconnects: number;\n  connectionUptime: number;\n  connectionDowntime: number;\n}\n\nclass WebSocketService {\n  private static instance: WebSocketService;\n  private socket: Socket | null = null;\n  private poloniexWs: WebSocket | null = null; // Direct Poloniex WebSocket\n  private usePoloniexDirect: boolean = false; // Flag to determine connection type\n  private connectionState: ConnectionState = ConnectionState.DISCONNECTED;\n  private eventListeners: Map<string, Set<(...args: any[]) => void>> = new Map();\n  private reconnectAttempts: number = 0;\n  private maxReconnectAttempts: number = 10;\n  private initialReconnectDelay: number = 1000;\n  private maxReconnectDelay: number = 30000;\n  private reconnectionJitter: number = 0.5; // Random factor to avoid thundering herd\n  private currentReconnectDelay: number = this.initialReconnectDelay;\n  private reconnectionStrategy: ReconnectionStrategy = ReconnectionStrategy.EXPONENTIAL_BACKOFF;\n  private reconnectTimer: NodeJS.Timeout | null = null;\n  private pingTimer: NodeJS.Timeout | null = null;\n  private pingInterval: number = WEBSOCKET_CONFIG.pingInterval;\n  private pingTimeout: number = WEBSOCKET_CONFIG.pingTimeout;\n  private lastPingTime: number = 0;\n  private lastPongTime: number = 0;\n  private offlineData: Map<string, any> = new Map();\n  private connectionAttempted: boolean = false;\n  private useMockData: boolean = true; // Default to mock data\n  private healthCheckEndpoint: string = '/api/health';\n  private subscriptions: Set<string> = new Set();\n  private pendingMessages: Array<{event: string, data: any}> = [];\n  \n  // Add error logging throttling\n  private lastErrorLog: { [key: string]: number } = {};\n  private ERROR_LOG_THROTTLE_MS = 30000; // 30 seconds\n  private connectionStats: ConnectionStats = {\n    connectTime: null,\n    disconnectTime: null,\n    lastPingTime: null,\n    lastPongTime: null,\n    pingLatency: null,\n    reconnectAttempts: 0,\n    successfulReconnects: 0,\n    failedReconnects: 0,\n    totalDisconnects: 0,\n    connectionUptime: 0,\n    connectionDowntime: 0\n  };\n  \n  private config: ConnectionConfig = {\n    url: getBackendUrl(),\n    options: {\n      ...WEBSOCKET_CONFIG,\n      reconnectionStrategy: ReconnectionStrategy.EXPONENTIAL_BACKOFF,\n      initialReconnectDelay: WEBSOCKET_CONFIG.reconnectionDelay,\n      maxReconnectDelay: WEBSOCKET_CONFIG.reconnectionDelayMax,\n      maxReconnectAttempts: WEBSOCKET_CONFIG.reconnectionAttempts,\n      reconnectionJitter: WEBSOCKET_CONFIG.randomizationFactor,\n      timeout: 10000,\n      pingInterval: WEBSOCKET_CONFIG.pingInterval,\n      pingTimeout: WEBSOCKET_CONFIG.pingTimeout,\n      autoConnect: WEBSOCKET_CONFIG.autoConnect,\n      forceNew: true,\n      transports: WEBSOCKET_CONFIG.transports\n    }\n  };\n  \n  private constructor() {\n    // Determine connection strategy based on environment and credentials\n    const hasCredentials = !!(getPoloniexApiKey() && getPoloniexApiSecret());\n    const mockMode = shouldUseMockMode(hasCredentials);\n    \n    // Use direct Poloniex connection if we have credentials and not in mock mode\n    this.usePoloniexDirect = hasCredentials && !mockMode;\n    this.useMockData = mockMode;\n    \n    console.log('WebSocket Service initialized:', {\n      usePoloniexDirect: this.usePoloniexDirect,\n      useMockData: this.useMockData,\n      hasCredentials\n    });\n    \n    // Initialize offline data from localStorage if available\n    try {\n      const savedData = localStorage.getItem('websocket_offline_data');\n      if (savedData) {\n        this.offlineData = new Map(JSON.parse(savedData));\n      }\n    } catch (error) {\n      console.error('Error loading offline data:', error);\n    }\n    \n    // Listen for online/offline events\n    if (typeof window !== 'undefined') {\n      window.addEventListener('online', this.handleOnline.bind(this));\n      window.addEventListener('offline', this.handleOffline.bind(this));\n      window.addEventListener('beforeunload', this.cleanup.bind(this));\n    }\n  }\n  \n  public static getInstance(): WebSocketService {\n    if (!WebSocketService.instance) {\n      WebSocketService.instance = new WebSocketService();\n    }\n    return WebSocketService.instance;\n  }\n  \n  /**\n   * Configure the WebSocket service\n   */\n  public configure(config: Partial<ConnectionConfig>): void {\n    this.config = {\n      ...this.config,\n      ...config,\n      options: {\n        ...this.config.options,\n        ...config.options\n      },\n      auth: {\n        ...this.config.auth,\n        ...config.auth\n      }\n    };\n    \n    // Update internal settings from config\n    if (this.config.options) {\n      const { \n        reconnectionStrategy, \n        initialReconnectDelay, \n        maxReconnectDelay, \n        maxReconnectAttempts,\n        reconnectionJitter,\n        pingInterval,\n        pingTimeout\n      } = this.config.options;\n      \n      if (reconnectionStrategy) this.reconnectionStrategy = reconnectionStrategy;\n      if (initialReconnectDelay) this.initialReconnectDelay = initialReconnectDelay;\n      if (maxReconnectDelay) this.maxReconnectDelay = maxReconnectDelay;\n      if (maxReconnectAttempts) this.maxReconnectAttempts = maxReconnectAttempts;\n      if (reconnectionJitter) this.reconnectionJitter = reconnectionJitter;\n      if (pingInterval) this.pingInterval = pingInterval;\n      if (pingTimeout) this.pingTimeout = pingTimeout;\n    }\n  }\n  \n  /**\n   * Throttled logging to prevent console spam\n   */\n  private throttledLog(type: 'log' | 'warn' | 'error', key: string, message: string, ...args: any[]): void {\n    const now = Date.now();\n    const lastLog = this.lastErrorLog[key] || 0;\n    \n    if (now - lastLog > this.ERROR_LOG_THROTTLE_MS) {\n      if (import.meta.env.DEV) {\n        console[type](message, ...args);\n      }\n      this.lastErrorLog[key] = now;\n    }\n  }\n\n  /**\n   * Get current connection state\n   */\n  public getConnectionState(): ConnectionState {\n    return this.connectionState;\n  }\n  \n  /**\n   * Get connection statistics\n   */\n  public getConnectionStats(): ConnectionStats {\n    // Update uptime/downtime calculations\n    if (this.connectionState === ConnectionState.CONNECTED && this.connectionStats.connectTime) {\n      this.connectionStats.connectionUptime = Date.now() - this.connectionStats.connectTime;\n    } else if (this.connectionStats.disconnectTime) {\n      this.connectionStats.connectionDowntime = Date.now() - this.connectionStats.disconnectTime;\n    }\n    \n    return { ...this.connectionStats };\n  }\n  \n  /**\n   * Handle device coming online\n   */\n  private handleOnline(): void {\n    console.log('Device is online, attempting to reconnect WebSocket');\n    if (this.connectionState === ConnectionState.DISCONNECTED || \n        this.connectionState === ConnectionState.FAILED) {\n      this.reconnect();\n    }\n  }\n  \n  /**\n   * Handle device going offline\n   */\n  private handleOffline(): void {\n    console.log('Device is offline, WebSocket connection will be affected');\n    // We don't disconnect here as the socket will handle this automatically\n    // but we update our state to reflect the network status\n    if (this.connectionState === ConnectionState.CONNECTED) {\n      this.connectionState = ConnectionState.DISCONNECTED;\n      this.connectionStats.disconnectTime = Date.now();\n      this.connectionStats.totalDisconnects++;\n    }\n  }\n  \n  /**\n   * Clean up resources\n   */\n  private cleanup(): void {\n    this.stopPingTimer();\n    this.stopPoloniexPingTimer();\n    this.stopReconnectTimer();\n    this.disconnect();\n    \n    if (typeof window !== 'undefined') {\n      window.removeEventListener('online', this.handleOnline.bind(this));\n      window.removeEventListener('offline', this.handleOffline.bind(this));\n      window.removeEventListener('beforeunload', this.cleanup.bind(this));\n    }\n  }\n  \n  /**\n   * Calculate next reconnect delay based on strategy\n   */\n  private calculateReconnectDelay(): number {\n    let delay: number;\n    \n    switch (this.reconnectionStrategy) {\n      case ReconnectionStrategy.EXPONENTIAL_BACKOFF:\n        // Exponential backoff with jitter: delay = min(initialDelay * 2^attempts, maxDelay) * (1  jitter)\n        delay = Math.min(\n          this.initialReconnectDelay * Math.pow(2, this.reconnectAttempts),\n          this.maxReconnectDelay\n        );\n        break;\n        \n      case ReconnectionStrategy.LINEAR_BACKOFF:\n        // Linear backoff with jitter: delay = min(initialDelay * attempts, maxDelay) * (1  jitter)\n        delay = Math.min(\n          this.initialReconnectDelay * (this.reconnectAttempts + 1),\n          this.maxReconnectDelay\n        );\n        break;\n        \n      case ReconnectionStrategy.IMMEDIATE:\n        // Immediate reconnection with minimal delay\n        delay = 100;\n        break;\n        \n      case ReconnectionStrategy.NONE:\n      default:\n        // No automatic reconnection\n        return -1;\n    }\n    \n    // Apply jitter to avoid thundering herd problem\n    // Random value between (1 - jitter) and (1 + jitter)\n    const jitterFactor = 1 + (Math.random() * 2 - 1) * this.reconnectionJitter;\n    \n    return Math.floor(delay * jitterFactor);\n  }\n  \n  /**\n   * Start ping timer to detect connection issues\n   */\n  private startPingTimer(): void {\n    this.stopPingTimer();\n    \n    this.pingTimer = setInterval(() => {\n      if (this.connectionState !== ConnectionState.CONNECTED) {\n        return;\n      }\n      \n      this.lastPingTime = Date.now();\n      this.connectionStats.lastPingTime = this.lastPingTime;\n      \n      if (this.usePoloniexDirect && this.poloniexWs) {\n        // For Poloniex, the WebSocket handles ping/pong automatically\n        // We just track timing\n      } else if (this.socket) {\n        // For backend Socket.IO connection, send ping\n        this.socket.emit(SOCKET_IO_EVENTS.PING, { timestamp: this.lastPingTime });\n        \n        // Set timeout for pong response\n        setTimeout(() => {\n          const pongElapsed = this.lastPongTime - this.lastPingTime;\n          \n          // If we haven't received a pong or it's too old\n          if (pongElapsed <= 0 || pongElapsed > this.pingTimeout) {\n            this.throttledLog('warn', 'ping-timeout', `WebSocket ping timeout after ${this.pingTimeout}ms`);\n            \n            // Force disconnect and reconnect\n            if (this.socket) {\n              this.socket.disconnect();\n              this.handleDisconnect(new Error('Ping timeout'));\n            }\n          }\n        }, this.pingTimeout);\n      }\n    }, this.pingInterval);\n  }\n  \n  /**\n   * Stop ping timer\n   */\n  private stopPingTimer(): void {\n    if (this.pingTimer) {\n      clearInterval(this.pingTimer);\n      this.pingTimer = null;\n    }\n  }\n  \n  /**\n   * Stop reconnect timer\n   */\n  private stopReconnectTimer(): void {\n    if (this.reconnectTimer) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n  }\n  \n  /**\n   * Connect to Poloniex V3 futures WebSocket directly\n   */\n  private connectToPoloniex(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      try {\n        const wsUrl = POLONIEX_WS_CONFIG.publicUrl; // Start with public stream\n        \n        console.log('Connecting to Poloniex V3 futures WebSocket:', wsUrl);\n        \n        this.poloniexWs = new WebSocket(wsUrl);\n        \n        this.poloniexWs.onopen = () => {\n          console.log('Connected to Poloniex V3 futures WebSocket');\n          this.connectionState = ConnectionState.CONNECTED;\n          this.useMockData = false;\n          this.reconnectAttempts = 0;\n          \n          // Update connection stats\n          this.connectionStats.connectTime = Date.now();\n          \n          // Start ping timer\n          this.startPoloniexPingTimer();\n          \n          // Subscribe to default channels\n          this.subscribeToPoloniexChannels();\n          \n          // Notify listeners\n          this.notifyListeners('connectionStateChanged', this.connectionState);\n          \n          resolve();\n        };\n        \n        this.poloniexWs.onmessage = (event) => {\n          try {\n            const data = JSON.parse(event.data);\n            this.handlePoloniexMessage(data);\n          } catch (error) {\n            console.error('Error parsing Poloniex WebSocket message:', error);\n          }\n        };\n        \n        this.poloniexWs.onerror = (error) => {\n          console.error('Poloniex WebSocket error:', error);\n          this.handlePoloniexDisconnect();\n          reject(error);\n        };\n        \n        this.poloniexWs.onclose = () => {\n          console.log('Poloniex WebSocket connection closed');\n          this.handlePoloniexDisconnect();\n        };\n        \n      } catch (error) {\n        console.error('Failed to create Poloniex WebSocket connection:', error);\n        reject(error);\n      }\n    });\n  }\n  \n  /**\n   * Handle Poloniex WebSocket messages\n   */\n  private handlePoloniexMessage(data: any): void {\n    try {\n      // Handle different message types from Poloniex\n      if (data.channel === 'ticker' && data.data) {\n        const tickerData = Array.isArray(data.data) ? data.data : [data.data];\n        \n        tickerData.forEach((ticker: any) => {\n          const marketData: MarketData = {\n            pair: ticker.symbol?.replace('_', '-') || 'BTC-USDT',\n            timestamp: Date.now(),\n            open: parseFloat(ticker.open) || 0,\n            high: parseFloat(ticker.high) || 0,\n            low: parseFloat(ticker.low) || 0,\n            close: parseFloat(ticker.close) || 0,\n            volume: parseFloat(ticker.quantity) || 0\n          };\n          \n          this.notifyListeners(SOCKET_IO_EVENTS.MARKET_DATA, marketData);\n        });\n      } else if (data.channel === 'trades' && data.data) {\n        // Handle trades data\n        const tradesData = Array.isArray(data.data) ? data.data : [data.data];\n        \n        tradesData.forEach((trade: any) => {\n          const tradeData: Trade = {\n            id: trade.id,\n            pair: trade.symbol?.replace('_', '-') || 'BTC-USDT',\n            price: parseFloat(trade.price) || 0,\n            amount: parseFloat(trade.quantity) || 0,\n            side: trade.takerSide === 'buy' ? 'buy' : 'sell',\n            timestamp: trade.ts || Date.now()\n          };\n          \n          this.notifyListeners(SOCKET_IO_EVENTS.TRADE_EXECUTED, tradeData);\n        });\n      }\n    } catch (error) {\n      console.error('Error handling Poloniex message:', error);\n    }\n  }\n  \n  /**\n   * Subscribe to Poloniex channels\n   */\n  private subscribeToPoloniexChannels(): void {\n    if (!this.poloniexWs || this.poloniexWs.readyState !== WebSocket.OPEN) {\n      return;\n    }\n    \n    // Subscribe to ticker data for major pairs\n    const subscribeMessage = {\n      event: 'subscribe',\n      channel: ['ticker'],\n      symbols: ['BTC_USDT', 'ETH_USDT', 'SOL_USDT', 'ADA_USDT', 'DOT_USDT']\n    };\n    \n    this.poloniexWs.send(JSON.stringify(subscribeMessage));\n    console.log('Subscribed to Poloniex ticker channels');\n  }\n  \n  /**\n   * Handle Poloniex WebSocket disconnection\n   */\n  private handlePoloniexDisconnect(): void {\n    this.connectionState = ConnectionState.DISCONNECTED;\n    this.connectionStats.disconnectTime = Date.now();\n    this.connectionStats.totalDisconnects++;\n    \n    this.stopPoloniexPingTimer();\n    \n    // Notify listeners\n    this.notifyListeners('connectionStateChanged', this.connectionState);\n    \n    // Attempt to reconnect\n    this.reconnectToPoloniex();\n  }\n  \n  /**\n   * Reconnect to Poloniex WebSocket\n   */\n  private reconnectToPoloniex(): void {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.log('Max Poloniex reconnect attempts reached, switching to mock mode');\n      this.useMockData = true;\n      this.connectionState = ConnectionState.FAILED;\n      this.notifyListeners('connectionStateChanged', this.connectionState);\n      return;\n    }\n    \n    const delay = this.calculateReconnectDelay();\n    this.reconnectAttempts++;\n    this.connectionState = ConnectionState.RECONNECTING;\n    \n    console.log(`Reconnecting to Poloniex in ${delay}ms (attempt ${this.reconnectAttempts})`);\n    \n    this.reconnectTimer = setTimeout(() => {\n      this.connectToPoloniex()\n        .then(() => {\n          console.log('Poloniex reconnection successful');\n          this.connectionStats.successfulReconnects++;\n        })\n        .catch(() => {\n          console.log('Poloniex reconnection failed');\n          this.connectionStats.failedReconnects++;\n          this.reconnectToPoloniex();\n        });\n    }, delay);\n  }\n  \n  /**\n   * Start ping timer for Poloniex connection\n   */\n  private startPoloniexPingTimer(): void {\n    this.stopPoloniexPingTimer();\n    \n    this.pingTimer = setInterval(() => {\n      if (this.poloniexWs && this.poloniexWs.readyState === WebSocket.OPEN) {\n        // Poloniex WebSocket handles ping/pong automatically\n        // We just track the connection health\n        this.lastPingTime = Date.now();\n        this.connectionStats.lastPingTime = this.lastPingTime;\n      }\n    }, POLONIEX_WS_CONFIG.pingInterval);\n  }\n  \n  /**\n   * Stop ping timer for Poloniex connection\n   */\n  private stopPoloniexPingTimer(): void {\n    if (this.pingTimer) {\n      clearInterval(this.pingTimer);\n      this.pingTimer = null;\n    }\n  }\n  /**\n   * Connect to the WebSocket server (either Poloniex direct or internal backend)\n   */\n  public connect(token?: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      try {\n        // Update auth token if provided\n        if (token) {\n          this.config.auth = { ...this.config.auth, token };\n        }\n        \n        // If already connected or connecting, return immediately\n        if (this.connectionState === ConnectionState.CONNECTED) {\n          resolve();\n          return;\n        }\n        \n        if (this.connectionState === ConnectionState.CONNECTING) {\n          // Wait for connection to complete\n          const checkConnection = setInterval(() => {\n            if (this.connectionState === ConnectionState.CONNECTED) {\n              clearInterval(checkConnection);\n              resolve();\n            } else if (this.connectionState === ConnectionState.FAILED || \n                      this.connectionState === ConnectionState.DISCONNECTED) {\n              clearInterval(checkConnection);\n              reject(new Error('Connection failed'));\n            }\n          }, 100);\n          return;\n        }\n        \n        // Reset reconnect attempts on new connection\n        this.reconnectAttempts = 0;\n        this.currentReconnectDelay = this.initialReconnectDelay;\n        this.connectionState = ConnectionState.CONNECTING;\n        \n        // If we already attempted to connect and failed, don't retry\n        if (this.connectionAttempted && this.useMockData) {\n          this.throttledLog('log', 'using-mock-data', 'Using mock data (previous connection attempt failed)');\n          this.connectionState = ConnectionState.FAILED;\n          resolve();\n          return;\n        }\n        \n        this.connectionAttempted = true;\n        \n        // Choose connection method based on configuration\n        if (this.usePoloniexDirect) {\n          console.info('Attempting direct Poloniex V3 futures WebSocket connection...');\n          this.connectToPoloniex()\n            .then(() => {\n              resolve();\n            })\n            .catch((error) => {\n              console.warn('Failed to connect to Poloniex, falling back to mock mode:', error);\n              this.useMockData = true;\n              this.connectionState = ConnectionState.FAILED;\n              resolve();\n            });\n        } else {\n          console.info('Attempting internal backend WebSocket connection...');\n          this.connectToBackend(token)\n            .then(() => {\n              resolve();\n            })\n            .catch((error) => {\n              console.warn('Failed to connect to backend, using mock mode:', error);\n              this.useMockData = true;\n              this.connectionState = ConnectionState.FAILED;\n              resolve();\n            });\n        }\n      } catch (error) {\n        this.throttledLog('error', 'websocket-connection-error', 'WebSocket connection error:', error instanceof Error ? error.message : String(error));\n        this.useMockData = true;\n        this.connectionState = ConnectionState.FAILED;\n        resolve();\n      }\n    });\n  }\n  \n  /**\n   * Connect to internal backend (original Socket.IO logic)\n   */\n  private connectToBackend(token?: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      try {\n        if (import.meta.env.DEV) {\n          console.info('Attempting internal backend WebSocket connection...');\n        }\n        \n        // Set a connection timeout\n        const connectionTimeout = setTimeout(() => {\n          this.throttledLog('warn', 'connection-timeout', `WebSocket connection timed out after ${this.config.options?.timeout || 10000}ms`);\n          this.connectionState = ConnectionState.FAILED;\n          this.useMockData = true;\n          resolve();\n        }, this.config.options?.timeout || 10000);\n        \n        // In WebContainer environment, always use mock data\n        // WebSocket connections outside the container domain aren't possible\n        if (typeof window !== 'undefined' && window.location && window.location.hostname.includes('webcontainer-api.io')) {\n          this.useMockData = true;\n          this.connectionState = ConnectionState.FAILED;\n          clearTimeout(connectionTimeout);\n          this.throttledLog('log', 'webcontainer-mock', 'Running in WebContainer environment, defaulting to mock data');\n          resolve();\n          return;\n        }\n        \n        // Check if server is available before attempting socket connection\n        fetch(this.config.url + this.healthCheckEndpoint, { \n          method: 'GET',\n          signal: AbortSignal.timeout(5000) // 5s timeout for the health check\n        })\n        .then(response => {\n          if (!response.ok) throw new Error('Server health check failed');\n          return response.json();\n        })\n        .then(() => {\n          // Server is available, attempt WebSocket connection\n          clearTimeout(connectionTimeout);\n          \n          // Configure socket.io options with enhanced stability settings\n          const socketOptions = {\n            auth: this.config.auth,\n            transports: this.config.options?.transports || ['websocket', 'polling'],\n            reconnection: false, // We handle reconnection ourselves\n            timeout: this.config.options?.timeout || 10000,\n            forceNew: this.config.options?.forceNew || true,\n            autoConnect: this.config.options?.autoConnect !== undefined ? \n                        this.config.options.autoConnect : false,\n            // Additional stability settings\n            closeOnBeforeunload: false,\n            withCredentials: true,\n            upgrade: true\n          };\n          \n          this.socket = io(this.config.url, socketOptions);\n          \n          // Set up event handlers\n          this.setupSocketEventHandlers();\n          \n          // Connect if autoConnect is false\n          if (!socketOptions.autoConnect) {\n            this.socket.connect();\n          }\n          \n          resolve();\n        })\n        .catch(error => {\n          // Server is not available, use mock data\n          clearTimeout(connectionTimeout);\n          this.throttledLog('log', 'server-unavailable', 'Server not available, using mock data:', error.message);\n          this.useMockData = true;\n          this.connectionState = ConnectionState.FAILED;\n          resolve();\n        });\n      } catch (error) {\n        this.throttledLog('error', 'websocket-connection-error', 'WebSocket connection error:', error instanceof Error ? error.message : String(error));\n        this.useMockData = true;\n        this.connectionState = ConnectionState.FAILED;\n        resolve();\n      }\n    });\n  }\n  \n  /**\n   * Set up socket event handlers\n   */\n  private setupSocketEventHandlers(): void {\n    if (!this.socket) return;\n    \n    // Connection events\n    this.socket.on(SOCKET_IO_EVENTS.CONNECT, () => {\n      console.log('WebSocket connected successfully');\n      this.connectionState = ConnectionState.CONNECTED;\n      this.useMockData = false;\n      this.reconnectAttempts = 0;\n      this.currentReconnectDelay = this.initialReconnectDelay;\n      \n      // Update connection stats\n      this.connectionStats.connectTime = Date.now();\n      \n      // Start ping timer\n      this.startPingTimer();\n      \n      // Resubscribe to previous subscriptions\n      this.resubscribe();\n      \n      // Send any pending messages\n      this.sendPendingMessages();\n      \n      // Notify listeners\n      this.notifyListeners('connectionStateChanged', this.connectionState);\n    });\n    \n    this.socket.on(SOCKET_IO_EVENTS.DISCONNECT, (reason) => {\n      this.throttledLog('log', 'websocket-disconnect', `WebSocket disconnected: ${reason}`);\n      this.handleDisconnect(new Error(reason));\n    });\n    \n    this.socket.on(SOCKET_IO_EVENTS.CONNECT_ERROR, (error) => {\n      this.throttledLog('error', 'websocket-connect-error', 'WebSocket connection error:', error);\n      this.handleDisconnect(error);\n    });\n    \n    this.socket.on(SOCKET_IO_EVENTS.CONNECT_TIMEOUT, () => {\n      this.throttledLog('error', 'websocket-timeout', 'WebSocket connection timeout');\n      this.handleDisconnect(new Error('Connection timeout'));\n    });\n    \n    // Ping/pong for connection health monitoring\n    this.socket.on(SOCKET_IO_EVENTS.PONG, (data: { timestamp: number }) => {\n      this.lastPongTime = Date.now();\n      this.connectionStats.lastPongTime = this.lastPongTime;\n      \n      // Calculate ping latency\n      if (data && data.timestamp) {\n        this.connectionStats.pingLatency = this.lastPongTime - data.timestamp;\n      }\n    });\n    \n    // Data events\n    this.socket.on(SOCKET_IO_EVENTS.MARKET_DATA, (data: MarketData) => {\n      this.notifyListeners(SOCKET_IO_EVENTS.MARKET_DATA, data);\n    });\n    \n    this.socket.on(SOCKET_IO_EVENTS.TRADE_EXECUTED, (data: Trade) => {\n      this.notifyListeners(SOCKET_IO_EVENTS.TRADE_EXECUTED, data);\n    });\n    \n    this.socket.on(SOCKET_IO_EVENTS.CHAT_MESSAGE, (data: ChatMessage) => {\n      this.notifyListeners(SOCKET_IO_EVENTS.CHAT_MESSAGE, data);\n    });\n    \n    this.socket.on(SOCKET_IO_EVENTS.ERROR, (error) => {\n      console.error('WebSocket error:', typeof error === 'object' ? JSON.stringify(error) : error);\n      this.notifyListeners(SOCKET_IO_EVENTS.ERROR, error);\n    });\n  }\n  \n  /**\n   * Resubscribe to previous subscriptions after reconnect\n   */\n  private resubscribe(): void {\n    if (!this.isConnected()) return;\n    \n    console.log(`Resubscribing to ${this.subscriptions.size} channels`);\n    \n    this.subscriptions.forEach(subscription => {\n      if (this.usePoloniexDirect && this.poloniexWs) {\n        // For Poloniex direct connection, send subscription message\n        const subscribeMessage = {\n          event: 'subscribe',\n          channel: ['ticker'],\n          symbols: [subscription.replace('-', '_')]\n        };\n        this.poloniexWs.send(JSON.stringify(subscribeMessage));\n      } else if (this.socket) {\n        // For backend connection, use Socket.IO events\n        this.socket.emit(SOCKET_IO_EVENTS.SUBSCRIBE_MARKET, { pair: subscription });\n      }\n    });\n  }\n  \n  /**\n   * Send any pending messages after reconnect\n   */\n  private sendPendingMessages(): void {\n    if (!this.isConnected()) return;\n    \n    console.log(`Sending ${this.pendingMessages.length} pending messages`);\n    \n    while (this.pendingMessages.length > 0) {\n      const message = this.pendingMessages.shift();\n      if (message) {\n        if (this.usePoloniexDirect && this.poloniexWs) {\n          // For Poloniex direct connection, send as JSON\n          this.poloniexWs.send(JSON.stringify(message));\n        } else if (this.socket) {\n          // For backend connection, use Socket.IO events\n          this.socket.emit(message.event, message.data);\n        }\n      }\n    }\n  }\n  \n  /**\n   * Handle WebSocket disconnection with reconnect logic\n   */\n  private handleDisconnect(error: Error): void {\n    // Update connection state and stats\n    this.connectionState = ConnectionState.DISCONNECTED;\n    this.connectionStats.disconnectTime = Date.now();\n    this.connectionStats.totalDisconnects++;\n    \n    // Stop ping timer\n    this.stopPingTimer();\n    \n    // Notify listeners\n    this.notifyListeners('connectionStateChanged', this.connectionState);\n    this.notifyListeners(EVENTS.ERROR, error);\n    \n    // If reconnection strategy is NONE, don't attempt to reconnect\n    if (this.reconnectionStrategy === ReconnectionStrategy.NONE) {\n      this.useMockData = true;\n      return;\n    }\n    \n    // Attempt to reconnect\n    this.reconnect();\n  }\n  \n  /**\n   * Attempt to reconnect to the WebSocket server\n   */\n  private reconnect(): void {\n    // Stop any existing reconnect timer\n    this.stopReconnectTimer();\n    \n    // Check if we've reached the maximum number of reconnect attempts\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.log(`Max reconnection attempts (${this.maxReconnectAttempts}) reached, staying in mock mode`);\n      this.connectionState = ConnectionState.FAILED;\n      this.useMockData = true;\n      this.connectionStats.failedReconnects++;\n      \n      // Notify listeners\n      this.notifyListeners('connectionStateChanged', this.connectionState);\n      return;\n    }\n    \n    // Calculate delay for next reconnect attempt\n    const delay = this.calculateReconnectDelay();\n    \n    // If delay is negative, don't reconnect\n    if (delay < 0) {\n      console.log('Reconnection strategy is NONE, not attempting to reconnect');\n      this.connectionState = ConnectionState.FAILED;\n      this.useMockData = true;\n      return;\n    }\n    \n    // Update state and stats\n    this.reconnectAttempts++;\n    this.connectionState = ConnectionState.RECONNECTING;\n    this.connectionStats.reconnectAttempts++;\n    \n    // Notify listeners\n    this.notifyListeners('connectionStateChanged', this.connectionState);\n    \n    console.log(`Attempting reconnect ${this.reconnectAttempts}/${this.maxReconnectAttempts} in ${delay}ms`);\n    \n    // Schedule reconnect attempt\n    this.reconnectTimer = setTimeout(() => {\n      // Create a new socket connection\n      this.connect()\n        .then(() => {\n          if (this.connectionState === ConnectionState.CONNECTED) {\n            console.log('Reconnected successfully');\n            this.connectionStats.successfulReconnects++;\n          } else {\n            console.log('Reconnect attempt failed');\n            this.connectionStats.failedReconnects++;\n            // Continue with reconnection attempts\n            this.reconnect();\n          }\n        })\n        .catch(() => {\n          console.log('Reconnect attempt failed with error');\n          this.connectionStats.failedReconnects++;\n          // Continue with reconnection attempts\n          this.reconnect();\n        });\n    }, delay);\n  }\n  \n  /**\n   * Check if WebSocket is connected\n   */\n  public isConnected(): boolean {\n    if (this.usePoloniexDirect) {\n      return this.connectionState === ConnectionState.CONNECTED && \n             this.poloniexWs !== null && \n             this.poloniexWs.readyState === WebSocket.OPEN;\n    } else {\n      return this.connectionState === ConnectionState.CONNECTED && this.socket !== null;\n    }\n  }\n  \n  /**\n   * Check if we're using mock data\n   */\n  public isMockMode(): boolean {\n    return this.useMockData;\n  }\n  \n  /**\n   * Save data for offline access\n   */\n  private saveOfflineData(key: string, data: any): void {\n    try {\n      this.offlineData.set(key, data);\n      localStorage.setItem('websocket_offline_data', JSON.stringify(Array.from(this.offlineData.entries())));\n    } catch (error) {\n      console.error('Error saving offline data:', error);\n    }\n  }\n  \n  /**\n   * Subscribe to market data for a specific pair\n   */\n  public subscribeToMarket(pair: string): void {\n    // Add to subscriptions set\n    this.subscriptions.add(pair);\n    \n    if (!this.isConnected()) {\n      console.log('WebSocket not connected, skipping market subscription');\n      // Try to load offline data\n      const offlineData = this.offlineData.get(`market_${pair}`);\n      if (offlineData) {\n        this.notifyListeners(SOCKET_IO_EVENTS.MARKET_DATA, offlineData);\n      }\n      return;\n    }\n    \n    if (this.usePoloniexDirect && this.poloniexWs) {\n      // For Poloniex direct connection\n      const subscribeMessage = {\n        event: 'subscribe',\n        channel: ['ticker'],\n        symbols: [pair.replace('-', '_')]\n      };\n      this.poloniexWs.send(JSON.stringify(subscribeMessage));\n    } else if (this.socket) {\n      // For backend Socket.IO connection\n      this.socket.emit(SOCKET_IO_EVENTS.SUBSCRIBE_MARKET, { pair });\n    }\n  }\n  \n  /**\n   * Unsubscribe from market data for a specific pair\n   */\n  public unsubscribeFromMarket(pair: string): void {\n    // Remove from subscriptions set\n    this.subscriptions.delete(pair);\n    \n    if (!this.isConnected()) {\n      return;\n    }\n    \n    if (this.usePoloniexDirect && this.poloniexWs) {\n      // For Poloniex direct connection\n      const unsubscribeMessage = {\n        event: 'unsubscribe',\n        channel: ['ticker'],\n        symbols: [pair.replace('-', '_')]\n      };\n      this.poloniexWs.send(JSON.stringify(unsubscribeMessage));\n    } else if (this.socket) {\n      // For backend Socket.IO connection\n      this.socket.emit(SOCKET_IO_EVENTS.UNSUBSCRIBE_MARKET, { pair });\n    }\n  }\n  \n  /**\n   * Send a message to the server\n   */\n  public send(event: string, data: any): void {\n    if (!this.isConnected()) {\n      console.log(`WebSocket not connected, queueing message: ${event}`);\n      // Queue message to be sent when connection is established\n      this.pendingMessages.push({ event, data });\n      return;\n    }\n    \n    if (this.usePoloniexDirect && this.poloniexWs) {\n      // For Poloniex direct connection, send as JSON\n      const message = { event, ...data };\n      this.poloniexWs.send(JSON.stringify(message));\n    } else if (this.socket) {\n      // For backend Socket.IO connection\n      this.socket.emit(event, data);\n    }\n  }\n  \n  /**\n   * Send a chat message\n   */\n  public sendChatMessage(message: string, username: string): void {\n    this.send(SOCKET_IO_EVENTS.CHAT_MESSAGE, {\n      message,\n      username,\n      timestamp: Date.now(),\n    });\n  }\n  \n  /**\n   * Register an event listener\n   */\n  public on(event: string, callback: (...args: any[]) => void): void {\n    if (!this.eventListeners.has(event)) {\n      this.eventListeners.set(event, new Set());\n    }\n    \n    this.eventListeners.get(event)?.add(callback);\n  }\n  \n  /**\n   * Remove an event listener\n   */\n  public off(event: string, callback: (...args: any[]) => void): void {\n    if (!this.eventListeners.has(event)) return;\n    \n    this.eventListeners.get(event)?.delete(callback);\n  }\n  \n  /**\n   * Notify all listeners for a specific event\n   */\n  private notifyListeners(event: string, data: any): void {\n    if (!this.eventListeners.has(event)) return;\n    \n    // Save data for offline access if it's a data event\n    if (event === SOCKET_IO_EVENTS.MARKET_DATA || event === SOCKET_IO_EVENTS.TRADE_EXECUTED) {\n      this.saveOfflineData(event, data);\n    }\n    \n    this.eventListeners.get(event)?.forEach(callback => {\n      try {\n        callback(data);\n      } catch (error) {\n        console.error(`Error in ${event} event listener:`, error instanceof Error ? error.message : String(error));\n      }\n    });\n  }\n  \n  /**\n   * Disconnect from the WebSocket server\n   */\n  public disconnect(): void {\n    // Stop timers\n    this.stopPingTimer();\n    this.stopPoloniexPingTimer();\n    this.stopReconnectTimer();\n    \n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n    }\n    \n    if (this.poloniexWs) {\n      this.poloniexWs.close();\n      this.poloniexWs = null;\n    }\n    \n    this.connectionState = ConnectionState.DISCONNECTED;\n    this.notifyListeners('connectionStateChanged', this.connectionState);\n  }\n\n  /**\n   * Handle page visibility change\n   * When page becomes hidden, we maintain connection but reduce activity\n   * When page becomes visible, we ensure connection is active\n   */\n  public handlePageVisibilityChange(isVisible: boolean): void {\n    if (isVisible) {\n      // Page visible - ensure connection is active\n      console.log('Page visible - ensuring WebSocket connection is active');\n      if (this.connectionState === ConnectionState.DISCONNECTED || \n          this.connectionState === ConnectionState.FAILED) {\n        this.connect();\n      }\n    } else {\n      // Page hidden - maintain connection but log the state\n      console.log('Page hidden - maintaining WebSocket connection in background');\n      // We don't disconnect on tab blur to maintain real-time data flow\n    }\n  }\n\n  /**\n   * Get connection health information\n   */\n  public getConnectionHealth(): {\n    state: ConnectionState;\n    isHealthy: boolean;\n    uptime: number;\n    lastPing: number;\n    latency: number | null;\n    reconnectAttempts: number;\n  } {\n    const now = Date.now();\n    const uptime = this.connectionStats.connectTime ? \n      now - this.connectionStats.connectTime : 0;\n    \n    return {\n      state: this.connectionState,\n      isHealthy: this.connectionState === ConnectionState.CONNECTED,\n      uptime,\n      lastPing: this.connectionStats.lastPingTime || 0,\n      latency: this.connectionStats.pingLatency,\n      reconnectAttempts: this.reconnectAttempts\n    };\n  }\n\n  /**\n   * Send market data to other connected clients\n   * This is primarily for testing without a backend\n   */\n  public broadcastMarketData(data: MarketData): void {\n    if (this.useMockData) {\n      // When in mock mode, simulate receiving the data from server\n      setTimeout(() => {\n        this.notifyListeners(SOCKET_IO_EVENTS.MARKET_DATA, data);\n      }, 100);\n    } else if (this.isConnected()) {\n      // When connected to real server, emit the data\n      this.send(SOCKET_IO_EVENTS.MARKET_DATA, data);\n    }\n  }\n\n  /**\n   * Send trade data to other connected clients\n   * This is primarily for testing without a backend\n   */\n  public broadcastTradeExecuted(data: Trade): void {\n    if (this.useMockData) {\n      // When in mock mode, simulate receiving the data from server\n      setTimeout(() => {\n        this.notifyListeners(SOCKET_IO_EVENTS.TRADE_EXECUTED, data);\n      }, 100);\n    } else if (this.isConnected()) {\n      // When connected to real server, emit the data\n      this.send(SOCKET_IO_EVENTS.TRADE_EXECUTED, data);\n    }\n  }\n  \n  /**\n   * Get a hook for monitoring connection state\n   */\n  public useConnectionState() {\n    const [state, setState] = React.useState(this.connectionState);\n    \n    React.useEffect(() => {\n      const handleStateChange = (newState: ConnectionState) => {\n        setState(newState);\n      };\n      \n      this.on('connectionStateChanged', handleStateChange);\n      \n      return () => {\n        this.off('connectionStateChanged', handleStateChange);\n      };\n    }, []);\n    \n    return state;\n  }\n}\n\n// Export a singleton instance\nexport const webSocketService = WebSocketService.getInstance();\n\n// Hook for using WebSocket in React components\nexport const useWebSocket = () => {\n  const [connectionState, setConnectionState] = React.useState<ConnectionState>(\n    webSocketService.getConnectionState()\n  );\n  const [isMockMode, setIsMockMode] = React.useState<boolean>(\n    webSocketService.isMockMode()\n  );\n  const errorHandler = useErrorHandler();\n  \n  React.useEffect(() => {\n    const handleStateChange = (state: ConnectionState) => {\n      setConnectionState(state);\n      setIsMockMode(webSocketService.isMockMode());\n      \n      // Handle connection errors\n      if (state === ConnectionState.FAILED) {\n        errorHandler.handleError(new Error('WebSocket connection failed after multiple attempts'));\n      }\n    };\n    \n    webSocketService.on('connectionStateChanged', handleStateChange);\n    \n    return () => {\n      webSocketService.off('connectionStateChanged', handleStateChange);\n    };\n  }, [errorHandler]);\n  \n  return {\n    connectionState,\n    isMockMode,\n    isConnected: webSocketService.isConnected(),\n    connect: webSocketService.connect.bind(webSocketService),\n    disconnect: webSocketService.disconnect.bind(webSocketService),\n    subscribe: webSocketService.subscribeToMarket.bind(webSocketService),\n    unsubscribe: webSocketService.unsubscribeFromMarket.bind(webSocketService),\n    send: webSocketService.send.bind(webSocketService),\n    on: webSocketService.on.bind(webSocketService),\n    off: webSocketService.off.bind(webSocketService),\n    getStats: webSocketService.getConnectionStats.bind(webSocketService)\n  };\n};\n","import { useState, useEffect, useCallback, useRef } from 'react';\nimport { poloniexApi } from '@/services/poloniexAPI';\nimport { MarketData, Trade } from '@/types';\nimport { webSocketService } from '@/services/websocketService';\nimport { mockMarketData, mockTrades } from '@/data/mockData';\nimport { useSettings } from '@/hooks/useSettings';\nimport { shouldUseMockMode, IS_WEBCONTAINER } from '@/utils/environment';\n\ninterface PoloniexDataHook {\n  marketData: MarketData[];\n  trades: Trade[];\n  accountBalance: any;\n  isLoading: boolean;\n  error: Error | null;\n  isMockMode: boolean;\n  fetchMarketData: (pair: string) => Promise<void>;\n  fetchTrades: (pair: string) => Promise<void>;\n  fetchAccountBalance: () => Promise<void>;\n  refreshApiConnection: () => void;\n}\n\nexport const usePoloniexData = (initialPair: string = 'BTC-USDT'): PoloniexDataHook => {\n  const { apiKey, apiSecret, isLiveTrading } = useSettings();\n  const [marketData, setMarketData] = useState<MarketData[]>(mockMarketData);\n  const [trades, setTrades] = useState<Trade[]>(mockTrades);\n  const [accountBalance, setAccountBalance] = useState<any>(null);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [error, setError] = useState<Error | null>(null);\n  \n  // Determine mock mode based on environment and credentials\n  const hasCredentials = Boolean(apiKey && apiSecret);\n  const [isMockMode, setIsMockMode] = useState<boolean>(shouldUseMockMode(hasCredentials));\n\n  // Create refs to hold latest function references to avoid dependency issues\n  const fetchFunctionsRef = useRef<{\n    fetchMarketData: (pair: string) => Promise<void>;\n    fetchTrades: (pair: string) => Promise<void>;\n    fetchAccountBalance: () => Promise<void>;\n  }>();\n\n  // Helper function to map Poloniex data to MarketData format\n  \n  const mapPoloniexDataToMarketData = useCallback((data: any[]): MarketData[] => {\n    try {\n      return data.map(item => ({\n        pair: initialPair,\n        timestamp: new Date(item[0]).getTime(),\n        open: parseFloat(item[1]),\n        high: parseFloat(item[2]),\n        low: parseFloat(item[3]),\n        close: parseFloat(item[4]),\n        volume: parseFloat(item[5])\n      }));\n    } catch (err) {\n      console.error('Error mapping Poloniex data:', err instanceof Error ? err.message : String(err));\n      return [];\n    }\n  }, [initialPair]);\n  \n  const mapPoloniexTradeToTrade = useCallback((trade: any): Trade => {\n    try {\n      return {\n        id: trade.id || `generated-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`,\n        pair: initialPair,\n        timestamp: new Date(trade.createdAt).getTime(),\n        type: trade.takerSide === 'buy' ? 'BUY' : 'SELL',\n        price: parseFloat(trade.price),\n        amount: parseFloat(trade.quantity),\n        total: parseFloat(trade.price) * parseFloat(trade.quantity),\n        strategyId: '', // Not available from API\n        status: 'COMPLETED'\n      };\n    } catch (err) {\n      console.error('Error mapping Poloniex trade:', err instanceof Error ? err.message : String(err));\n      return {\n        id: `error-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`,\n        pair: initialPair,\n        timestamp: Date.now(),\n        type: 'BUY',\n        price: 0,\n        amount: 0,\n        total: 0,\n        strategyId: '',\n        status: 'FAILED'\n      };\n    }\n  }, [initialPair]);\n\n  // Fetch functions defined before refreshApiConnection\n  const fetchMarketData = useCallback(async (pair: string) => {\n    // If in mock mode, use mock data immediately\n    if (isMockMode) {\n      if (import.meta.env.DEV) {\n        console.info('Mock mode active, using mock market data');\n      }\n      setMarketData(mockMarketData);\n      return;\n    }\n    \n    // In WebContainer, use mock data for development\n    if (IS_WEBCONTAINER) {\n      if (import.meta.env.DEV) {\n        console.info('WebContainer environment detected, using mock market data');\n      }\n      setMarketData(mockMarketData);\n      return;\n    }\n    \n    setIsLoading(true);\n    setError(null);\n    \n    try {\n      const data = await poloniexApi.getMarketData(pair);\n      \n      if (data && Array.isArray(data)) {\n        const formattedData = mapPoloniexDataToMarketData(data);\n        if (formattedData.length > 0) {\n          setMarketData(formattedData);\n        } else {\n          throw new Error('No market data returned from API');\n        }\n      } else {\n        throw new Error('Invalid market data format received from API');\n      }\n    } catch (err) {\n      const error = err as Error;\n      console.error('Error fetching market data:', error.message);\n      setError(error);\n      // Don't fall back to mock data - let the UI handle the error\n    } finally {\n      setIsLoading(false);\n    }\n  }, [isMockMode, mapPoloniexDataToMarketData]);\n  \n  const fetchTrades = useCallback(async (pair: string) => {\n    // If in mock mode, use mock data immediately  \n    if (isMockMode) {\n      if (import.meta.env.DEV) {\n        console.info('Mock mode active, using mock trades data');\n      }\n      setTrades(mockTrades);\n      return;\n    }\n    \n    // In WebContainer, use mock data for development\n    if (IS_WEBCONTAINER) {\n      if (import.meta.env.DEV) {\n        console.info('WebContainer environment detected, using mock trades data');\n      }\n      setTrades(mockTrades);\n      return;\n    }\n    \n    setIsLoading(true);\n    \n    try {\n      const data = await poloniexApi.getRecentTrades(pair);\n      \n      if (data && Array.isArray(data)) {\n        const formattedTrades = data.map(mapPoloniexTradeToTrade).filter(trade => \n          trade.id.indexOf('error-') !== 0 && !isNaN(trade.price) && !isNaN(trade.amount)\n        );\n        \n        if (formattedTrades.length > 0) {\n          setTrades(formattedTrades);\n        } else {\n          throw new Error('No valid trades returned from API');\n        }\n      } else {\n        throw new Error('Invalid trades data format received from API');\n      }\n    } catch (err) {\n      const error = err as Error;\n      console.error('Error fetching trades:', error.message);\n      setError(error);\n      // Don't fall back to mock data - let the UI handle the error\n    } finally {\n      setIsLoading(false);\n    }\n  }, [isMockMode, mapPoloniexTradeToTrade]);\n  \n  const fetchAccountBalance = useCallback(async () => {\n    // If in mock mode, use mock data immediately\n    if (isMockMode) {\n      if (import.meta.env.DEV) {\n        console.info('Mock mode active, using mock account data');\n      }\n      setAccountBalance({\n        totalAmount: \"15478.23\",\n        availableAmount: \"12345.67\",\n        accountEquity: \"15820.45\",\n        unrealizedPnL: \"342.22\",\n        todayPnL: \"156.78\",\n        todayPnLPercentage: \"1.02\"\n      });\n      return;\n    }\n    \n    // In WebContainer, use mock data for development\n    if (IS_WEBCONTAINER) {\n      if (import.meta.env.DEV) {\n        console.info('WebContainer environment detected, using mock account data');\n      }\n      setAccountBalance({\n        totalAmount: \"15478.23\",\n        availableAmount: \"12345.67\",\n        accountEquity: \"15820.45\",\n        unrealizedPnL: \"342.22\",\n        todayPnL: \"156.78\",\n        todayPnLPercentage: \"1.02\"\n      });\n      return;\n    }\n    \n    setIsLoading(true);\n    \n    try {\n      const data = await poloniexApi.getAccountBalance();\n      setAccountBalance(data);\n    } catch (err) {\n      const error = err as Error;\n      console.error('Error fetching account balance:', error.message);\n      setError(error);\n      // Don't fall back to mock data - let the UI handle the error\n    } finally {\n      setIsLoading(false);\n    }\n  }, [isMockMode]);\n\n  // Update function refs to latest versions\n  fetchFunctionsRef.current = {\n    fetchMarketData,\n    fetchTrades,\n    fetchAccountBalance\n  };\n\n  // Function to refresh API connection when settings change - defined after all dependencies\n  const refreshApiConnection = useCallback(() => {\n    if (import.meta.env.DEV) {\n      console.info('Refreshing API connection with new credentials');\n    }\n    setIsLoading(true);\n    poloniexApi.loadCredentials();\n    \n    // Clear any existing errors\n    setError(null);\n    \n    // Refresh data with new credentials\n    Promise.all([\n      fetchMarketData(initialPair),\n      fetchTrades(initialPair),\n      fetchAccountBalance()\n    ]).finally(() => {\n      setIsLoading(false);\n    });\n  }, [initialPair, fetchMarketData, fetchTrades, fetchAccountBalance]);\n\n  // Update mock mode when credentials change\n  useEffect(() => {\n    const newHasCredentials = Boolean(apiKey && apiSecret);\n    const newMockMode = shouldUseMockMode(newHasCredentials) || !isLiveTrading;\n    setIsMockMode(newMockMode);\n    \n    if (isLiveTrading && newHasCredentials && !newMockMode) {\n      if (import.meta.env.DEV) {\n        console.info('Live trading enabled with credentials, refreshing API connection');\n      }\n      poloniexApi.loadCredentials();\n      \n      // Manually trigger data refresh without causing dependency loop\n      setIsLoading(true);\n      setError(null);\n      \n      // Use the ref functions to avoid dependency loop\n      if (fetchFunctionsRef.current) {\n        Promise.all([\n          fetchFunctionsRef.current.fetchMarketData(initialPair),\n          fetchFunctionsRef.current.fetchTrades(initialPair),\n          fetchFunctionsRef.current.fetchAccountBalance()\n        ]).finally(() => {\n          setIsLoading(false);\n        });\n      }\n    } else {\n      if (import.meta.env.DEV) {\n        console.info('Using mock mode - live trading disabled or missing credentials');\n      }\n    }\n  }, [isLiveTrading, apiKey, apiSecret, initialPair]);\n\n  // Handle real-time updates via WebSocket\n  useEffect(() => {\n    // In WebContainer, skip WebSocket connection and use mock data immediately\n    if (IS_WEBCONTAINER) {\n      if (import.meta.env.DEV) {\n        console.info('WebContainer environment detected, using mock data instead of WebSocket');\n      }\n      setIsMockMode(true);\n      setMarketData(mockMarketData);\n      setTrades(mockTrades);\n      \n      // Skip the rest of the WebSocket setup\n      return () => {}; // Empty cleanup function\n    }\n    \n    // Connect to WebSocket for non-WebContainer environments\n    webSocketService.connect()\n      .then(() => {\n        if (import.meta.env.DEV) {\n          console.info('WebSocket setup complete');\n        }\n        \n        // Check if we're in mock mode from the WebSocket service\n        setIsMockMode(webSocketService.isMockMode());\n        \n        // Only subscribe if connection was successful\n        if (webSocketService.isConnected()) {\n          webSocketService.subscribeToMarket(initialPair);\n        } else {\n          if (import.meta.env.DEV) {\n            console.info('Using mock data mode');\n          }\n          // Initialize with mock data if WebSocket connection failed\n          setMarketData(mockMarketData);\n          setTrades(mockTrades);\n        }\n      })\n      .catch(err => {\n        console.error('Error connecting to WebSocket:', err instanceof Error ? err.message : String(err));\n        setIsMockMode(true);\n        setMarketData(mockMarketData);\n        setTrades(mockTrades);\n      });\n    \n    // Listen for market data updates\n    const handleMarketDataUpdate = (data: MarketData) => {\n      if (data.pair === initialPair) {\n        setMarketData(prevData => {\n          // Find if this timestamp already exists\n          const existingIndex = prevData.findIndex(item => item.timestamp === data.timestamp);\n          \n          if (existingIndex >= 0) {\n            // Update existing data\n            const updatedData = [...prevData];\n            updatedData[existingIndex] = data;\n            return updatedData;\n          } else {\n            // Add new data and maintain order\n            const newData = [...prevData, data];\n            return newData.sort((a, b) => a.timestamp - b.timestamp);\n          }\n        });\n      }\n    };\n    \n    // Listen for trade updates\n    const handleTradeUpdate = (trade: Trade) => {\n      if (trade.pair === initialPair) {\n        setTrades(prevTrades => {\n          // Check if trade already exists\n          if (!prevTrades.some(t => t.id === trade.id)) {\n            return [trade, ...prevTrades].slice(0, 50); // Keep last 50 trades\n          }\n          return prevTrades;\n        });\n      }\n    };\n    \n    webSocketService.on('marketData', handleMarketDataUpdate);\n    webSocketService.on('tradeExecuted', handleTradeUpdate);\n    \n    // Initial data fetch with small delay to avoid overwhelming the browser\n    setTimeout(() => {\n      if (fetchFunctionsRef.current) {\n        fetchFunctionsRef.current.fetchMarketData(initialPair);\n        setTimeout(() => {\n          if (fetchFunctionsRef.current) {\n            fetchFunctionsRef.current.fetchTrades(initialPair);\n            setTimeout(() => {\n              if (fetchFunctionsRef.current) {\n                fetchFunctionsRef.current.fetchAccountBalance();\n              }\n            }, 500);\n          }\n        }, 500);\n      }\n    }, 500);\n    \n    // Cleanup\n    return () => {\n      webSocketService.off('marketData', handleMarketDataUpdate);\n      webSocketService.off('tradeExecuted', handleTradeUpdate);\n      if (webSocketService.isConnected()) {\n        webSocketService.unsubscribeFromMarket(initialPair);\n      }\n    };\n  }, [initialPair]);\n  \n  return {\n    marketData,\n    trades,\n    accountBalance,\n    isLoading,\n    error,\n    isMockMode,\n    fetchMarketData,\n    fetchTrades,\n    fetchAccountBalance,\n    refreshApiConnection\n  };\n};\n","import React, { createContext, useState, ReactNode, useEffect, useCallback } from 'react';\nimport { Strategy, StrategyType, MarketData, Trade, MovingAverageCrossoverParameters } from '../types';\nimport { mockMarketData, mockTrades } from '../data/mockData';\nimport { usePoloniexData } from '../hooks/usePoloniexData';\nimport { poloniexApi } from '../services/poloniexAPI';\n\ninterface TradingContextType {\n  marketData: MarketData[];\n  trades: Trade[];\n  strategies: Strategy[];\n  activeStrategies: string[];\n  accountBalance: {\n    available: number;\n    total: number;\n    currency: string;\n  } | null;\n  isLoading: boolean;\n  isMockMode: boolean;\n  addStrategy: (strategy: Strategy) => void;\n  removeStrategy: (id: string) => void;\n  toggleStrategyActive: (id: string) => void;\n  placeOrder: (pair: string, side: 'buy' | 'sell', type: 'limit' | 'market', quantity: number, price?: number) => Promise<unknown>;\n  errors: string[];\n  addError: (error: string) => void;\n  clearErrors: () => void;\n  refreshApiConnection: () => void; // Changed to non-Promise return type to match implementation\n}\n\nconst TradingContext = createContext<TradingContextType | undefined>(undefined);\n\nexport { TradingContext };\n\ninterface TradingProviderProps {\n  children: ReactNode;\n  initialPair?: string;\n}\n\nexport const TradingProvider: React.FC<TradingProviderProps> = ({ \n  children, \n  initialPair = 'BTC-USDT' \n}) => {\n  // Get data from Poloniex API or mock data\n  const { \n    marketData: realMarketData, \n    trades: realTrades,\n    accountBalance,\n    isLoading,\n    error,\n    isMockMode,\n    refreshApiConnection\n  } = usePoloniexData(initialPair);\n  \n  const [marketData, setMarketData] = useState<MarketData[]>(mockMarketData);\n  const [trades, setTrades] = useState<Trade[]>(mockTrades);\n  \n  // Update state when real data is available\n  useEffect(() => {\n    if (realMarketData.length > 0) {\n      setMarketData(realMarketData);\n    }\n  }, [realMarketData]);\n  \n  useEffect(() => {\n    if (realTrades.length > 0) {\n      setTrades(realTrades);\n    }\n  }, [realTrades]);\n  \n  // Strategy management\n  const [strategies, setStrategies] = useState<Strategy[]>([\n    {\n      id: '1',\n      name: 'Moving Average Crossover',\n      type: StrategyType.MA_CROSSOVER,\n      parameters: {\n        fastPeriod: 10,\n        slowPeriod: 50,\n        pair: 'BTC-USDT',\n        timeframe: '1d'\n      } as MovingAverageCrossoverParameters,\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n      performance: {\n        totalPnL: 12.5,\n        winRate: 0.65,\n        tradesCount: 24\n      }\n    }\n  ]);\n  \n  const [activeStrategies, setActiveStrategies] = useState<string[]>(['1']);\n  const [errors, setErrors] = useState<string[]>([]);\n\n  const addError = useCallback((error: string) => {\n    // Avoid adding duplicate errors\n    setErrors(prev => {\n      if (prev.includes(error)) {\n        return prev;\n      }\n      return [...prev, error];\n    });\n  }, []);\n\n  const clearErrors = useCallback(() => {\n    setErrors([]);\n  }, []);\n\n  // If there was an error loading data, add it to our errors\n  useEffect(() => {\n    if (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      addError(errorMessage);\n    }\n  }, [error, addError]);\n\n  const addStrategy = (strategy: Strategy) => {\n    setStrategies(prev => [...prev, strategy]);\n  };\n\n  const removeStrategy = (id: string) => {\n    setStrategies(prev => prev.filter(strategy => strategy.id !== id));\n    setActiveStrategies(prev => prev.filter(strategyId => strategyId !== id));\n  };\n\n  const toggleStrategyActive = (id: string) => {\n    setActiveStrategies(prev => \n      prev.includes(id) \n        ? prev.filter(strategyId => strategyId !== id) \n        : [...prev, id]\n    );\n  };\n  \n  // Place an order using the Poloniex API\n  const placeOrder = async (\n    pair: string, \n    side: 'buy' | 'sell', \n    type: 'limit' | 'market', \n    quantity: number, \n    price?: number\n  ) => {\n    try {\n      if (isMockMode) {\n        console.log('Using mock order placement', { pair, side, type, quantity, price });\n        return { \n          success: true, \n          orderId: 'mock-order-' + Date.now(),\n          pair,\n          side,\n          type,\n          quantity,\n          price: price || 'market'\n        };\n      }\n      \n      const result = await poloniexApi.placeOrder(pair, side, type, quantity, price);\n      return result;\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error placing order';\n      addError(errorMessage);\n      throw new Error(errorMessage);\n    }\n  };\n\n  return (\n    <TradingContext.Provider value={{\n      marketData,\n      trades,\n      strategies,\n      activeStrategies,\n      accountBalance,\n      isLoading,\n      isMockMode,\n      addStrategy,\n      removeStrategy,\n      toggleStrategyActive,\n      placeOrder,\n      errors,\n      addError,\n      clearErrors,\n      refreshApiConnection\n    }}>\n      {children}\n    </TradingContext.Provider>\n  );\n};\n\n// End of component\n","import { useContext } from 'react';\nimport { TradingContext } from '../context/TradingContext';\n\nexport const useTradingContext = () => {\n  const context = useContext(TradingContext);\n  if (context === undefined) {\n    throw new Error('useTradingContext must be used within a TradingProvider');\n  }\n  return context;\n};","import React, { useState } from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport { useTradingContext } from '../hooks/useTradingContext';\nimport { useResponsiveNav } from '../hooks/useResponsiveNav';\nimport { \n  LayoutDashboard, \n  LineChart, \n  Settings, \n  MessageSquare, \n  Zap,\n  BarChart4,\n  Chrome,\n  User,\n  Menu,\n  ArrowLeft,\n  TrendingUp,\n  Activity,\n  FileText,\n  Receipt,\n  History\n} from 'lucide-react';\n\nconst Sidebar: React.FC = () => {\n  const location = useLocation();\n  const { accountBalance, isLoading } = useTradingContext();\n  const { isDesktop } = useResponsiveNav();\n  const [isCollapsed, setIsCollapsed] = useState(false);\n  \n  const navItems = [\n    { path: '/', label: 'Dashboard', icon: <LayoutDashboard size={20} /> },\n    { path: '/dashboard/live', label: 'Live Trading', icon: <Activity size={20} /> },\n    { path: '/strategies', label: 'Trading Strategies', icon: <Zap size={20} /> },\n    { path: '/backtesting', label: 'Advanced Backtesting', icon: <TrendingUp size={20} /> },\n    { path: '/account', label: 'Account', icon: <User size={20} /> },\n    { path: '/transactions', label: 'Transaction History', icon: <Receipt size={20} /> },\n    { path: '/trades', label: 'Trade History', icon: <History size={20} /> },\n    { path: '/charts', label: 'Market Analysis', icon: <BarChart4 size={20} /> },\n    { path: '/performance', label: 'Performance', icon: <LineChart size={20} /> },\n    { path: '/chat', label: 'Community Chat', icon: <MessageSquare size={20} /> },\n    { path: '/extension', label: 'Chrome Extension', icon: <Chrome size={20} /> },\n    { path: '/settings', label: 'Settings', icon: <Settings size={20} /> }\n  ];\n  \n  const toggleSidebar = () => {\n    setIsCollapsed(!isCollapsed);\n  };\n\n  // Only show sidebar on desktop\n  if (!isDesktop) return null;\n  \n  return (\n    <aside \n      id=\"navigation\"\n      className={`\n        ${isCollapsed ? 'w-16' : 'w-64'} \n        bg-neutral-800 text-white transition-all duration-300 ease-in-out\n        relative flex-shrink-0\n      `}\n      role=\"navigation\"\n      aria-label=\"Main navigation\"\n    >\n      <div className=\"p-4\">\n        {/* Header with toggle */}\n        <div className=\"flex items-center justify-between mb-6 mt-2\">\n          <div className={`flex items-center ${isCollapsed ? 'justify-center' : ''}`}>\n            <Zap className=\"h-8 w-8 text-blue-400 mr-2\" aria-hidden=\"true\" />\n            {!isCollapsed && <h2 className=\"text-xl font-bold\">TradingBot</h2>}\n          </div>\n          <button\n            onClick={toggleSidebar}\n            className=\"p-1 rounded-md text-neutral-400 hover:text-white hover:bg-neutral-700 transition-colors\"\n            aria-label={isCollapsed ? 'Expand sidebar' : 'Collapse sidebar'}\n            aria-expanded={!isCollapsed}\n          >\n            {isCollapsed ? <Menu size={20} aria-hidden=\"true\" /> : <ArrowLeft size={20} aria-hidden=\"true\" />}\n          </button>\n        </div>\n        \n        <nav aria-label=\"Main menu\">\n          <ul className=\"space-y-1\" role=\"list\">\n            {navItems.map((item) => (\n              <li key={item.path}>\n                <Link \n                  to={item.path} \n                  className={`\n                    flex items-center p-3 rounded-md transition-all duration-200 group\n                    ${location.pathname === item.path \n                      ? 'bg-blue-700 text-white' \n                      : 'text-neutral-300 hover:bg-neutral-700 hover:text-white'\n                    }\n                    ${isCollapsed ? 'justify-center' : ''}\n                  `}\n                  title={isCollapsed ? item.label : undefined}\n                  aria-label={item.label}\n                  aria-current={location.pathname === item.path ? 'page' : undefined}\n                >\n                  <span className={`flex-shrink-0 ${!isCollapsed ? 'mr-3' : ''}`} aria-hidden=\"true\">\n                    {item.icon}\n                  </span>\n                  {!isCollapsed && (\n                    <span className=\"transition-opacity duration-200\">{item.label}</span>\n                  )}\n                  \n                  {/* Tooltip for collapsed state */}\n                  {isCollapsed && (\n                    <div className=\"\n                      absolute left-full ml-2 px-2 py-1 \n                      bg-neutral-900 text-white text-sm rounded-md\n                      opacity-0 group-hover:opacity-100 transition-opacity duration-200\n                      pointer-events-none whitespace-nowrap z-50\n                    \">\n                      {item.label}\n                    </div>\n                  )}\n                </Link>\n              </li>\n            ))}\n          </ul>\n        </nav>\n      </div>\n      \n      {/* Account balance section */}\n      {!isCollapsed && (\n        <div className=\"absolute bottom-0 left-0 right-0 p-4 border-t border-neutral-700\">\n          <div className=\"bg-neutral-900 p-3 rounded-md\">\n            <div className=\"text-sm text-neutral-400 mb-2\">Account Balance</div>\n            {isLoading ? (\n              <div className=\"text-sm text-neutral-500\">Loading...</div>\n            ) : (\n              <>\n                <div className=\"text-lg font-semibold\">\n                  ${parseFloat(accountBalance?.totalAmount || '0').toFixed(2)} USDT\n                </div>\n                <div className={`text-xs mt-1 ${parseFloat(accountBalance?.todayPnL || '0') >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                  {parseFloat(accountBalance?.todayPnL || '0') >= 0 ? '+' : ''}\n                  {parseFloat(accountBalance?.todayPnLPercentage || '0').toFixed(2)}% today\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </aside>\n  );\n};\n\nexport default Sidebar;","import React from 'react';\n\nconst SkipLinks: React.FC = () => {\n  return (\n    <div className=\"sr-only-focusable\">\n      <a href=\"#main-content\" className=\"skip-link\">\n        Skip to main content\n      </a>\n      <a href=\"#navigation\" className=\"skip-link\">\n        Skip to navigation\n      </a>\n    </div>\n  );\n};\n\nexport default SkipLinks;","// Enhanced environment management for proper mock mode detection\ninterface EnvironmentConfig {\n  apiKey: string | null;\n  apiSecret: string | null;\n  forceMockMode: boolean;\n  isProduction: boolean;\n  wsUrl: string;\n  apiUrl: string;\n  liveTradingEnabled: boolean;\n}\n\nexport class EnvironmentManager {\n  private static instance: EnvironmentManager;\n  private config: EnvironmentConfig;\n  \n  private constructor() {\n    this.config = this.loadConfiguration();\n    this.validateConfiguration();\n  }\n  \n  static getInstance(): EnvironmentManager {\n    if (!EnvironmentManager.instance) {\n      EnvironmentManager.instance = new EnvironmentManager();\n    }\n    return EnvironmentManager.instance;\n  }\n  \n  private loadConfiguration(): EnvironmentConfig {\n    // Check for environment variables\n    const apiKey = import.meta.env.VITE_POLONIEX_API_KEY || null;\n    const apiSecret = import.meta.env.VITE_POLONIEX_API_SECRET || null;\n    const forceMockMode = import.meta.env.VITE_FORCE_MOCK_MODE === 'true';\n    \n    // Check for localStorage override (for testing)\n    const storedConfig = this.getStoredConfig();\n    \n    return {\n      apiKey: storedConfig?.apiKey || apiKey,\n      apiSecret: storedConfig?.apiSecret || apiSecret,\n      forceMockMode: storedConfig?.forceMockMode ?? forceMockMode,\n      isProduction: import.meta.env.PROD,\n      wsUrl: import.meta.env.VITE_WS_URL || 'wss://ws.poloniex.com/ws/public',\n      apiUrl: import.meta.env.VITE_API_URL || 'https://api.poloniex.com',\n      liveTradingEnabled: false // Will be set after validation\n    };\n  }\n  \n  private getStoredConfig(): Partial<EnvironmentConfig> | null {\n    try {\n      const stored = localStorage.getItem('poloniex_config');\n      return stored ? JSON.parse(stored) : null;\n    } catch {\n      return null;\n    }\n  }\n  \n  private validateConfiguration(): void {\n    const { apiKey, apiSecret, forceMockMode } = this.config;\n    \n    // Determine if live trading should be enabled\n    const hasValidCredentials = !!(apiKey && apiSecret && apiKey.length > 10 && apiSecret.length > 10);\n    const isExplicitlyMocked = forceMockMode === true;\n    \n    this.config.liveTradingEnabled = hasValidCredentials && !isExplicitlyMocked;\n    \n    // Log configuration status (only in development)\n    if (import.meta.env.DEV) {\n      console.info('Environment Configuration:', {\n        hasApiKey: !!apiKey,\n        hasApiSecret: !!apiSecret,\n        forceMockMode: isExplicitlyMocked,\n        liveTradingEnabled: this.config.liveTradingEnabled,\n        mode: this.config.liveTradingEnabled ? 'LIVE' : 'MOCK'\n      });\n    }\n    \n    // Warn about configuration issues\n    if (!hasValidCredentials && !isExplicitlyMocked) {\n      console.warn(\n        'API credentials missing or invalid. Running in MOCK mode.',\n        '\\nTo enable live trading:',\n        '\\n1. Set VITE_POLONIEX_API_KEY and VITE_POLONIEX_API_SECRET in .env',\n        '\\n2. Ensure VITE_FORCE_MOCK_MODE is not set to \"true\"'\n      );\n    }\n    \n    if (hasValidCredentials && isExplicitlyMocked) {\n      console.warn(\n        'Valid API credentials found but VITE_FORCE_MOCK_MODE is enabled.',\n        '\\nTo enable live trading, set VITE_FORCE_MOCK_MODE=false'\n      );\n    }\n  }\n  \n  getConfig(): EnvironmentConfig {\n    return { ...this.config };\n  }\n  \n  isLiveTradingEnabled(): boolean {\n    return this.config.liveTradingEnabled;\n  }\n  \n  isMockMode(): boolean {\n    return !this.config.liveTradingEnabled;\n  }\n  \n  // Allow runtime configuration updates (for testing)\n  updateConfig(updates: Partial<EnvironmentConfig>): void {\n    this.config = { ...this.config, ...updates };\n    this.validateConfiguration();\n    \n    // Persist to localStorage\n    localStorage.setItem('poloniex_config', JSON.stringify({\n      apiKey: this.config.apiKey,\n      apiSecret: this.config.apiSecret,\n      forceMockMode: this.config.forceMockMode\n    }));\n    \n    // Trigger configuration change event\n    window.dispatchEvent(new CustomEvent('config-updated', { \n      detail: this.config \n    }));\n  }\n  \n  // Clear stored configuration\n  clearStoredConfig(): void {\n    localStorage.removeItem('poloniex_config');\n    this.config = this.loadConfiguration();\n    this.validateConfiguration();\n  }\n}","import React, { useState, useEffect } from 'react';\nimport { AlertTriangle, CheckCircle2, X } from 'lucide-react';\nimport { EnvironmentManager } from '../config/environment';\n\nconst EnvironmentStatus: React.FC = () => {\n  const [config, setConfig] = useState(EnvironmentManager.getInstance().getConfig());\n  const [isVisible, setIsVisible] = useState(true);\n\n  useEffect(() => {\n    const handleConfigUpdate = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      setConfig(customEvent.detail);\n    };\n    \n    window.addEventListener('config-updated', handleConfigUpdate);\n    return () => window.removeEventListener('config-updated', handleConfigUpdate);\n  }, []);\n\n  if (!config || !isVisible) {\n    return null;\n  }\n\n  const getStatusInfo = () => {\n    if (!config.liveTradingEnabled) {\n      return {\n        type: 'warning' as const,\n        icon: AlertTriangle,\n        title: 'Demo Mode Active',\n        message: 'Using simulated trading data',\n        details: [\n          ...(!config.apiKey || !config.apiSecret ? ['Missing API credentials'] : []),\n          ...(config.forceMockMode ? ['Force mock mode enabled'] : []),\n          'No real trades will be executed'\n        ]\n      };\n    } else {\n      return {\n        type: 'success' as const,\n        icon: CheckCircle2,\n        title: 'Live Trading Mode',\n        message: 'Connected with valid credentials',\n        details: [\n          'API credentials configured',\n          'Real trading enabled'\n        ]\n      };\n    }\n  };\n\n  const status = getStatusInfo();\n  const StatusIcon = status.icon;\n\n  const bgColor = status.type === 'warning' ? 'bg-yellow-50' : 'bg-green-50';\n  const borderColor = status.type === 'warning' ? 'border-yellow-200' : 'border-green-200';\n  const textColor = status.type === 'warning' ? 'text-yellow-800' : 'text-green-800';\n  const iconColor = status.type === 'warning' ? 'text-yellow-600' : 'text-green-600';\n\n  return (\n    <div className=\"fixed top-4 right-4 z-50 max-w-sm\">\n      <div className={`${bgColor} ${borderColor} border rounded-lg p-4 shadow-lg`}>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-start space-x-3\">\n            <StatusIcon className={`w-5 h-5 ${iconColor} mt-0.5`} />\n            <div className=\"flex-1\">\n              <h3 className={`text-sm font-medium ${textColor}`}>\n                {status.title}\n              </h3>\n              <p className={`text-xs ${textColor} mt-1`}>\n                {status.message}\n              </p>\n              {status.details.length > 0 && (\n                <ul className={`text-xs ${textColor} mt-2 space-y-1`}>\n                  {status.details.map((detail, index) => (\n                    <li key={index} className=\"flex items-center space-x-1\">\n                      <span className=\"w-1 h-1 bg-current rounded-full\"></span>\n                      <span>{detail}</span>\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </div>\n          </div>\n          <button\n            onClick={() => setIsVisible(false)}\n            className={`${textColor} hover:opacity-70 transition-opacity`}\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        </div>\n        \n        {/* Additional technical details for debugging */}\n        {!config.isProduction && (\n          <div className=\"mt-3 pt-3 border-t border-current border-opacity-20\">\n            <details className={`text-xs ${textColor}`}>\n              <summary className=\"cursor-pointer font-medium\">Debug Info</summary>\n              <div className=\"mt-2 space-y-1 font-mono text-xs\">\n                <div>Environment: {config.isProduction ? 'Production' : 'Development'}</div>\n                <div>WebSocket URL: {config.wsUrl}</div>\n                <div>Has API Key: {config.apiKey ? 'Yes' : 'No'}</div>\n                <div>Has API Secret: {config.apiSecret ? 'Yes' : 'No'}</div>\n                <div>Force Mock: {config.forceMockMode ? 'Yes' : 'No'}</div>\n                <div>Live Trading: {config.liveTradingEnabled ? 'Yes' : 'No'}</div>\n              </div>\n            </details>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default EnvironmentStatus;","import { useEffect, useRef } from 'react';\n\n/**\n * Hook to handle page visibility changes and provide callbacks for when page becomes visible/hidden\n * Includes grace period to handle quick tab switches without disrupting connections\n */\nexport const usePageVisibility = (\n  onVisible: () => void,\n  onHidden: () => void,\n  gracePeriod: number = 30000 // 30 seconds grace period\n) => {\n  const timeoutRef = useRef<NodeJS.Timeout>();\n  \n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n        // Page is hidden - delay the onHidden callback to handle quick tab switches\n        timeoutRef.current = setTimeout(() => {\n          onHidden();\n        }, gracePeriod);\n      } else {\n        // Page is visible - clear any pending onHidden callback and call onVisible\n        if (timeoutRef.current) {\n          clearTimeout(timeoutRef.current);\n          timeoutRef.current = undefined;\n        }\n        onVisible();\n      }\n    };\n    \n    // Listen for visibility changes\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    \n    // Cleanup\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, [onVisible, onHidden, gracePeriod]);\n};","import React, { createContext, useEffect, ReactNode } from 'react';\nimport { webSocketService } from '../services/websocketService';\nimport { usePageVisibility } from '../hooks/usePageVisibility';\n\ninterface WebSocketContextType {\n  isConnected: boolean;\n  connectionState: string;\n  lastError: string | null;\n  connectionHealth: {\n    isHealthy: boolean;\n    uptime: number;\n    latency: number | null;\n    reconnectAttempts: number;\n  };\n}\n\nconst WebSocketContext = createContext<WebSocketContextType | null>(null);\n\nexport { WebSocketContext };\nexport type { WebSocketContextType };\n\ninterface WebSocketProviderProps {\n  children: ReactNode;\n}\n\nexport const WebSocketProvider: React.FC<WebSocketProviderProps> = ({ children }) => {\n  const [contextState, setContextState] = React.useState<WebSocketContextType>({\n    isConnected: false,\n    connectionState: 'disconnected',\n    lastError: null,\n    connectionHealth: {\n      isHealthy: false,\n      uptime: 0,\n      latency: null,\n      reconnectAttempts: 0\n    }\n  });\n\n  // Handle page visibility changes\n  usePageVisibility(\n    () => {\n      // Page visible - ensure connection\n      webSocketService.handlePageVisibilityChange(true);\n    },\n    () => {\n      // Page hidden - maintain connection in background\n      webSocketService.handlePageVisibilityChange(false);\n    },\n    30000 // 30 second grace period\n  );\n\n  useEffect(() => {\n    // Connection state change handler\n    const handleConnectionStateChange = (state: string) => {\n      setContextState(prev => ({\n        ...prev,\n        connectionState: state,\n        isConnected: state === 'connected'\n      }));\n    };\n\n    // Error handler\n    const handleError = (error: Error | unknown) => {\n      setContextState(prev => ({\n        ...prev,\n        lastError: error instanceof Error ? error.message : 'Unknown error'\n      }));\n    };\n\n    // Set up event listeners\n    webSocketService.on('connectionStateChanged', handleConnectionStateChange);\n    webSocketService.on('error', handleError);\n\n    // Initialize connection\n    webSocketService.connect().catch(console.error);\n\n    // Update connection health periodically\n    const healthInterval = setInterval(() => {\n      const health = webSocketService.getConnectionHealth();\n      setContextState(prev => ({\n        ...prev,\n        connectionHealth: {\n          isHealthy: health.isHealthy,\n          uptime: health.uptime,\n          latency: health.latency,\n          reconnectAttempts: health.reconnectAttempts\n        }\n      }));\n    }, 5000);\n\n    // Cleanup\n    return () => {\n      clearInterval(healthInterval);\n      webSocketService.off('connectionStateChanged', handleConnectionStateChange);\n      webSocketService.off('error', handleError);\n      webSocketService.disconnect();\n    };\n  }, []);\n\n  return (\n    <WebSocketContext.Provider value={contextState}>\n      {children}\n    </WebSocketContext.Provider>\n  );\n};\n\n// End of component","import { useContext } from 'react';\nimport { WebSocketContext, WebSocketContextType } from '../context/WebSocketContext';\n\nexport const useWebSocket = (): WebSocketContextType => {\n  const context = useContext(WebSocketContext);\n  if (!context) {\n    throw new Error('useWebSocket must be used within a WebSocketProvider');\n  }\n  return context;\n};","import React, { useState } from 'react';\nimport { Wifi, WifiOff, AlertCircle, Clock } from 'lucide-react';\nimport { useWebSocket } from '../hooks/useWebSocket';\n\ninterface ConnectionHealthProps {\n  className?: string;\n}\n\nconst ConnectionHealth: React.FC<ConnectionHealthProps> = ({ className = '' }) => {\n  const webSocket = useWebSocket();\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const getHealthStatus = () => {\n    if (webSocket.isConnected) {\n      return {\n        icon: Wifi,\n        color: 'text-green-600',\n        bgColor: 'bg-green-50',\n        borderColor: 'border-green-200',\n        status: 'Connected',\n        description: 'Real-time data active'\n      };\n    } else if (webSocket.connectionState === 'connecting' || webSocket.connectionState === 'reconnecting') {\n      return {\n        icon: Clock,\n        color: 'text-yellow-600',\n        bgColor: 'bg-yellow-50',\n        borderColor: 'border-yellow-200',\n        status: 'Connecting',\n        description: 'Establishing connection...'\n      };\n    } else {\n      return {\n        icon: WifiOff,\n        color: 'text-red-600',\n        bgColor: 'bg-red-50',\n        borderColor: 'border-red-200',\n        status: 'Disconnected',\n        description: 'Using mock data'\n      };\n    }\n  };\n\n  const formatUptime = (uptime: number) => {\n    if (uptime < 60000) return `${Math.floor(uptime / 1000)}s`;\n    if (uptime < 3600000) return `${Math.floor(uptime / 60000)}m`;\n    return `${Math.floor(uptime / 3600000)}h ${Math.floor((uptime % 3600000) / 60000)}m`;\n  };\n\n  const formatLatency = (latency: number | null) => {\n    if (latency === null) return 'N/A';\n    return `${Math.round(latency)}ms`;\n  };\n\n  const health = getHealthStatus();\n  const HealthIcon = health.icon;\n\n  return (\n    <div className={`fixed bottom-4 right-4 z-40 ${className}`}>\n      <div className={`${health.bgColor} ${health.borderColor} border rounded-lg shadow-lg transition-all duration-200`}>\n        {/* Compact view */}\n        <div \n          className={`p-3 cursor-pointer flex items-center space-x-2 ${isExpanded ? 'border-b border-current border-opacity-20' : ''}`}\n          onClick={() => setIsExpanded(!isExpanded)}\n        >\n          <HealthIcon className={`w-4 h-4 ${health.color}`} />\n          <span className={`text-sm font-medium ${health.color}`}>\n            {health.status}\n          </span>\n          <div className={`w-2 h-2 rounded-full ${webSocket.isConnected ? 'bg-green-500' : 'bg-red-500'} animate-pulse`} />\n        </div>\n\n        {/* Expanded view */}\n        {isExpanded && (\n          <div className={`p-3 text-xs ${health.color}`}>\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between\">\n                <span>Status:</span>\n                <span className=\"font-medium\">{health.description}</span>\n              </div>\n              \n              {webSocket.isConnected && (\n                <>\n                  <div className=\"flex justify-between\">\n                    <span>Uptime:</span>\n                    <span className=\"font-mono\">{formatUptime(webSocket.connectionHealth.uptime)}</span>\n                  </div>\n                  \n                  <div className=\"flex justify-between\">\n                    <span>Latency:</span>\n                    <span className=\"font-mono\">{formatLatency(webSocket.connectionHealth.latency)}</span>\n                  </div>\n                </>\n              )}\n              \n              {webSocket.connectionHealth.reconnectAttempts > 0 && (\n                <div className=\"flex justify-between\">\n                  <span>Reconnects:</span>\n                  <span className=\"font-mono\">{webSocket.connectionHealth.reconnectAttempts}</span>\n                </div>\n              )}\n\n              <div className=\"flex justify-between\">\n                <span>State:</span>\n                <span className=\"font-mono capitalize\">{webSocket.connectionState}</span>\n              </div>\n\n              {webSocket.lastError && (\n                <div className=\"pt-2 border-t border-current border-opacity-20\">\n                  <div className=\"flex items-start space-x-1\">\n                    <AlertCircle className=\"w-3 h-3 mt-0.5 flex-shrink-0\" />\n                    <span className=\"text-xs break-all\">{webSocket.lastError}</span>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ConnectionHealth;","import React, { useState, useEffect } from 'react';\nimport { CheckCircle2, AlertTriangle, Settings, X } from 'lucide-react';\nimport { EnvironmentManager } from '../config/environment';\n\nexport const ConfigurationStatus: React.FC = () => {\n  const [config, setConfig] = useState(EnvironmentManager.getInstance().getConfig());\n  const [showDetails, setShowDetails] = useState(false);\n  const [isVisible, setIsVisible] = useState(true);\n  \n  useEffect(() => {\n    const handleConfigUpdate = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      setConfig(customEvent.detail);\n    };\n    \n    window.addEventListener('config-updated', handleConfigUpdate);\n    return () => window.removeEventListener('config-updated', handleConfigUpdate);\n  }, []);\n  \n  if (!isVisible) return null;\n  \n  const isLiveMode = config.liveTradingEnabled;\n  \n  return (\n    <div className=\"fixed top-4 right-4 z-50 max-w-sm\">\n      <div className={`\n        ${isLiveMode ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}\n        border rounded-lg p-4 shadow-lg\n      `}>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className={`\n              px-3 py-1 rounded-full text-sm font-medium flex items-center gap-2\n              ${isLiveMode \n                ? 'bg-green-100 text-green-800' \n                : 'bg-yellow-100 text-yellow-800'\n              }\n            `}>\n              {isLiveMode ? (\n                <CheckCircle2 className=\"w-4 h-4\" />\n              ) : (\n                <AlertTriangle className=\"w-4 h-4\" />\n              )}\n              {isLiveMode ? 'LIVE TRADING' : 'MOCK MODE'}\n            </div>\n            \n            <button\n              onClick={() => setShowDetails(!showDetails)}\n              className={`\n                p-1 rounded-full hover:bg-opacity-20 transition-colors\n                ${isLiveMode ? 'hover:bg-green-600' : 'hover:bg-yellow-600'}\n              `}\n              title=\"Configuration Settings\"\n            >\n              <Settings className=\"w-4 h-4\" />\n            </button>\n          </div>\n          \n          <button\n            onClick={() => setIsVisible(false)}\n            className={`\n              p-1 rounded-full hover:bg-opacity-20 transition-colors\n              ${isLiveMode ? 'text-green-600 hover:bg-green-600' : 'text-yellow-600 hover:bg-yellow-600'}\n            `}\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        </div>\n        \n        {showDetails && (\n          <div className={`\n            mt-4 p-3 rounded-lg text-sm\n            ${isLiveMode \n              ? 'bg-green-100 text-green-800' \n              : 'bg-yellow-100 text-yellow-800'\n            }\n          `}>\n            <div className=\"font-medium mb-2\">Configuration Status</div>\n            <div className=\"space-y-1 text-xs\">\n              <div>Mode: {isLiveMode ? 'Live Trading' : 'Mock Trading'}</div>\n              <div>API Key: {config.apiKey ? ' Configured' : ' Missing'}</div>\n              <div>API Secret: {config.apiSecret ? ' Configured' : ' Missing'}</div>\n              <div>Force Mock: {config.forceMockMode ? 'Yes' : 'No'}</div>\n              <div>Environment: {config.isProduction ? 'Production' : 'Development'}</div>\n            </div>\n            \n            {!isLiveMode && (\n              <div className=\"mt-2 p-2 bg-yellow-200 rounded text-xs\">\n                <strong>To enable live trading:</strong><br />\n                1. Set VITE_POLONIEX_API_KEY and VITE_POLONIEX_SECRET<br />\n                2. Ensure VITE_FORCE_MOCK_MODE is not set to \"true\"\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};","import React, { useState, useEffect } from 'react';\n\nexport const EnvDebug: React.FC = () => {\n  const [isVisible, setIsVisible] = useState(true);\n  const [isMinimized, setIsMinimized] = useState(false);\n\n  // Load dismissed state from localStorage\n  useEffect(() => {\n    const dismissed = localStorage.getItem('envDebug_dismissed') === 'true';\n    const minimized = localStorage.getItem('envDebug_minimized') === 'true';\n    setIsVisible(!dismissed);\n    setIsMinimized(minimized);\n  }, []);\n\n  // Handle dismiss\n  const handleDismiss = () => {\n    setIsVisible(false);\n    localStorage.setItem('envDebug_dismissed', 'true');\n  };\n\n  // Handle minimize/restore\n  const handleToggleMinimize = () => {\n    const newMinimized = !isMinimized;\n    setIsMinimized(newMinimized);\n    localStorage.setItem('envDebug_minimized', newMinimized.toString());\n  };\n\n  // Handle show again\n  const handleShowAgain = () => {\n    setIsVisible(true);\n    localStorage.setItem('envDebug_dismissed', 'false');\n  };\n\n  // Show a small restore button if dismissed\n  if (!isVisible) {\n    return (\n      <button\n        onClick={handleShowAgain}\n        style={{\n          position: 'fixed',\n          top: '10px',\n          right: '10px',\n          background: '#4a90e2',\n          color: '#fff',\n          border: 'none',\n          borderRadius: '4px',\n          padding: '5px 8px',\n          fontSize: '11px',\n          cursor: 'pointer',\n          zIndex: 9999,\n          opacity: 0.7\n        }}\n        title=\"Show environment debug info\"\n      >\n        \n      </button>\n    );\n  }\n  const envVars = {\n    // Check what the frontend is actually receiving\n    API_KEY: import.meta.env.VITE_POLONIEX_API_KEY,\n    API_SECRET: import.meta.env.VITE_POLONIEX_API_SECRET,\n    API_URL: import.meta.env.VITE_API_URL,\n    WS_URL: import.meta.env.VITE_WS_URL,\n    FORCE_MOCK: import.meta.env.VITE_FORCE_MOCK_MODE,\n    NODE_ENV: import.meta.env.MODE,\n    IS_PROD: import.meta.env.PROD,\n  };\n\n  // Determine why mock mode is active\n  const hasApiKey = !!(envVars.API_KEY && envVars.API_KEY.length > 10);\n  const hasApiSecret = !!(envVars.API_SECRET && envVars.API_SECRET.length > 10);\n  const forceMock = envVars.FORCE_MOCK === 'true';\n  \n  const isLiveMode = hasApiKey && hasApiSecret && !forceMock;\n\n  return (\n    <div style={{ \n      position: 'fixed', \n      top: '10px', \n      right: '10px', \n      background: '#1a1a1a', \n      color: '#fff', \n      padding: isMinimized ? '10px' : '15px', \n      borderRadius: '8px', \n      fontSize: '12px',\n      zIndex: 9999,\n      maxWidth: isMinimized ? '200px' : '400px',\n      border: '1px solid #333',\n      transition: 'all 0.3s ease'\n    }}>\n      <div style={{ \n        display: 'flex', \n        justifyContent: 'space-between', \n        alignItems: 'center',\n        marginBottom: isMinimized ? '0' : '10px'\n      }}>\n        <h3 style={{ margin: '0', color: '#4a90e2', fontSize: isMinimized ? '11px' : '12px' }}>\n           Environment Debug\n        </h3>\n        <div style={{ display: 'flex', gap: '5px' }}>\n          <button\n            onClick={handleToggleMinimize}\n            style={{\n              background: 'transparent',\n              border: 'none',\n              color: '#ccc',\n              cursor: 'pointer',\n              padding: '2px 5px',\n              fontSize: '12px'\n            }}\n            title={isMinimized ? \"Expand\" : \"Minimize\"}\n          >\n            {isMinimized ? '' : ''}\n          </button>\n          <button\n            onClick={handleDismiss}\n            style={{\n              background: 'transparent',\n              border: 'none',\n              color: '#ccc',\n              cursor: 'pointer',\n              padding: '2px 5px',\n              fontSize: '12px'\n            }}\n            title=\"Dismiss\"\n          >\n            \n          </button>\n        </div>\n      </div>\n\n      {!isMinimized && (\n        <>\n          <div style={{ marginBottom: '10px' }}>\n            <strong>Mode: </strong>\n            <span style={{ color: isLiveMode ? '#00ff00' : '#ff9800' }}>\n              {isLiveMode ? ' LIVE' : ' MOCK'}\n            </span>\n          </div>\n\n          <div style={{ marginBottom: '10px' }}>\n            <strong>Why Mock Mode?</strong>\n            <ul style={{ margin: '5px 0', paddingLeft: '20px' }}>\n              {!hasApiKey && <li style={{ color: '#ff5252' }}>No API Key</li>}\n              {!hasApiSecret && <li style={{ color: '#ff5252' }}>No API Secret</li>}\n              {forceMock && <li style={{ color: '#ff5252' }}>Force Mock = true</li>}\n              {isLiveMode && <li style={{ color: '#00ff00' }}>All conditions met!</li>}\n            </ul>\n          </div>\n\n          <details>\n            <summary style={{ cursor: 'pointer', marginBottom: '10px' }}>\n              Environment Variables\n            </summary>\n            <pre style={{ \n              background: '#0a0a0a', \n              padding: '10px', \n              borderRadius: '4px', \n              overflow: 'auto',\n              fontSize: '11px'\n            }}>\n{Object.entries(envVars).map(([key, value]) => {\n  const displayValue = key.includes('SECRET') && value \n    ? value.substring(0, 10) + '...' \n    : value || 'NOT SET';\n  return `${key}: ${displayValue}\\n`;\n}).join('')}\n            </pre>\n          </details>\n\n          <button \n            onClick={() => window.location.reload()}\n            style={{\n              marginTop: '10px',\n              padding: '5px 10px',\n              background: '#4a90e2',\n              color: '#fff',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer'\n            }}\n          >\n            Reload Page\n          </button>\n        </>\n      )}\n\n      {isMinimized && (\n        <div style={{ fontSize: '10px', color: '#ccc' }}>\n          Mode: <span style={{ color: isLiveMode ? '#00ff00' : '#ff9800' }}>\n            {isLiveMode ? 'LIVE' : 'MOCK'}\n          </span>\n        </div>\n      )}\n    </div>\n  );\n};","import React, { useState, useEffect, useRef } from 'react';\nimport { io } from 'socket.io-client';\nimport { useAppStore } from '@/store';\n\nexport const ConnectionTest: React.FC = () => {\n  const [apiStatus, setApiStatus] = useState<'checking' | 'connected' | 'failed' | 'cors-blocked'>('checking');\n  const [wsStatus, setWsStatus] = useState<'checking' | 'connected' | 'failed'>('checking');\n  const [apiData, setApiData] = useState<{ status: string; timestamp: string } | null>(null);\n  const [isVisible, setIsVisible] = useState(true);\n  \n  // Refs to track if we've already shown notifications for these errors\n  const apiErrorNotifiedRef = useRef(false);\n  const wsErrorNotifiedRef = useRef(false);\n  const lastErrorTimeRef = useRef<{ api: number, ws: number }>({ api: 0, ws: 0 });\n  \n  const addToast = useAppStore(state => state.addToast);\n\n  const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:3000';\n  const wsUrl = import.meta.env.VITE_WS_URL || 'ws://localhost:3000';\n\n  useEffect(() => {\n    // Test API connection with better error handling\n    const testApiConnection = async () => {\n      try {\n        const response = await fetch(`${apiUrl}/api/health`, {\n          method: 'GET',\n          headers: {\n            'Accept': 'application/json',\n          },\n          mode: 'cors', // Explicitly set CORS mode\n        });\n        \n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n        \n        const data = await response.json();\n        setApiStatus('connected');\n        setApiData(data);\n        apiErrorNotifiedRef.current = false; // Reset error notification flag on success\n      } catch (err) {\n        // Handle CORS and network errors more gracefully\n        const error = err as Error;\n        const now = Date.now();\n        \n        // Only show toast notification once every 30 seconds to avoid spam\n        if (!apiErrorNotifiedRef.current || now - lastErrorTimeRef.current.api > 30000) {\n          if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {\n            if (import.meta.env.DEV) {\n              // eslint-disable-next-line no-console\n              console.warn('API connection failed due to CORS policy or network error. This is expected in development mode.');\n            }\n            setApiStatus('cors-blocked');\n            addToast({\n              message: 'Backend API unavailable - using mock data (expected in development)',\n              type: 'warning',\n              dismissible: true\n            });\n          } else {\n            if (import.meta.env.DEV) {\n              // eslint-disable-next-line no-console\n              console.warn('API connection error:', error.message);\n            }\n            setApiStatus('failed');\n            addToast({\n              message: `API connection failed: ${error.message}`,\n              type: 'error',\n              dismissible: true\n            });\n          }\n          \n          apiErrorNotifiedRef.current = true;\n          lastErrorTimeRef.current.api = now;\n        } else {\n          // Still update status but don't spam notifications\n          if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {\n            setApiStatus('cors-blocked');\n          } else {\n            setApiStatus('failed');\n          }\n        }\n      }\n    };\n\n    testApiConnection();\n\n    // Test WebSocket connection with better error handling\n    const newSocket = io(wsUrl, {\n      transports: ['websocket', 'polling'],\n      reconnectionAttempts: 3,\n      timeout: 5000,\n    });\n\n    newSocket.on('connect', () => {\n      if (import.meta.env.DEV) {\n        // eslint-disable-next-line no-console\n        console.info('WebSocket connected!');\n      }\n      setWsStatus('connected');\n      wsErrorNotifiedRef.current = false; // Reset error notification flag on success\n    });\n\n    newSocket.on('connect_error', (err) => {\n      const now = Date.now();\n      \n      // Only show toast notification once every 30 seconds to avoid spam\n      if (!wsErrorNotifiedRef.current || now - lastErrorTimeRef.current.ws > 30000) {\n        if (err.message.includes('WebSocket is closed before the connection is established')) {\n          if (import.meta.env.DEV) {\n            // eslint-disable-next-line no-console\n            console.warn('WebSocket connection failed due to server unavailability. This is expected in development mode.');\n          }\n          addToast({\n            message: 'WebSocket unavailable - using mock data (expected in development)',\n            type: 'warning',\n            dismissible: true\n          });\n        } else {\n          if (import.meta.env.DEV) {\n            // eslint-disable-next-line no-console\n            console.warn('WebSocket error:', err.message);\n          }\n          addToast({\n            message: `WebSocket error: ${err.message}`,\n            type: 'error',\n            dismissible: true\n          });\n        }\n        \n        wsErrorNotifiedRef.current = true;\n        lastErrorTimeRef.current.ws = now;\n      }\n      \n      setWsStatus('failed');\n    });\n\n    return () => {\n      newSocket.disconnect();\n    };\n  }, [apiUrl, wsUrl, addToast]);\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'connected': return '#4caf50';\n      case 'failed': return '#f44336';\n      case 'cors-blocked': return '#ff9800';\n      default: return '#ff9800';\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'connected': return 'CONNECTED';\n      case 'failed': return 'FAILED';\n      case 'cors-blocked': return 'CORS BLOCKED';\n      case 'checking': return 'CHECKING';\n      default: return status.toUpperCase();\n    }\n  };\n\n  return (\n    <>\n      {isVisible && (\n        <div style={{\n          position: 'fixed',\n          top: '10px',\n          left: '10px',\n          background: '#1a1a1a',\n          color: '#fff',\n          padding: '15px',\n          borderRadius: '8px',\n          fontSize: '12px',\n          zIndex: 9999,\n          maxWidth: '350px',\n          border: '1px solid #333'\n        }}>\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '10px' }}>\n            <h3 style={{ margin: '0 0 5px 0', color: '#4a90e2' }}>\n               Connection Status\n            </h3>\n            <button \n              onClick={() => setIsVisible(false)}\n              style={{\n                background: 'none',\n                border: 'none',\n                color: '#999',\n                cursor: 'pointer',\n                fontSize: '16px',\n                padding: '0',\n                width: '20px',\n                height: '20px',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center'\n              }}\n              title=\"Hide connection status\"\n            >\n              \n            </button>\n          </div>\n          \n          <div style={{ marginBottom: '15px' }}>\n            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>\n              <span>API Connection:</span>\n              <span style={{ color: getStatusColor(apiStatus), fontWeight: 'bold' }}>\n                {getStatusText(apiStatus)}\n              </span>\n            </div>\n            <div style={{ fontSize: '12px', color: '#888' }}>\n              {apiUrl}\n            </div>\n            {apiData && (\n              <pre style={{ \n                background: '#0a0a0a', \n                padding: '8px', \n                borderRadius: '4px', \n                fontSize: '11px',\n                marginTop: '8px'\n              }}>\n                {JSON.stringify(apiData, null, 2)}\n              </pre>\n            )}\n          </div>\n\n          <div style={{ marginBottom: '15px' }}>\n            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>\n              <span>WebSocket:</span>\n              <span style={{ color: getStatusColor(wsStatus), fontWeight: 'bold' }}>\n                {getStatusText(wsStatus)}\n              </span>\n            </div>\n            <div style={{ fontSize: '12px', color: '#888' }}>\n              {wsUrl}\n            </div>\n          </div>\n\n          <button \n            onClick={() => window.location.reload()}\n            style={{\n              width: '100%',\n              padding: '8px',\n              background: '#4a90e2',\n              color: '#fff',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer',\n              fontSize: '14px'\n            }}\n          >\n            Refresh\n          </button>\n        </div>\n      )}\n      \n      {!isVisible && (\n        <button\n          onClick={() => setIsVisible(true)}\n          style={{\n            position: 'fixed',\n            top: '10px',\n            left: '10px',\n            background: '#1a1a1a',\n            color: '#4a90e2',\n            border: '1px solid #333',\n            borderRadius: '4px',\n            padding: '8px 12px',\n            cursor: 'pointer',\n            fontSize: '12px',\n            zIndex: 9999\n          }}\n          title=\"Show connection status\"\n        >\n           Status\n        </button>\n      )}\n    </>\n  );\n};","import React, { useState, useEffect } from 'react';\nimport { Download, X } from 'lucide-react';\n\ninterface BeforeInstallPromptEvent extends Event {\n  prompt(): Promise<void>;\n  userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\n}\n\nconst PWAInstallPrompt: React.FC = () => {\n  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\n  const [showPrompt, setShowPrompt] = useState(false);\n  const [isInstallable, setIsInstallable] = useState(false);\n\n  useEffect(() => {\n    // Check if already dismissed\n    const dismissed = localStorage.getItem('pwa_install_dismissed') === 'true';\n    \n    // Check if already installed\n    const isStandalone = window.matchMedia('(display-mode: standalone)').matches;\n    const isInWebAppiOS = (window.navigator as any).standalone === true;\n    const isInstalled = isStandalone || isInWebAppiOS;\n\n    if (dismissed || isInstalled) {\n      return;\n    }\n\n    const handleBeforeInstallPrompt = (e: Event) => {\n      // Prevent the mini-infobar from appearing on mobile\n      e.preventDefault();\n      \n      const promptEvent = e as BeforeInstallPromptEvent;\n      setDeferredPrompt(promptEvent);\n      setIsInstallable(true);\n      \n      // Show our custom prompt after a short delay\n      setTimeout(() => {\n        setShowPrompt(true);\n      }, 5000); // Show after 5 seconds\n    };\n\n    const handleAppInstalled = () => {\n      console.log('PWA: App was installed');\n      setShowPrompt(false);\n      setDeferredPrompt(null);\n      setIsInstallable(false);\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    window.addEventListener('appinstalled', handleAppInstalled);\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n      window.removeEventListener('appinstalled', handleAppInstalled);\n    };\n  }, []);\n\n  const handleInstallClick = async () => {\n    if (!deferredPrompt) return;\n\n    try {\n      await deferredPrompt.prompt();\n      const choiceResult = await deferredPrompt.userChoice;\n      \n      if (choiceResult.outcome === 'accepted') {\n        console.log('PWA: User accepted the install prompt');\n      } else {\n        console.log('PWA: User dismissed the install prompt');\n      }\n      \n      setDeferredPrompt(null);\n      setShowPrompt(false);\n    } catch (error) {\n      console.error('PWA: Error during installation:', error);\n    }\n  };\n\n  const handleDismiss = () => {\n    setShowPrompt(false);\n    localStorage.setItem('pwa_install_dismissed', 'true');\n  };\n\n  if (!showPrompt || !isInstallable) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-sm bg-white border border-gray-200 rounded-lg shadow-lg p-4 z-50 animate-in slide-in-from-bottom duration-300\">\n      <div className=\"flex items-start justify-between\">\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"flex-shrink-0\">\n            <Download className=\"h-6 w-6 text-blue-600\" />\n          </div>\n          <div className=\"flex-1\">\n            <h3 className=\"text-sm font-medium text-gray-900\">\n              Install Poloniex Trading\n            </h3>\n            <p className=\"text-xs text-gray-600 mt-1\">\n              Add to your home screen for quick access and offline support\n            </p>\n          </div>\n        </div>\n        <button\n          onClick={handleDismiss}\n          className=\"flex-shrink-0 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded\"\n          aria-label=\"Dismiss install prompt\"\n        >\n          <X className=\"h-4 w-4\" />\n        </button>\n      </div>\n      \n      <div className=\"mt-3 flex space-x-2\">\n        <button\n          onClick={handleInstallClick}\n          className=\"flex-1 bg-blue-600 text-white text-sm font-medium py-2 px-3 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors\"\n        >\n          Install\n        </button>\n        <button\n          onClick={handleDismiss}\n          className=\"flex-1 bg-gray-100 text-gray-700 text-sm font-medium py-2 px-3 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors\"\n        >\n          Not now\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default PWAInstallPrompt;","import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nexport const useErrorRecovery = (hasError: boolean, error: Error | null) => {\n  const navigate = useNavigate();\n  const [countdown, setCountdown] = useState(5);\n  \n  useEffect(() => {\n    if (!hasError) return;\n    \n    // Check if error is related to routing/navigation\n    const isRoutingError = error?.message?.includes('Failed to load') || \n                          error?.message?.includes('chunk') ||\n                          error?.message?.includes('route');\n    \n    // Start countdown for auto-navigation to dashboard\n    if (isRoutingError) {\n      const timer = setInterval(() => {\n        setCountdown(prev => {\n          if (prev <= 1) {\n            clearInterval(timer);\n            navigate('/dashboard');\n            return 0;\n          }\n          return prev - 1;\n        });\n      }, 1000);\n      \n      return () => clearInterval(timer);\n    }\n  }, [hasError, error, navigate]);\n  \n  const navigateToDashboard = () => {\n    navigate('/dashboard');\n  };\n  \n  return { countdown, navigateToDashboard };\n};","import React, { useState } from 'react';\nimport { useErrorRecovery } from '../hooks/useErrorRecovery';\nimport type { ErrorInfo } from 'react';\n\ninterface ErrorFallbackProps {\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n  errorCount: number;\n  onReset: () => void;\n}\n\nexport const ErrorFallback: React.FC<ErrorFallbackProps> = ({\n  error,\n  errorCount,\n  onReset\n}) => {\n  const { countdown, navigateToDashboard } = useErrorRecovery(true, error);\n  const [showDetails, setShowDetails] = useState(false);\n\n  // Determine if this is a critical error or something we can recover from\n  const isCriticalError = errorCount > 3 || error?.message?.includes('critical');\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\n      <div className=\"max-w-lg w-full bg-white rounded-lg shadow-lg p-6 text-center\">\n        <div className=\"mb-4\">\n          <div className=\"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\n            <svg className=\"w-8 h-8 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\n            </svg>\n          </div>\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n            {isCriticalError ? 'Critical Error' : 'Something went wrong'}\n          </h2>\n          <p className=\"text-gray-600 mb-4\">\n            {isCriticalError \n              ? 'A critical error has occurred. Please refresh the page or contact support.'\n              : 'Don\\'t worry, we\\'re working on fixing this issue.'}\n          </p>\n        </div>\n\n        {error && (\n          <div className=\"mb-4 text-left\">\n            <button\n              onClick={() => setShowDetails(!showDetails)}\n              className=\"text-blue-600 hover:text-blue-800 text-sm font-medium\"\n            >\n              {showDetails ? 'Hide' : 'Show'} Error Details\n            </button>\n            {showDetails && (\n              <div className=\"mt-2 p-3 bg-gray-100 rounded text-sm text-gray-700\">\n                <p><strong>Error:</strong> {error.message}</p>\n                {error.stack && (\n                  <details className=\"mt-2\">\n                    <summary className=\"cursor-pointer text-gray-600\">Stack Trace</summary>\n                    <pre className=\"mt-1 text-xs whitespace-pre-wrap break-all\">\n                      {error.stack}\n                    </pre>\n                  </details>\n                )}\n              </div>\n            )}\n          </div>\n        )}\n\n        <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n          <button\n            onClick={onReset}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n          >\n            Try Again\n          </button>\n          <button\n            onClick={navigateToDashboard}\n            className=\"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors\"\n          >\n            Go to Dashboard\n          </button>\n        </div>\n\n        {countdown > 0 && (\n          <p className=\"mt-4 text-sm text-gray-500\">\n            Automatically redirecting to dashboard in {countdown} seconds...\n          </p>\n        )}\n\n        {errorCount > 1 && (\n          <p className=\"mt-2 text-sm text-orange-600\">\n            Error occurred {errorCount} times\n          </p>\n        )}\n      </div>\n    </div>\n  );\n};","import React, { Component, type ReactNode, type ErrorInfo } from 'react';\nimport { ErrorFallback } from './ErrorFallback';\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n  errorCount: number;\n  errorId: string;\n}\n\ninterface ErrorBoundaryProps {\n  children: ReactNode;\n  fallback?: React.ComponentType<{\n    error: Error | null;\n    errorInfo: ErrorInfo | null;\n    errorCount: number;\n    onReset: () => void;\n  }>;\n}\n\nexport class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  private resetTimeoutId: number | null = null;\n\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorCount: 0,\n      errorId: ''\n    };\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<ErrorBoundaryState> {\n    return {\n      hasError: true,\n      error,\n      errorId: `error-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    this.setState(prevState => ({\n      errorInfo,\n      errorCount: prevState.errorCount + 1\n    }));\n\n    // Log error to monitoring service\n    this.logError(error, errorInfo);\n\n    // Auto-reset after 30 seconds for non-critical errors, but only for first few errors\n    if (this.state.errorCount < 3 && !this.isInitializationError(error)) {\n      this.resetTimeoutId = window.setTimeout(() => {\n        this.handleReset();\n      }, 30000);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.resetTimeoutId) {\n      clearTimeout(this.resetTimeoutId);\n    }\n  }\n\n  private logError = (error: Error, errorInfo: ErrorInfo) => {\n    // Log to console for development\n    console.error('ErrorBoundary caught an error:', error);\n    console.error('Error info:', errorInfo);\n\n    // Check for initialization errors\n    if (this.isInitializationError(error)) {\n      console.error('Initialization error detected - this may require a page refresh');\n    }\n\n    // In production, this would send to a logging service\n    if (process.env.NODE_ENV === 'production') {\n      // Example: Send to monitoring service\n      // logErrorToService(error, errorInfo, this.state.errorCount);\n    }\n  };\n\n  private isInitializationError = (error: Error): boolean => {\n    const message = error.message || '';\n    return (\n      message.includes('Cannot access') && message.includes('before initialization') ||\n      message.includes('temporal dead zone') ||\n      message.includes('ReferenceError') ||\n      // React Error #185 - Maximum update depth exceeded (infinite loop)\n      message.includes('185') ||\n      message.includes('Maximum update depth exceeded') ||\n      message.includes('infinite') ||\n      message.includes('hydration') ||\n      message.includes('Text content does not match server-rendered HTML') ||\n      message.includes('Hydration failed')\n    );\n  };\n\n  private handleReset = () => {\n    if (this.resetTimeoutId) {\n      clearTimeout(this.resetTimeoutId);\n      this.resetTimeoutId = null;\n    }\n\n    this.setState({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: ''\n    });\n  };\n\n  render() {\n    if (this.state.hasError) {\n      const FallbackComponent = this.props.fallback || ErrorFallback;\n      \n      return (\n        <FallbackComponent\n          error={this.state.error}\n          errorCount={this.state.errorCount}\n          onReset={this.handleReset}\n        />\n      );\n    }\n\n    return this.props.children;\n  }\n}","import React, { useEffect, useState, useCallback } from 'react';\nimport { useSettings } from '../hooks/useSettings';\n\ninterface ExtensionMessage {\n  type: string;\n  data: unknown;\n}\n\n// Extension response types\ninterface ExtensionInstallResponse {\n  installed: boolean;\n}\n\ninterface ExtensionUpdateResponse {\n  success: boolean;\n}\n\nconst Integration: React.FC = () => {\n  const { apiKey, apiSecret } = useSettings();\n  const [isExtensionInstalled, setIsExtensionInstalled] = useState(false);\n  \n  const handleExtensionMessage = useCallback((event: MessageEvent) => {\n    // Ensure message is from our extension\n    if (event.source !== window || !event.data || event.data.source !== 'POLONIEX_EXTENSION') {\n      return;\n    }\n    \n    const message = event.data as ExtensionMessage;\n    console.log('Received message from extension:', message);\n    \n    switch (message.type) {\n      case 'PLACE_ORDER':\n        // Handle order placement\n        console.log('Order received from extension:', message.data);\n        // In a real app, this would call your order placement logic\n        break;\n        \n      case 'GET_ACCOUNT_DATA':\n        // Handle account data request\n        console.log('Account data requested from extension');\n        // In a real app, this would send account data to extension\n        break;\n        \n      default:\n        console.log('Unknown message type:', message.type);\n    }\n  }, []);\n  \n  useEffect(() => {\n    // Check if extension is installed\n    try {\n      // This is a typical pattern to detect if your extension is installed\n      // by attempting to communicate with it\n      if (window.chrome && chrome.runtime && chrome.runtime.sendMessage) {\n        // Use the actual extension ID\n        const extensionId = 'jcdmopolmojdhpclfbemdpcdneobmnje'; \n        \n        chrome.runtime.sendMessage(\n          extensionId,\n          { type: 'CHECK_INSTALLATION' },\n          (response: ExtensionInstallResponse | undefined) => {\n            if (response && response.installed) {\n              setIsExtensionInstalled(true);\n              console.log('Extension is installed and connected!');\n            } else {\n              setIsExtensionInstalled(false);\n              console.log('Extension is not installed or not responding');\n            }\n          }\n        );\n      }\n    } catch (error) {\n      console.log('Error checking extension installation:', error);\n      setIsExtensionInstalled(false);\n    }\n    \n    // Set up listener for messages from the extension\n    window.addEventListener('message', handleExtensionMessage);\n    \n    return () => {\n      window.removeEventListener('message', handleExtensionMessage);\n    };\n  }, [handleExtensionMessage]);\n  \n  // Update extension with credentials if available\n  useEffect(() => {\n    if (isExtensionInstalled && apiKey && apiSecret && window.chrome && chrome.runtime && chrome.runtime.sendMessage) {\n      const extensionId = 'jcdmopolmojdhpclfbemdpcdneobmnje';\n      \n      // Send credentials to extension\n      chrome.runtime.sendMessage(\n        extensionId,\n        { \n          type: 'UPDATE_CREDENTIALS', \n          data: { \n            apiKey,\n            apiSecret\n          }\n        },\n        (response: ExtensionUpdateResponse | undefined) => {\n          if (response && response.success) {\n            console.log('API credentials updated in extension');\n          }\n        }\n      );\n    }\n  }, [isExtensionInstalled, apiKey, apiSecret]);\n  \n  // This component doesn't render anything visible, it just handles extension communication\n  return null;\n};\n\nexport default Integration;\n","import React, { useEffect, useRef, useCallback } from 'react';\nimport { X, CheckCircle, AlertCircle, AlertTriangle, Info } from 'lucide-react';\nimport { useAppStore } from '@/store';\nimport { clsx } from 'clsx';\n\nconst ToastContainer: React.FC = () => {\n  const toasts = useAppStore(state => state.toasts);\n  const removeToast = useAppStore(state => state.removeToast);\n  const autoRemovalTimers = useRef<Map<string, NodeJS.Timeout>>(new Map());\n\n  const scheduleAutoRemoval = useCallback((toastId: string) => {\n    // Clear existing timer if any\n    const existingTimer = autoRemovalTimers.current.get(toastId);\n    if (existingTimer) {\n      clearTimeout(existingTimer);\n    }\n\n    // Schedule new removal\n    const timer = setTimeout(() => {\n      removeToast(toastId);\n      autoRemovalTimers.current.delete(toastId);\n    }, 5000);\n\n    autoRemovalTimers.current.set(toastId, timer);\n  }, [removeToast]);\n\n  // Handle auto-removal for new toasts\n  useEffect(() => {\n    toasts.forEach(toast => {\n      if (toast.dismissible !== false && !autoRemovalTimers.current.has(toast.id)) {\n        scheduleAutoRemoval(toast.id);\n      }\n    });\n\n    // Clean up timers for removed toasts\n    const currentToastIds = new Set(toasts.map(t => t.id));\n    autoRemovalTimers.current.forEach((timer, toastId) => {\n      if (!currentToastIds.has(toastId)) {\n        clearTimeout(timer);\n        autoRemovalTimers.current.delete(toastId);\n      }\n    });\n  }, [toasts.length, scheduleAutoRemoval]); // Only depend on toasts.length to avoid infinite loops\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      autoRemovalTimers.current.forEach(timer => clearTimeout(timer));\n      autoRemovalTimers.current.clear();\n    };\n  }, []);\n\n  const getIcon = (type: string) => {\n    switch (type) {\n      case 'success':\n        return <CheckCircle className=\"w-5 h-5 text-green-500\" />;\n      case 'error':\n        return <AlertCircle className=\"w-5 h-5 text-red-500\" />;\n      case 'warning':\n        return <AlertTriangle className=\"w-5 h-5 text-yellow-500\" />;\n      case 'info':\n      default:\n        return <Info className=\"w-5 h-5 text-blue-500\" />;\n    }\n  };\n\n  const getToastStyles = (type: string) => {\n    const baseStyles = \"relative flex items-center p-4 mb-3 rounded-lg shadow-lg border transition-all duration-300 max-w-md\";\n    \n    switch (type) {\n      case 'success':\n        return clsx(baseStyles, \"bg-green-50 border-green-200 text-green-800\");\n      case 'error':\n        return clsx(baseStyles, \"bg-red-50 border-red-200 text-red-800\");\n      case 'warning':\n        return clsx(baseStyles, \"bg-yellow-50 border-yellow-200 text-yellow-800\");\n      case 'info':\n      default:\n        return clsx(baseStyles, \"bg-blue-50 border-blue-200 text-blue-800\");\n    }\n  };\n\n  if (toasts.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed top-4 right-4 z-50 space-y-2\">\n      {toasts.map((toast) => (\n        <div\n          key={toast.id}\n          className={getToastStyles(toast.type)}\n        >\n          <div className=\"flex items-start space-x-3 flex-1\">\n            {getIcon(toast.type)}\n            <div className=\"flex-1\">\n              <p className=\"text-sm font-medium\">{toast.message}</p>\n            </div>\n          </div>\n          \n          {toast.dismissible !== false && (\n            <button\n              onClick={() => removeToast(toast.id)}\n              className=\"ml-3 flex-shrink-0 p-1 rounded-full hover:bg-gray-200 transition-colors\"\n              aria-label=\"Dismiss notification\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default ToastContainer;","import React, { useEffect } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\ninterface RouteGuardProps {\n  children: React.ReactNode;\n}\n\n// Component to preserve navigation state and handle route transitions\nconst RouteGuard: React.FC<RouteGuardProps> = ({ children }) => {\n  const location = useLocation();\n  const navigate = useNavigate();\n  \n  useEffect(() => {\n    // Add navigation state preservation logic here\n    // For now, we'll just log the route change in development\n    if (import.meta.env.DEV) {\n      console.info('Route changed to:', location.pathname);\n    }\n    \n    // Store current path in session storage for state preservation\n    sessionStorage.setItem('lastRoute', location.pathname);\n    \n    // Add route validation if needed\n    const validRoutes = [\n      '/', \n      '/strategies', \n      '/charts', \n      '/performance', \n      '/account', \n      '/chat', \n      '/settings', \n      '/extension'\n    ];\n    \n    // If route is not valid and not already a 404, redirect to 404\n    if (!validRoutes.includes(location.pathname) && location.pathname !== '/404') {\n      navigate('/404', { replace: true });\n    }\n  }, [location.pathname, navigate]);\n\n  return <>{children}</>;\n};\n\nexport default RouteGuard;","/**\n * Handles browser extension communication errors\n * These errors occur when extensions try to communicate but channels close prematurely\n */\nexport class ExtensionErrorHandler {\n  private static instance: ExtensionErrorHandler;\n  private errorCount = 0;\n  private maxErrors = 10;\n  private suppressErrors = false;\n  \n  private constructor() {\n    this.setupErrorInterceptor();\n  }\n  \n  static getInstance(): ExtensionErrorHandler {\n    if (!ExtensionErrorHandler.instance) {\n      ExtensionErrorHandler.instance = new ExtensionErrorHandler();\n    }\n    return ExtensionErrorHandler.instance;\n  }\n  \n  private setupErrorInterceptor(): void {\n    // Override console.error to filter extension errors\n    const originalError = console.error;\n    \n    console.error = (...args: unknown[]) => {\n      const errorMessage = args[0]?.toString() || '';\n      \n      // Check if this is an extension communication error\n      if (this.isExtensionError(errorMessage)) {\n        this.handleExtensionError(errorMessage);\n        \n        // Suppress the error if we've seen too many\n        if (this.suppressErrors || this.errorCount > this.maxErrors) {\n          return;\n        }\n      }\n\n      // Check if this is a React production error\n      if (this.isReactProductionError(errorMessage)) {\n        this.handleExtensionError(errorMessage);\n        return; // Don't call original console.error for React production errors\n      }\n      \n      // Call original console.error for other errors\n      originalError.apply(console, args);\n    };\n    \n    // Also handle unhandled promise rejections\n    window.addEventListener('unhandledrejection', (event) => {\n      if (this.isExtensionError(event.reason?.toString() || '')) {\n        event.preventDefault();\n        this.handleExtensionError(event.reason);\n      }\n    });\n  }\n  \n  private isExtensionError(message: string): boolean {\n    const extensionErrorPatterns = [\n      'listener indicated an asynchronous response',\n      'message channel closed',\n      'Extension context invalidated',\n      'Receiving end does not exist',\n      'Could not establish connection',\n      'chrome-extension'\n    ];\n    \n    return extensionErrorPatterns.some(pattern => \n      message.toLowerCase().includes(pattern.toLowerCase())\n    );\n  }\n\n  private isReactProductionError(message: string): boolean {\n    // Detect minified React errors that should be handled differently\n    const reactErrorPatterns = [\n      'Minified React error #185',\n      'visit https://react.dev/errors/185',\n      'use the non-minified dev environment for full errors'\n    ];\n    \n    return reactErrorPatterns.some(pattern => \n      message.toLowerCase().includes(pattern.toLowerCase())\n    );\n  }\n\n  private handleExtensionError(error: Error | string): void {\n    this.errorCount++;\n    \n    const errorMessage = typeof error === 'string' ? error : error.message || error.toString();\n    \n    // Handle React production errors differently\n    if (this.isReactProductionError(errorMessage)) {\n      console.warn(\n        'React Error #185 detected: This is likely caused by maximum update depth exceeded. ' +\n        'Check for infinite re-renders in component state updates or useEffect dependencies.'\n      );\n      console.warn('Initialization error detected - this may require a page refresh');\n      return;\n    }\n    \n    // Log once every 10 errors to avoid spam\n    if (this.errorCount === 1 || this.errorCount % 10 === 0) {\n      console.warn(\n        `Browser extension communication error (${this.errorCount} occurrences). ` +\n        'This is likely caused by a browser extension and can be safely ignored.'\n      );\n    }\n    \n    // Start suppressing after too many errors\n    if (this.errorCount > this.maxErrors * 2) {\n      this.suppressErrors = true;\n      console.warn('Suppressing further extension errors to reduce console noise.');\n    }\n  }\n  \n  reset(): void {\n    this.errorCount = 0;\n    this.suppressErrors = false;\n  }\n}\n\n/**\n * Browser compatibility and extension detection utilities\n */\nexport class BrowserCompatibility {\n  static isExtensionInstalled(extensionId?: string): boolean {\n    // Check for common extension indicators\n    if (extensionId && chrome?.runtime) {\n      try {\n        chrome.runtime.sendMessage(extensionId, { ping: true }, () => {\n          if (chrome.runtime.lastError) {\n            return false;\n          }\n          return true;\n        });\n      } catch {\n        return false;\n      }\n    }\n    \n    // Check for generic extension artifacts\n    return !!(\n      window.chrome?.runtime ||\n      (window as unknown as { browser?: { runtime?: unknown } }).browser?.runtime\n    );\n  }\n  \n  static detectConflictingExtensions(): string[] {\n    const conflicts: string[] = [];\n    \n    // Check for known conflicting extensions\n    const conflictingExtensions = [\n      { name: 'MetaMask', check: () => !!(window as unknown as { ethereum?: unknown }).ethereum },\n      { name: 'AdBlock', check: () => !!(window as unknown as { adblockDetected?: unknown }).adblockDetected },\n      { name: 'React DevTools', check: () => !!(window as unknown as { __REACT_DEVTOOLS_GLOBAL_HOOK__?: unknown }).__REACT_DEVTOOLS_GLOBAL_HOOK__ },\n    ];\n    \n    conflictingExtensions.forEach(ext => {\n      if (ext.check()) {\n        conflicts.push(ext.name);\n      }\n    });\n    \n    return conflicts;\n  }\n  \n  static setupExtensionCompatibility(): void {\n    // Initialize error handler\n    ExtensionErrorHandler.getInstance();\n    \n    // Detect and warn about conflicts\n    const conflicts = this.detectConflictingExtensions();\n    if (conflicts.length > 0) {\n      console.info(\n        `Detected browser extensions: ${conflicts.join(', ')}. ` +\n        'Some console errors may appear due to extension communication.'\n      );\n    }\n    \n    // Set up message channel protection\n    this.protectMessageChannels();\n  }\n  \n  private static protectMessageChannels(): void {\n    // Wrap postMessage to handle closed channels gracefully\n    const originalPostMessage = window.postMessage;\n    \n    window.postMessage = function(...args: Parameters<typeof originalPostMessage>) {\n      try {\n        return originalPostMessage.apply(window, args);\n      } catch (error) {\n        if (error?.toString().includes('message channel closed')) {\n          // Silently ignore\n          return;\n        }\n        throw error;\n      }\n    };\n  }\n}","import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\nimport { lazy, Suspense, useEffect } from 'react';\nimport Navbar from './components/Navbar';\nimport Sidebar from './components/Sidebar';\nimport SkipLinks from './components/SkipLinks';\nimport EnvironmentStatus from './components/EnvironmentStatus';\nimport ConnectionHealth from './components/ConnectionHealth';\nimport { ConfigurationStatus } from './components/ConfigurationStatus';\nimport { EnvDebug } from './components/EnvDebug';\nimport { ConnectionTest } from './components/ConnectionTest';\nimport PWAInstallPrompt from './components/PWAInstallPrompt';\nimport { TradingProvider } from './context/TradingContext';\nimport { SettingsProvider } from './context/SettingsContext';\nimport { WebSocketProvider } from './context/WebSocketContext';\nimport { ErrorBoundary } from './components/ErrorBoundary';\nimport Integration from './components/Integration';\nimport ToastContainer from './components/ToastContainer';\nimport RouteGuard from './components/RouteGuard';\nimport { BrowserCompatibility } from './utils/extensionErrorHandler';\nimport './App.css';\n\n// Lazy load page components\nconst Dashboard = lazy(() => import('./pages/Dashboard'));\nconst LiveTradingDashboard = lazy(() => import('./pages/LiveTradingDashboard'));\nconst Strategies = lazy(() => import('./pages/Strategies'));\nconst Backtesting = lazy(() => import('./pages/Backtesting'));\nconst Account = lazy(() => import('./pages/Account'));\nconst TransactionHistory = lazy(() => import('./pages/TransactionHistory'));\nconst TradeHistory = lazy(() => import('./pages/TradeHistory'));\nconst MarketAnalysis = lazy(() => import('./pages/MarketAnalysis'));\nconst Performance = lazy(() => import('./pages/Performance'));\nconst Settings = lazy(() => import('./pages/Settings'));\nconst Chat = lazy(() => import('./pages/Chat'));\nconst ExtensionDownload = lazy(() => import('./pages/ExtensionDownload'));\nconst NotFound = lazy(() => import('./pages/NotFound'));\n\n// Loading component\nconst LoadingSpinner = () => (\n  <div \n    className=\"flex items-center justify-center min-h-screen\"\n    role=\"status\"\n    aria-label=\"Loading application\"\n  >\n    <div \n      className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"\n      aria-hidden=\"true\"\n    ></div>\n    <span className=\"sr-only\">Loading...</span>\n  </div>\n);\n\nfunction App() {\n  // Initialize browser compatibility and extension error handling after React mounts\n  useEffect(() => {\n    BrowserCompatibility.setupExtensionCompatibility();\n  }, []);\n  return (\n    <>\n      <SkipLinks />\n      <Router>\n        <ErrorBoundary>\n          <SettingsProvider>\n            <WebSocketProvider>\n              <TradingProvider>\n                <div className=\"flex h-screen bg-neutral-100 overflow-hidden\">\n                  <Sidebar />\n                  <div className=\"flex-1 flex flex-col min-w-0\">\n                    <Navbar />\n                    <main \n                      id=\"main-content\"\n                      className=\"flex-1 overflow-y-auto bg-neutral-100 p-4 sm:p-6 lg:p-8\"\n                      role=\"main\"\n                      aria-label=\"Main content\"\n                      tabIndex={-1}\n                    >\n                      <RouteGuard>\n                        <Suspense fallback={<LoadingSpinner />}>\n                          <Routes>\n                            <Route path=\"/\" element={<Dashboard />} />\n                            <Route path=\"/dashboard/live\" element={<LiveTradingDashboard />} />\n                            <Route path=\"/strategies\" element={<Strategies />} />\n                            <Route path=\"/backtesting\" element={<Backtesting />} />\n                            <Route path=\"/charts\" element={<MarketAnalysis />} />\n                            <Route path=\"/performance\" element={<Performance />} />\n                            <Route path=\"/account\" element={<Account />} />\n                            <Route path=\"/transactions\" element={<TransactionHistory />} />\n                            <Route path=\"/trades\" element={<TradeHistory />} />\n                            <Route path=\"/chat\" element={<Chat />} />\n                            <Route path=\"/settings\" element={<Settings />} />\n                            <Route path=\"/extension\" element={<ExtensionDownload />} />\n                            <Route path=\"/404\" element={<NotFound />} />\n                            <Route path=\"*\" element={<NotFound />} />\n                          </Routes>\n                        </Suspense>\n                      </RouteGuard>\n                    </main>\n                  </div>\n                </div>\n                <Integration />\n                <ToastContainer />\n                <EnvironmentStatus />\n                <ConfigurationStatus />\n                <ConnectionHealth />\n                <EnvDebug />\n                <ConnectionTest />\n                <PWAInstallPrompt />\n              </TradingProvider>\n            </WebSocketProvider>\n          </SettingsProvider>\n        </ErrorBoundary>\n      </Router>\n    </>\n  );\n}\n\nexport default App;\n","import { StrictMode } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App.tsx';\nimport './index.css';\n\ncreateRoot(document.getElementById('root')!).render(\n  <StrictMode>\n    <App />\n  </StrictMode>\n);\n"],"file":"assets/index-CF9_aBFn.js"}