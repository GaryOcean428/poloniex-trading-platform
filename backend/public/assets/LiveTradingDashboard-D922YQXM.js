var Q=Object.defineProperty;var ee=(p,t,a)=>t in p?Q(p,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):p[t]=a;var A=(p,t,a)=>ee(p,typeof t!="symbol"?t+"":t,a);import{r as d,j as e,G as te,J as ae,K as se,T as re,z as ne,B as H,V as le,N as ie,S as oe,X as ce,I as de,O as ue,k as me,q as he,W as xe,o as ge,h as pe,P as fe,n as be}from"./vendor-52n1XO7X.js";import{u as X,a as G}from"./index-CF9_aBFn.js";import{a as ve}from"./utils-BD673Xbx.js";import{c as je,R as we,L as ke,C as Ne,X as ye,Y as J,T as Se,a as De,b as K}from"./recharts-BPJZfBEU.js";import{t as Ce}from"./ui-yGZq-iow.js";import{S as Pe,R as Te}from"./RecentTrades-D8HiDYdf.js";import{M as Ae}from"./MockModeNotice-CLq-RO69.js";import{C as $e,a as Le,b as Ee,P as Fe,c as Me,p as _e,d as Ie,e as ze}from"./chartjs-BJCDgmXj.js";import"./crypto-CgpT01XT.js";function Re(p,t){let a;return function(...r){a||(p.apply(this,r),a=!0,setTimeout(()=>a=!1,t))}}function Ue(p,t){let a;return function(...r){clearTimeout(a),a=setTimeout(()=>p.apply(this,r),t)}}class Be{constructor(){A(this,"events",{})}on(t,a){this.events[t]||(this.events[t]=[]),this.events[t].push(a)}off(t,a){this.events[t]&&(this.events[t]=this.events[t].filter(r=>r!==a))}emit(t,...a){this.events[t]&&this.events[t].forEach(r=>{try{r(...a)}catch(n){console.error("Error in event handler:",n)}})}removeAllListeners(t){t?delete this.events[t]:this.events={}}}const Ve={primarySource:"aggregated",fallbackSources:["poloniex","websocket","rest"],updateInterval:1e3,aggregationMethod:"weighted",enableAnomalyDetection:!0,anomalyThreshold:3,enableDataNormalization:!0,cacheDuration:6e4,maxRetries:3,retryDelay:1e3,enableCompression:!0,logLevel:"info"},T=new Map,S=new Be;class Y{constructor(t={}){A(this,"config");A(this,"websockets",new Map);A(this,"poloniexRestClient");A(this,"isRunning",!1);A(this,"retryCount",new Map);A(this,"dataBuffer",new Map);A(this,"lastAnomalyCheck",new Map);A(this,"statisticalBaseline",new Map);A(this,"processDataThrottled");A(this,"updateBaselineDebounced");this.config={...Ve,...t},this.initializePoloniexClient(),this.processDataThrottled=Re(this.processData.bind(this),200),this.updateBaselineDebounced=Ue(this.updateStatisticalBaseline.bind(this),6e4),S.on("data_received",this.handleDataReceived.bind(this)),S.on("connection_error",this.handleConnectionError.bind(this))}initializePoloniexClient(){this.poloniexRestClient=ve.create({baseURL:"https://api.poloniex.com/markets",timeout:1e4,headers:{"Content-Type":"application/json","User-Agent":"PoloniexTradingPlatform/1.0"}}),this.log("info","Poloniex REST client initialized")}start(){if(this.isRunning){this.log("warn","Live data service is already running");return}this.isRunning=!0,this.log("info","Starting live data service"),(this.config.primarySource==="websocket"||this.config.fallbackSources.includes("websocket"))&&this.initializeWebSockets(),S.emit("service_started")}stop(){if(!this.isRunning){this.log("warn","Live data service is not running");return}this.isRunning=!1,this.log("info","Stopping live data service");for(const[t,a]of this.websockets.entries())a.close(),this.websockets.delete(t);S.emit("service_stopped")}initializeWebSockets(){try{const t=new WebSocket("wss://ws.poloniex.com/markets");t.on("open",()=>{this.log("info","Poloniex WebSocket connected"),t.send(JSON.stringify({event:"subscribe",channel:["ticker"]})),this.websockets.set("poloniex",t),S.emit("websocket_connected","poloniex")}),t.on("message",a=>{try{const r=JSON.parse(a.toString());this.handleWebSocketMessage("poloniex",r)}catch(r){this.log("error",`Error parsing Poloniex WebSocket message: ${r}`)}}),t.on("error",a=>{this.log("error",`Poloniex WebSocket error: ${a}`),S.emit("connection_error",{source:"poloniex",error:a})}),t.on("close",()=>{if(this.log("info","Poloniex WebSocket disconnected"),this.websockets.delete("poloniex"),this.isRunning){const a=(this.retryCount.get("poloniex")||0)+1;this.retryCount.set("poloniex",a),a<=this.config.maxRetries?(this.log("info",`Attempting to reconnect to Poloniex WebSocket (attempt ${a})`),setTimeout(()=>this.initializeWebSockets(),this.config.retryDelay*a)):(this.log("error","Max retry attempts reached for Poloniex WebSocket"),S.emit("max_retries_reached","poloniex"))}})}catch(t){this.log("error",`Error initializing WebSockets: ${t}`),S.emit("initialization_error",{error:t})}}handleWebSocketMessage(t,a){try{if(t==="poloniex"&&a.channel==="ticker"&&a.data){const r=a.data,n={symbol:r.symbol,timestamp:Date.now(),open:parseFloat(r.open),high:parseFloat(r.high),low:parseFloat(r.low),close:parseFloat(r.close),volume:parseFloat(r.volume),quoteVolume:parseFloat(r.quoteVolume),source:"poloniex_ws"};this.processDataThrottled(n),this.addToDataBuffer(n)}S.emit("data_received",{source:t,data:a})}catch(r){this.log("error",`Error handling WebSocket message: ${r}`)}}addToDataBuffer(t){var o;const a=t.symbol;this.dataBuffer.has(a)||this.dataBuffer.set(a,[]);const r=this.dataBuffer.get(a);r.push(t),r.length>100&&r.shift();const n=((o=this.statisticalBaseline.get(a))==null?void 0:o.updateTime)||0;Date.now()-n>3e5&&this.updateBaselineDebounced(a)}updateStatisticalBaseline(t){const a=this.dataBuffer.get(t);if(!a||a.length<30)return;const r=a.map(c=>c.close),n=r.reduce((c,f)=>c+f,0)/r.length,o=r.map(c=>Math.pow(c-n,2)),l=o.reduce((c,f)=>c+f,0)/o.length,m=Math.sqrt(l);this.statisticalBaseline.set(t,{mean:n,stdDev:m,updateTime:Date.now()}),this.log("debug",`Updated statistical baseline for ${t}: mean=${n.toFixed(4)}, stdDev=${m.toFixed(4)}`)}processData(t){try{this.config.enableDataNormalization&&(t=this.normalizeData(t)),this.config.enableAnomalyDetection&&(t=this.detectAnomaly(t));const a=`${t.symbol}_${t.timestamp}`;T.set(a,{data:t,timestamp:Date.now()}),S.emit("data_processed",t)}catch(a){this.log("error",`Error processing data: ${a}`)}}normalizeData(t){const a={...t};for(const r of["open","high","low","close","volume","quoteVolume","weightedAverage"])r in a&&(isNaN(a[r])||!isFinite(a[r]))&&(a[r]=0);return a.high=Math.max(a.open,a.high,a.low,a.close),a.low=Math.min(a.open,a.low,a.close),a.normalized=!0,a}detectAnomaly(t){const a=this.statisticalBaseline.get(t.symbol);if(!a)return{...t,isAnomaly:!1,confidence:0};const r=Math.abs((t.close-a.mean)/a.stdDev),n=r>this.config.anomalyThreshold,o=Math.min(r/(this.config.anomalyThreshold*2),1);return{...t,isAnomaly:n,confidence:o}}async fetchMarketData(t,a="1h",r=100){try{const n=`${t}_${a}_${r}`,o=T.get(n);if(o&&Date.now()-o.timestamp<this.config.cacheDuration)return this.log("debug",`Using cached data for ${n}`),o.data;this.log("info",`Fetching market data for ${t} (${a})`);const l=await this.poloniexRestClient.get(`/${t}/candles`,{params:{interval:a,limit:r}});if(!l.data)throw new Error("No data received from Poloniex API");const c=l.data.map(f=>({symbol:t,timestamp:f.timestamp,open:parseFloat(f.open),high:parseFloat(f.high),low:parseFloat(f.low),close:parseFloat(f.close),volume:parseFloat(f.volume),quoteVolume:parseFloat(f.quoteVolume),source:"poloniex_rest"})).map(f=>(this.config.enableDataNormalization&&(f=this.normalizeData(f)),this.config.enableAnomalyDetection&&(f=this.detectAnomaly(f)),f));return T.set(n,{data:c,timestamp:Date.now()}),c}catch(n){this.log("error",`Error fetching market data: ${n}`);const o=T.get(`${t}_${a}_${r}`);if(o)return this.log("warn",`Using expired cached data for ${t}`),o.data;throw n}}async fetchOrderBook(t,a=100){try{const r=`orderbook_${t}_${a}`,n=T.get(r);if(n&&Date.now()-n.timestamp<this.config.cacheDuration/10)return this.log("debug",`Using cached order book for ${t}`),n.data;this.log("info",`Fetching order book for ${t}`);const o=await this.poloniexRestClient.get(`/${t}/orderBook`,{params:{limit:a}});if(!o.data)throw new Error("No data received from Poloniex API");const l={symbol:t,timestamp:Date.now(),bids:o.data.bids.map(m=>({price:parseFloat(m[0]),amount:parseFloat(m[1]),timestamp:Date.now()})),asks:o.data.asks.map(m=>({price:parseFloat(m[0]),amount:parseFloat(m[1]),timestamp:Date.now()})),source:"poloniex_rest",lastUpdateId:o.data.sequence};return T.set(r,{data:l,timestamp:Date.now()}),l}catch(r){this.log("error",`Error fetching order book: ${r}`);const n=T.get(`orderbook_${t}_${a}`);if(n)return this.log("warn",`Using expired cached order book for ${t}`),n.data;throw r}}async fetchTrades(t,a=100){try{const r=`trades_${t}_${a}`,n=T.get(r);if(n&&Date.now()-n.timestamp<this.config.cacheDuration/10)return this.log("debug",`Using cached trades for ${t}`),n.data;this.log("info",`Fetching trades for ${t}`);const o=await this.poloniexRestClient.get(`/${t}/trades`,{params:{limit:a}});if(!o.data)throw new Error("No data received from Poloniex API");const l=o.data.map(m=>({id:m.id.toString(),symbol:t,timestamp:m.ts,price:parseFloat(m.price),amount:parseFloat(m.amount),side:m.takerSide==="sell"?"buy":"sell",source:"poloniex_rest"}));return T.set(r,{data:l,timestamp:Date.now()}),l}catch(r){this.log("error",`Error fetching trades: ${r}`);const n=T.get(`trades_${t}_${a}`);if(n)return this.log("warn",`Using expired cached trades for ${t}`),n.data;throw r}}async fetchMarketSummary(t){try{const a=`summary_${t}`,r=T.get(a);if(r&&Date.now()-r.timestamp<this.config.cacheDuration/2)return this.log("debug",`Using cached market summary for ${t}`),r.data;this.log("info",`Fetching market summary for ${t}`);const n=await this.poloniexRestClient.get(`/${t}/ticker24h`);if(!n.data)throw new Error("No data received from Poloniex API");const o={symbol:t,timestamp:Date.now(),lastPrice:parseFloat(n.data.close),bidPrice:parseFloat(n.data.markPrice),askPrice:parseFloat(n.data.markPrice),high24h:parseFloat(n.data.high),low24h:parseFloat(n.data.low),volume24h:parseFloat(n.data.volume),quoteVolume24h:parseFloat(n.data.quoteVolume),percentChange24h:parseFloat(n.data.change)*100,source:"poloniex_rest"};return T.set(a,{data:o,timestamp:Date.now()}),o}catch(a){this.log("error",`Error fetching market summary: ${a}`);const r=T.get(`summary_${t}`);if(r)return this.log("warn",`Using expired cached market summary for ${t}`),r.data;throw a}}async getAggregatedData(t,a="1h",r=100){try{const n=[];if(this.config.primarySource==="poloniex"||this.config.fallbackSources.includes("poloniex"))try{const o=await this.fetchMarketData(t,a,r);n.push({source:"poloniex",data:o,weight:1})}catch(o){this.log("warn",`Failed to fetch data from Poloniex: ${o}`)}if(this.config.primarySource==="websocket"||this.config.fallbackSources.includes("websocket")){const o=this.dataBuffer.get(t);o&&o.length>0&&n.push({source:"websocket",data:o,weight:1.2})}if(n.length===0)throw new Error("No data available from any source");return n.length===1?n[0].data:this.aggregateDataSources(n,this.config.aggregationMethod)}catch(n){throw this.log("error",`Error getting aggregated data: ${n}`),n}}aggregateDataSources(t,a){const r=new Map;for(const o of t)for(const l of o.data){const m=Math.floor(l.timestamp/6e4)*6e4;r.has(m)||r.set(m,{points:[],weights:[]});const c=r.get(m);c.points.push(l),c.weights.push(o.weight)}const n=[];for(const[o,{points:l,weights:m}]of r.entries()){if(l.length===0)continue;let c;switch(a){case"weighted":c=this.weightedAggregate(l,m);break;case"median":c=this.medianAggregate(l);break;case"mean":default:c=this.meanAggregate(l);break}c.timestamp=o,c.symbol=l[0].symbol,c.source="aggregated",n.push(c)}return n.sort((o,l)=>o.timestamp-l.timestamp)}weightedAggregate(t,a){const r=a.reduce((l,m)=>l+m,0),n=a.map(l=>l/r),o={};for(const l of["open","high","low","close","volume","quoteVolume"]){let m=0;for(let c=0;c<t.length;c++)m+=t[c][l]*n[c];o[l]=m}return o}medianAggregate(t){const a={};for(const r of["open","high","low","close","volume","quoteVolume"]){const n=t.map(l=>l[r]).sort((l,m)=>l-m),o=Math.floor(n.length/2);n.length%2===0?a[r]=(n[o-1]+n[o])/2:a[r]=n[o]}return a}meanAggregate(t){const a={};for(const r of["open","high","low","close","volume","quoteVolume"]){const n=t.reduce((o,l)=>o+l[r],0);a[r]=n/t.length}return a}handleDataReceived(t){this.log("debug",`Data received from ${t.source}`)}handleConnectionError(t){if(this.log("error",`Connection error from ${t.source}: ${t.error}`),t.source===this.config.primarySource){const a=this.config.fallbackSources.filter(r=>r!==t.source);a.length>0&&this.log("info",`Switching to fallback source: ${a[0]}`)}}log(t,a){const r={debug:0,info:1,warn:2,error:3};if(r[t]>=r[this.config.logLevel]){const n=new Date().toISOString();console[t](`[${n}] [LiveData] [${t.toUpperCase()}] ${a}`)}}}const z=new Y;function W(...p){return Ce(je(p))}const We=({defaultValue:p,value:t,onValueChange:a,className:r,children:n})=>{const[o,l]=d.useState(t||p||"");d.useEffect(()=>{t!==void 0&&l(t)},[t]);const m=c=>{t===void 0&&l(c),a&&a(c)};return e.jsx("div",{className:W("w-full",r),children:d.Children.map(n,c=>d.isValidElement(c)&&c.type===Z?d.cloneElement(c,{activeTab:o,onTabChange:m}):d.isValidElement(c)&&c.type===V?d.cloneElement(c,{activeTab:o}):c)})},Z=({className:p,children:t,activeTab:a,onTabChange:r})=>e.jsx("div",{className:W("flex border-b",p),children:d.Children.map(t,n=>d.isValidElement(n)&&n.type===B?d.cloneElement(n,{active:a===n.props.value,onSelect:()=>r&&r(n.props.value)}):n)}),B=({className:p,children:t,active:a,onSelect:r})=>e.jsx("button",{className:W("px-4 py-2 text-sm font-medium",a?"border-b-2 border-primary text-primary":"text-muted-foreground hover:text-foreground",p),onClick:r,children:t}),V=({className:p,value:t,children:a,activeTab:r})=>t!==r?null:e.jsx("div",{className:W("mt-4",p),children:a}),Oe=()=>{const[p,t]=d.useState([]),[a,r]=d.useState(null),[n,o]=d.useState([]),[l,m]=d.useState(null),[c,f]=d.useState("BTC_USDT"),[M,$]=d.useState("1h"),[L,b]=d.useState(!1),[D,v]=d.useState(null),[w,E]=d.useState([]),[y,C]=d.useState("stopped"),[h,g]=d.useState({primarySource:"aggregated",fallbackSources:["poloniex","websocket","rest"],updateInterval:1e3,aggregationMethod:"weighted",enableAnomalyDetection:!0,anomalyThreshold:3,enableDataNormalization:!0,cacheDuration:6e4,maxRetries:3,retryDelay:1e3,enableCompression:!0,logLevel:"info"}),P=["BTC_USDT","ETH_USDT","SOL_USDT","XRP_USDT","ADA_USDT","DOGE_USDT","MATIC_USDT","DOT_USDT","AVAX_USDT","LINK_USDT"],x=["5m","15m","30m","1h","4h","1d"],k=d.useCallback(async()=>{try{b(!0),v(null);const s=await z.getAggregatedData(c,M,100);t(s);const j=s.filter(N=>N.isAnomaly);E(j),b(!1)}catch(s){console.error("Error fetching market data:",s),v(`Failed to fetch market data: ${s instanceof Error?s.message:"Unknown error"}`),b(!1)}},[c,M]),_=d.useCallback(async()=>{try{const s=await z.fetchOrderBook(c);r(s)}catch(s){console.error("Error fetching order book:",s)}},[c]),I=d.useCallback(async()=>{try{const s=await z.fetchTrades(c,50);o(s)}catch(s){console.error("Error fetching trades:",s)}},[c]),R=d.useCallback(async()=>{try{const s=await z.fetchMarketSummary(c);m(s)}catch(s){console.error("Error fetching market summary:",s)}},[c]),U=()=>{y==="stopped"?(z.start(),C("running")):(z.stop(),C("stopped"))},i=s=>{const j={...h,...s};g(j),y==="running"&&(z.stop(),new Y(j).start())};d.useEffect(()=>{k(),_(),I(),R();const s=F=>{F.symbol===c&&(t(O=>{const q=[...O,F];return q.length>100?q.slice(-100):q}),F.isAnomaly&&E(O=>[...O,F]))},j=()=>{C("running")},N=()=>{C("stopped")};return S.on("data_processed",s),S.on("service_started",j),S.on("service_stopped",N),()=>{S.off("data_processed",s),S.off("service_started",j),S.off("service_stopped",N)}},[k,_,I,R,c]),d.useEffect(()=>{const s=setInterval(_,1e4),j=setInterval(I,5e3),N=setInterval(R,3e4);return()=>{clearInterval(s),clearInterval(j),clearInterval(N)}},[_,I,R]);const u=()=>p.map(s=>({timestamp:new Date(s.timestamp).toLocaleTimeString(),close:s.close,volume:s.volume/1e3,isAnomaly:s.isAnomaly?s.close:null}));return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-800 dark:text-white",children:"Advanced Live Data Dashboard"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:U,className:`px-4 py-2 rounded-md text-white ${y==="running"?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,children:y==="running"?"Stop Live Data":"Start Live Data"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:c,onChange:s=>f(s.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border-neutral-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-neutral-700 dark:border-neutral-600 dark:text-white",children:P.map(s=>e.jsx("option",{value:s,children:s},s))})}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:M,onChange:s=>$(s.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border-neutral-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-neutral-700 dark:border-neutral-600 dark:text-white",children:x.map(s=>e.jsx("option",{value:s,children:s},s))})}),e.jsx("button",{onClick:k,disabled:L,className:`px-4 py-2 rounded-md text-white ${L?"bg-neutral-400":"bg-blue-600 hover:bg-blue-700"}`,children:L?"Loading...":"Refresh"})]})]}),D&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:D}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-neutral-100 dark:bg-neutral-700 p-4 rounded-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 text-neutral-700 dark:text-neutral-300",children:"Price"}),e.jsxs("div",{className:"text-3xl font-bold text-neutral-800 dark:text-white",children:["$",l.lastPrice.toFixed(2)]}),e.jsxs("div",{className:`text-sm font-medium ${l.percentChange24h>=0?"text-green-600":"text-red-600"}`,children:[l.percentChange24h>=0?"+":"",l.percentChange24h.toFixed(2),"%"]})]}),e.jsxs("div",{className:"bg-neutral-100 dark:bg-neutral-700 p-4 rounded-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 text-neutral-700 dark:text-neutral-300",children:"24h Range"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Low"}),e.jsxs("div",{className:"text-lg font-semibold text-neutral-800 dark:text-white",children:["$",l.low24h.toFixed(2)]})]}),e.jsx("div",{className:"w-full mx-4",children:e.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2.5 dark:bg-neutral-600",children:e.jsx("div",{className:"h-2.5 rounded-full bg-blue-600",style:{width:`${((l.lastPrice-l.low24h)/(l.high24h-l.low24h)*100).toFixed(0)}%`}})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"High"}),e.jsxs("div",{className:"text-lg font-semibold text-neutral-800 dark:text-white",children:["$",l.high24h.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-neutral-100 dark:bg-neutral-700 p-4 rounded-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 text-neutral-700 dark:text-neutral-300",children:"24h Volume"}),e.jsx("div",{className:"text-3xl font-bold text-neutral-800 dark:text-white",children:l.volume24h.toLocaleString(void 0,{maximumFractionDigits:2})}),e.jsxs("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:["$",l.quoteVolume24h.toLocaleString(void 0,{maximumFractionDigits:2})]})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 text-neutral-700 dark:text-neutral-300",children:"Price Chart"}),e.jsx("div",{className:"h-80 bg-neutral-50 dark:bg-neutral-700 p-4 rounded-md",children:p.length>0?e.jsx(we,{width:"100%",height:"100%",children:e.jsxs(ke,{data:u(),margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Ne,{strokeDasharray:"3 3"}),e.jsx(ye,{dataKey:"timestamp"}),e.jsx(J,{yAxisId:"left"}),e.jsx(J,{yAxisId:"right",orientation:"right"}),e.jsx(Se,{}),e.jsx(De,{}),e.jsx(K,{yAxisId:"left",type:"monotone",dataKey:"close",stroke:"#2563eb",dot:!1,activeDot:{r:8}}),e.jsx(K,{yAxisId:"right",type:"monotone",dataKey:"volume",stroke:"#9ca3af",dot:!1}),e.jsx(K,{yAxisId:"left",type:"monotone",dataKey:"isAnomaly",stroke:"#ef4444",strokeWidth:0,dot:{r:6,fill:"#ef4444"}})]})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"No data available"})})})]}),e.jsxs(We,{defaultValue:"order-book",children:[e.jsxs(Z,{children:[e.jsx(B,{value:"order-book",children:"Order Book"}),e.jsx(B,{value:"recent-trades",children:"Recent Trades"}),e.jsx(B,{value:"anomalies",children:"Anomalies"}),e.jsx(B,{value:"configuration",children:"Configuration"})]}),e.jsx(V,{value:"order-book",children:a?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2 text-green-600",children:"Bids"}),e.jsx("div",{className:"overflow-y-auto max-h-60",children:e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-700",children:[e.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200 dark:bg-neutral-900 dark:divide-neutral-700",children:a.bids.map((s,j)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm font-medium text-green-600",children:s.price.toFixed(2)}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-neutral-500 dark:text-neutral-400",children:s.amount.toFixed(6)}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-neutral-500 dark:text-neutral-400",children:(s.price*s.amount).toFixed(2)})]},j))})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2 text-red-600",children:"Asks"}),e.jsx("div",{className:"overflow-y-auto max-h-60",children:e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-700",children:[e.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200 dark:bg-neutral-900 dark:divide-neutral-700",children:a.asks.map((s,j)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm font-medium text-red-600",children:s.price.toFixed(2)}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-neutral-500 dark:text-neutral-400",children:s.amount.toFixed(6)}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-neutral-500 dark:text-neutral-400",children:(s.price*s.amount).toFixed(2)})]},j))})]})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"No order book data available"})})}),e.jsx(V,{value:"recent-trades",children:n.length>0?e.jsx("div",{className:"overflow-y-auto max-h-60",children:e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-700",children:[e.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Side"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200 dark:bg-neutral-900 dark:divide-neutral-700",children:n.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-neutral-500 dark:text-neutral-400",children:new Date(s.timestamp).toLocaleTimeString()}),e.jsx("td",{className:`px-6 py-2 whitespace-nowrap text-sm font-medium ${s.side==="buy"?"text-green-600":"text-red-600"}`,children:s.price.toFixed(2)}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-neutral-500 dark:text-neutral-400",children:s.amount.toFixed(6)}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.side==="buy"?"bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100":"bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100"}`,children:s.side.toUpperCase()})})]},s.id))})]})}):e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"No trade data available"})})}),e.jsx(V,{value:"anomalies",children:w.length>0?e.jsx("div",{className:"overflow-y-auto max-h-60",children:e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-700",children:[e.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Confidence"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Type"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200 dark:bg-neutral-900 dark:divide-neutral-700",children:w.map((s,j)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-neutral-500 dark:text-neutral-400",children:new Date(s.timestamp).toLocaleString()}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm font-medium text-neutral-800 dark:text-white",children:s.close.toFixed(2)}),e.jsxs("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-neutral-500 dark:text-neutral-400",children:[e.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2.5 dark:bg-neutral-700",children:e.jsx("div",{className:"h-2.5 rounded-full bg-red-600",style:{width:`${((s.confidence||0)*100).toFixed(0)}%`}})}),e.jsxs("span",{className:"text-xs",children:[((s.confidence||0)*100).toFixed(0),"%"]})]}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100",children:"PRICE ANOMALY"})})]},j))})]})}):e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:"No anomalies detected"})})}),e.jsx(V,{value:"configuration",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-4 text-neutral-700 dark:text-neutral-300",children:"Data Sources"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Primary Source"}),e.jsxs("select",{value:h.primarySource,onChange:s=>i({primarySource:s.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white",children:[e.jsx("option",{value:"poloniex",children:"Poloniex API"}),e.jsx("option",{value:"websocket",children:"WebSocket"}),e.jsx("option",{value:"aggregated",children:"Aggregated (Multiple Sources)"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Aggregation Method"}),e.jsxs("select",{value:h.aggregationMethod,onChange:s=>i({aggregationMethod:s.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white",children:[e.jsx("option",{value:"weighted",children:"Weighted Average"}),e.jsx("option",{value:"median",children:"Median"}),e.jsx("option",{value:"mean",children:"Mean"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Update Interval (ms)"}),e.jsx("input",{type:"number",min:"100",max:"10000",step:"100",value:h.updateInterval,onChange:s=>i({updateInterval:parseInt(s.target.value)}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-4 text-neutral-700 dark:text-neutral-300",children:"Data Processing"}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",id:"enableAnomalyDetection",checked:h.enableAnomalyDetection,onChange:s=>i({enableAnomalyDetection:s.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-neutral-300 rounded"}),e.jsx("label",{htmlFor:"enableAnomalyDetection",className:"ml-2 block text-sm text-neutral-700 dark:text-neutral-300",children:"Enable Anomaly Detection"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Anomaly Threshold (standard deviations)"}),e.jsx("input",{type:"number",min:"1",max:"10",step:"0.1",value:h.anomalyThreshold,onChange:s=>i({anomalyThreshold:parseFloat(s.target.value)}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white"})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",id:"enableDataNormalization",checked:h.enableDataNormalization,onChange:s=>i({enableDataNormalization:s.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-neutral-300 rounded"}),e.jsx("label",{htmlFor:"enableDataNormalization",className:"ml-2 block text-sm text-neutral-700 dark:text-neutral-300",children:"Enable Data Normalization"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Log Level"}),e.jsxs("select",{value:h.logLevel,onChange:s=>i({logLevel:s.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white",children:[e.jsx("option",{value:"debug",children:"Debug"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warn",children:"Warning"}),e.jsx("option",{value:"error",children:"Error"})]})]})]})]})})]})]})},qe=({refreshInterval:p=5e3})=>{const{accountBalance:t,activeStrategies:a}=X(),{isConnected:r,on:n,off:o}=G(),[l,m]=d.useState(null),[c,f]=d.useState(!0),[M,$]=d.useState(Date.now()),L=d.useCallback(()=>{if(t){const h=parseFloat(t.totalAmount||"0"),g=parseFloat(t.unrealizedPnL||"0"),P=parseFloat(t.todayPnL||"0"),x=parseFloat(t.availableAmount||"0"),k={change:0,changePercent:0,timestamp:Date.now()};m({totalValue:{value:h,...k},availableBalance:{value:x,...k},unrealizedPnL:{value:g,change:g,changePercent:h>0?g/h*100:0,timestamp:Date.now()},realizedPnL:{value:0,...k},dayPnL:{value:P,change:P,changePercent:parseFloat(t.todayPnLPercentage||"0"),timestamp:Date.now()},openPositions:0,marginUsed:0,marginFree:x,totalEquity:h}),f(!1)}},[t]),b=d.useCallback(h=>{m(g=>{if(!g)return null;const P=(h.amount||0)*(h.price||0),x=h.profit||0,k=x>=0;return{...g,totalValue:{...g.totalValue,value:g.totalValue.value+x,change:x,changePercent:g.totalValue.value>0?x/g.totalValue.value*100:0,timestamp:Date.now()},realizedPnL:{...g.realizedPnL,value:g.realizedPnL.value+x,change:x,changePercent:k?Math.abs(x/P*100):-Math.abs(x/P*100),timestamp:Date.now()},dayPnL:{...g.dayPnL,value:g.dayPnL.value+x,change:x,changePercent:g.totalValue.value>0?(g.dayPnL.value+x)/g.totalValue.value*100:0,timestamp:Date.now()},openPositions:h.side==="buy"?g.openPositions+1:Math.max(0,g.openPositions-1)}}),$(Date.now())},[]),D=d.useCallback(h=>{m(g=>{if(!g)return null;const P=h.changePercent||0,x=g.totalValue.value*(P/100)*.1;return{...g,unrealizedPnL:{...g.unrealizedPnL,value:g.unrealizedPnL.value+x,change:x,changePercent:g.totalValue.value>0?x/g.totalValue.value*100:0,timestamp:Date.now()},totalValue:{...g.totalValue,value:g.totalValue.value+x,change:x,changePercent:P*.1,timestamp:Date.now()}}})},[]);if(d.useEffect(()=>{L()},[L]),d.useEffect(()=>{if(r)return n("tradeExecuted",b),n("marketData",D),()=>{o("tradeExecuted",b),o("marketData",D)}},[r,b,D,n,o]),d.useEffect(()=>{const h=setInterval(()=>{$(Date.now())},p);return()=>clearInterval(h)},[p]),c||!l)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((h,g)=>e.jsx("div",{className:"trading-card animate-pulse",children:e.jsx("div",{className:"h-20 bg-neutral-200 rounded"})},g))});const v=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(h),w=h=>`${h>=0?"+":""}${h.toFixed(2)}%`,E=h=>h>=0?"text-green-600":"text-red-600",y=h=>h>=0?"bg-green-100":"bg-red-100",C=h=>h>=0?e.jsx(re,{className:"h-5 w-5 text-green-600"}):e.jsx(ne,{className:"h-5 w-5 text-red-600"});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-neutral-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{children:r?"Live updates active":"Offline mode"})]}),e.jsxs("span",{children:["Last update: ",new Date(M).toLocaleTimeString()]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"trading-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-500 mb-1",children:"Total Portfolio"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-800",children:v(l.totalValue.value)}),e.jsx("div",{className:`text-sm font-medium ${E(l.totalValue.changePercent)}`,children:w(l.totalValue.changePercent)})]}),e.jsx("div",{className:`p-2 rounded-full ${y(l.totalValue.changePercent)}`,children:e.jsx(te,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"trading-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-500 mb-1",children:"Today's P&L"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-800",children:v(l.dayPnL.value)}),e.jsx("div",{className:`text-sm font-medium ${E(l.dayPnL.changePercent)}`,children:w(l.dayPnL.changePercent)})]}),e.jsx("div",{className:`p-2 rounded-full ${y(l.dayPnL.changePercent)}`,children:C(l.dayPnL.changePercent)})]})}),e.jsx("div",{className:"trading-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-500 mb-1",children:"Unrealized P&L"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-800",children:v(l.unrealizedPnL.value)}),e.jsx("div",{className:`text-sm font-medium ${E(l.unrealizedPnL.changePercent)}`,children:w(l.unrealizedPnL.changePercent)})]}),e.jsx("div",{className:`p-2 rounded-full ${y(l.unrealizedPnL.changePercent)}`,children:e.jsx(ae,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"trading-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-500 mb-1",children:"Open Positions"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-800",children:l.openPositions}),e.jsxs("div",{className:"text-sm text-neutral-500",children:[a.length," strategies active"]})]}),e.jsx("div",{className:"p-2 rounded-full bg-orange-100",children:e.jsx(se,{className:"h-6 w-6 text-orange-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"trading-card",children:[e.jsx("h4",{className:"text-lg font-medium text-neutral-800 mb-3",children:"Available Balance"}),e.jsx("div",{className:"text-xl font-bold text-neutral-800",children:v(l.availableBalance.value)}),e.jsx("div",{className:"text-sm text-neutral-500 mt-1",children:"Ready for trading"})]}),e.jsxs("div",{className:"trading-card",children:[e.jsx("h4",{className:"text-lg font-medium text-neutral-800 mb-3",children:"Realized P&L"}),e.jsx("div",{className:`text-xl font-bold ${E(l.realizedPnL.value)}`,children:v(l.realizedPnL.value)}),e.jsx("div",{className:"text-sm text-neutral-500 mt-1",children:"Closed positions"})]}),e.jsxs("div",{className:"trading-card",children:[e.jsx("h4",{className:"text-lg font-medium text-neutral-800 mb-3",children:"Total Equity"}),e.jsx("div",{className:"text-xl font-bold text-neutral-800",children:v(l.totalEquity)}),e.jsx("div",{className:"text-sm text-neutral-500 mt-1",children:"Including unrealized"})]})]})]})},Ke=({maxAlerts:p=50,soundEnabled:t=!0,onAlertClick:a})=>{const{isConnected:r,on:n,off:o}=G(),{activeStrategies:l}=X(),[m,c]=d.useState([]),[f,M]=d.useState(t),[$,L]=d.useState(!1),[b,D]=d.useState({priceChange:{enabled:!0,threshold:5},volumeSpike:{enabled:!0,threshold:3},portfolioChange:{enabled:!0,threshold:2},strategyStop:{enabled:!0},connectionIssues:{enabled:!0}}),v=d.useCallback((i,u,s,j,N="medium",F)=>({id:`alert-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:i,category:u,title:s,message:j,timestamp:Date.now(),priority:N,acknowledged:!1,data:F}),[]),w=d.useCallback(i=>{c(u=>{const s=[i,...u];return s.length>p?s.slice(0,p):s}),f&&(i.priority==="high"||i.priority==="critical")&&E(i.type)},[p,f]),E=i=>{try{const u=window.AudioContext||window.webkitAudioContext;if(!u)return;const s=new u,j=s.createOscillator(),N=s.createGain();j.connect(N),N.connect(s.destination);const F={success:800,info:600,warning:400,error:200};j.frequency.value=F[i],j.type="sine",N.gain.setValueAtTime(.3,s.currentTime),N.gain.exponentialRampToValueAtTime(.01,s.currentTime+.5),j.start(s.currentTime),j.stop(s.currentTime+.5)}catch(u){console.warn("Could not play alert sound:",u)}},y=d.useCallback(i=>{if(!b.priceChange.enabled)return;const u=Math.abs(i.changePercent||0);if(u>=b.priceChange.threshold){const s=v(u>=10?"error":"warning","market","Significant Price Movement",`${i.pair} moved ${i.changePercent>0?"+":""}${i.changePercent.toFixed(2)}%`,u>=10?"high":"medium",i);w(s)}},[b.priceChange,v,w]),C=d.useCallback(i=>{var j,N,F;const u=(i.profit||0)>0,s=v(u?"success":"error","trade","Trade Executed",`${((j=i.side)==null?void 0:j.toUpperCase())||"TRADE"} ${i.amount||0} ${i.pair||""} ${u?`+$${((N=i.profit)==null?void 0:N.toFixed(2))||"0.00"}`:`$${((F=i.profit)==null?void 0:F.toFixed(2))||"0.00"}`}`,u?"low":"medium",i);w(s)},[v,w]),h=d.useCallback(i=>{if(b.connectionIssues.enabled){if(i==="disconnected"||i==="failed"){const u=v("error","system","Connection Lost","WebSocket connection lost. Trading may be affected.","high");w(u)}else if(i==="connected"){const u=v("success","system","Connected","WebSocket connection restored.","low");w(u)}}},[b.connectionIssues,v,w]);d.useEffect(()=>{if(r)return n("marketData",y),n("tradeExecuted",C),n("connectionStateChanged",h),()=>{o("marketData",y),o("tradeExecuted",C),o("connectionStateChanged",h)}},[r,y,C,h,n,o]),d.useEffect(()=>{if(!b.strategyStop.enabled)return;const i=m.filter(s=>s.category==="strategy").length,u=l.length;if(i>u){const s=v("warning","strategy","Strategy Stopped",`A trading strategy has stopped. ${u} strategies still active.`,"medium");w(s)}},[l.length,b.strategyStop,v,w,m]);const g=i=>{c(u=>u.map(s=>s.id===i?{...s,acknowledged:!0}:s))},P=i=>{c(u=>u.filter(s=>s.id!==i))},x=()=>{c([])},k=()=>{c(i=>i.map(u=>({...u,acknowledged:!0})))},_=i=>{switch(i.type){case"success":return e.jsx(he,{className:"h-5 w-5 text-green-500"});case"warning":return e.jsx(me,{className:"h-5 w-5 text-yellow-500"});case"error":return e.jsx(ue,{className:"h-5 w-5 text-red-500"});case"info":default:return e.jsx(de,{className:"h-5 w-5 text-blue-500"})}},I=i=>{const u=i.acknowledged?"opacity-50 ":"";switch(i.type){case"success":return u+"bg-green-50 border-green-200";case"warning":return u+"bg-yellow-50 border-yellow-200";case"error":return u+"bg-red-50 border-red-200";case"info":default:return u+"bg-blue-50 border-blue-200"}},R=i=>{switch(i){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":default:return"bg-gray-100 text-gray-800"}},U=m.filter(i=>!i.acknowledged).length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-5 w-5 text-neutral-600"}),e.jsx("h3",{className:"text-lg font-medium text-neutral-800",children:"Real-time Alerts"}),U>0&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[U," new"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>M(!f),className:`p-2 rounded-md transition-colors ${f?"bg-blue-100 text-blue-600 hover:bg-blue-200":"bg-gray-100 text-gray-400 hover:bg-gray-200"}`,title:f?"Disable sound":"Enable sound",children:f?e.jsx(le,{className:"h-4 w-4"}):e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>L(!$),className:"p-2 rounded-md bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors",title:"Alert settings",children:e.jsx(oe,{className:"h-4 w-4"})}),U>0&&e.jsx("button",{onClick:k,className:"px-3 py-1 text-sm bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-colors",children:"Acknowledge All"}),m.length>0&&e.jsx("button",{onClick:x,className:"px-3 py-1 text-sm bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition-colors",children:"Clear All"})]})]}),$&&e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-md border",children:[e.jsx("h4",{className:"text-md font-medium mb-3",children:"Alert Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:b.priceChange.enabled,onChange:i=>D(u=>({...u,priceChange:{...u.priceChange,enabled:i.target.checked}})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Price change alerts"})]}),b.priceChange.enabled&&e.jsx("input",{type:"number",min:"1",max:"50",value:b.priceChange.threshold,onChange:i=>D(u=>({...u,priceChange:{...u.priceChange,threshold:parseFloat(i.target.value)}})),className:"mt-1 block w-full px-3 py-1 border border-gray-300 rounded-md text-sm",placeholder:"Threshold %"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:b.portfolioChange.enabled,onChange:i=>D(u=>({...u,portfolioChange:{...u.portfolioChange,enabled:i.target.checked}})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Portfolio change alerts"})]})}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:b.strategyStop.enabled,onChange:i=>D(u=>({...u,strategyStop:{...u.strategyStop,enabled:i.target.checked}})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Strategy alerts"})]})}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:b.connectionIssues.enabled,onChange:i=>D(u=>({...u,connectionIssues:{...u.connectionIssues,enabled:i.target.checked}})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Connection alerts"})]})})]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:m.length>0?m.map(i=>e.jsx("div",{className:`p-3 rounded-md border transition-all duration-200 cursor-pointer ${I(i)}`,onClick:()=>{a&&a(i),i.acknowledged||g(i.id)},children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[_(i),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"text-sm font-medium text-neutral-800 truncate",children:i.title}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${R(i.priority)}`,children:i.priority})]}),e.jsx("p",{className:"text-sm text-neutral-600 mt-1",children:i.message}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:new Date(i.timestamp).toLocaleTimeString()})]})]}),e.jsx("button",{onClick:u=>{u.stopPropagation(),P(i.id)},className:"ml-2 p-1 text-neutral-400 hover:text-neutral-600 transition-colors",children:e.jsx(ce,{className:"h-4 w-4"})})]})},i.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"h-12 w-12 text-neutral-300 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-500",children:"No alerts yet"}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Real-time alerts will appear here"})]})})]})};$e.register(Le,Ee,Fe,Me,_e,Ie,ze);const st=()=>{const{marketData:p,strategies:t,activeStrategies:a,trades:r,isMockMode:n}=X(),{isMockMode:o,isConnected:l,on:m,off:c}=G(),[f,M]=d.useState(null),[$,L]=d.useState([]),[b,D]=d.useState("BTC-USDT"),[v,w]=d.useState(!1),E=["BTC-USDT","ETH-USDT","SOL-USDT","XRP-USDT","ADA-USDT","DOGE-USDT","MATIC-USDT","DOT-USDT"],y=d.useCallback(x=>{if(x.pair===b){const k={timestamp:x.timestamp||Date.now(),value:x.close||x.price,change:x.change||0,changePercent:x.changePercent||0};M(k),L(_=>[..._,k].slice(-50))}},[b]),C=d.useCallback(x=>{console.log("Trade executed:",x)},[]);d.useEffect(()=>{if(v&&l)return m("marketData",y),m("tradeExecuted",C),()=>{c("marketData",y),c("tradeExecuted",C)}},[v,l,y,C,m,c]);const h=()=>{w(!v),v||L([])},g=()=>({labels:$.map(k=>new Date(k.timestamp).toLocaleTimeString()),datasets:[{label:`${b} Price`,data:$.map(k=>k.value),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",borderWidth:2,fill:!0,tension:.1}]}),P={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:`Real-time ${b} Price`}},scales:{y:{beginAtZero:!1}},animation:{duration:0}};return e.jsxs("div",{className:"container-responsive",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-800",children:"Real-time Trading Dashboard"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[l?e.jsx(xe,{className:"h-5 w-5 text-green-500"}):e.jsx(ge,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-sm text-neutral-600",children:l?"Connected":"Disconnected"})]}),e.jsx("select",{value:b,onChange:x=>D(x.target.value),className:"block w-32 px-3 py-2 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",children:E.map(x=>e.jsx("option",{value:x,children:x},x))}),e.jsxs("button",{onClick:h,className:`flex items-center space-x-2 px-4 py-2 rounded-md font-medium transition-colors ${v?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"}`,children:[e.jsx(pe,{size:16}),e.jsx("span",{children:v?"Stop Live":"Start Live"})]})]})]}),(n||o)&&e.jsx("div",{className:"mb-6",children:e.jsx(Ae,{})}),e.jsx("div",{className:"mb-6",children:e.jsx(qe,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 trading-card",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Real-time Price Movement"}),e.jsx("div",{className:"h-64",children:$.length>0?e.jsx(fe,{data:g(),options:P}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{className:"h-12 w-12 text-neutral-400 mx-auto mb-2"}),e.jsx("p",{className:"text-neutral-500",children:v?"Waiting for real-time data...":"Start live mode to see real-time updates"})]})})})]}),e.jsx("div",{className:"trading-card",children:e.jsx(Ke,{maxAlerts:10})})]}),e.jsx("div",{className:"mb-6",children:e.jsx(Oe,{})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"trading-card",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Live Strategy Performance"}),e.jsx(Pe,{strategies:t})]}),e.jsxs("div",{className:"trading-card",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Recent Live Trades"}),e.jsx(Te,{trades:r})]})]})]})};export{st as default};
//# sourceMappingURL=LiveTradingDashboard-D922YQXM.js.map
