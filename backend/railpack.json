{
  "$schema": "https://schema.railpack.com",
  "provider": "node",
  "packageManager": "yarn",
  "node": {
    "version": "20"
  },
  "env": {
    "NODE_ENV": "production",
    "RAILWAY_ENVIRONMENT": "production"
  },
  "install": {
    "commands": [
      "corepack enable",
      "corepack prepare yarn@4.9.2 --activate",
      "yarn install --immutable --immutable-cache"
    ]
  },
  "build": {
    "commands": [
      "cp -r ../shared ./shared || echo 'Shared directory not found' # copy-shared",
      "node prebuild.mjs",
      "rm -rf dist",
      "tsc -p tsconfig.build.json",
      "rm -rf .shared-build"
    ]
  },
  "start": {
    "command": "node dist/src/index.js"
  },
  "health": {
    "path": "/api/health",
    "timeout": 300
  }
}
