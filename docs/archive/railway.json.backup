{
  "$schema": "https://railway.com/railway.schema.json",
  "environments": {
    "production": {
      "services": {
        "frontend": {
          "build": {
            "builder": "NIXPACKS",
            "buildCommand": "corepack enable && yarn install --immutable && yarn workspace poloniex-frontend build",
            "watchPatterns": [
              "frontend/**",
              "shared/**",
              "package.json",
              "yarn.lock",
              ".yarnrc.yml"
            ]
          },
          "deploy": {
            "startCommand": "yarn workspace poloniex-frontend start",
            "restartPolicyType": "ON_FAILURE",
            "restartPolicyMaxRetries": 3,
            "overlapSeconds": 60
          }
        },
        "backend": {
          "build": {
            "builder": "NIXPACKS",
            "buildCommand": "corepack enable && yarn install --immutable && yarn workspace poloniex-backend build",
            "watchPatterns": [
              "backend/**",
              "frontend/**",
              "shared/**",
              "package.json",
              "yarn.lock",
              ".yarnrc.yml"
            ]
          },
          "deploy": {
            "startCommand": "yarn workspace poloniex-backend start:prod",
            "healthcheckPath": "/api/health",
            "healthcheckTimeout": 300,
            "restartPolicyType": "ON_FAILURE",
            "restartPolicyMaxRetries": 3,
            "overlapSeconds": 60
          }
        }
      }
    }
  }
}
